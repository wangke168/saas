# 产品管理模块完善计划

根据 README.md 中的产品管理需求，需要完善以下功能：

## 已完成的功能

1. ✅ 产品基础信息管理（创建、编辑、删除、列表）
2. ✅ 软删除功能
3. ✅ Policy 权限控制
4. ✅ 服务层统一管理

## 待完善的功能

### 1. 产品关联酒店和房型

**需求**：
- 产品由景区门票和酒店组成
- 创建产品时需要在该景区下属酒店中选择酒店
- 在该酒店下属房型中选择需要的房型

**实现方案**：
- 产品通过 `prices` 表关联房型（价格是按房型和日期设置的）
- 创建产品时，需要选择酒店和房型，并设置初始价格
- 前端需要添加酒店和房型选择器

### 2. 价格管理

**需求**：
- 人工维护时，需要设置门市价、结算价、销售价
- 价格是按房型和日期设置的

**实现方案**：
- 使用现有的 `prices` 表
- 创建价格管理界面，支持按日期批量设置价格
- 支持导入/导出价格数据

### 3. 加价规则管理

**需求**：
- 支持按周几设置加价规则（weekday）
- 支持按日期区间设置加价规则（date_range）
- 加价规则需要选择要调整价格的酒店及房型
- 两种情况可以同时存在，每种情况都不一定只有一条加价规则

**实现方案**：
- 使用现有的 `price_rules` 和 `price_rule_items` 表
- 创建加价规则管理界面
- 支持创建、编辑、删除加价规则
- 支持选择多个酒店和房型

### 4. OTA平台推送

**需求**：
- 产品按需推送到各OTA平台
- 可能推送到一个平台，也可能推送到多个平台

**实现方案**：
- 使用现有的 `ota_products` 表
- 创建OTA推送管理界面
- 支持选择多个OTA平台
- 支持推送状态管理

## 实现步骤

1. **完善产品创建/编辑功能**
   - 添加酒店和房型选择
   - 支持选择多个房型
   - 创建产品时设置初始价格

2. **创建产品详情页面**
   - 显示产品基本信息
   - 显示关联的酒店和房型
   - 显示价格列表
   - 显示加价规则列表
   - 显示OTA推送状态

3. **实现价格管理功能**
   - 价格列表展示
   - 价格批量设置
   - 价格导入/导出

4. **实现加价规则管理功能**
   - 加价规则列表
   - 创建/编辑加价规则
   - 选择酒店和房型

5. **实现OTA推送功能**
   - OTA平台选择
   - 推送状态管理
   - 推送历史记录

## 技术实现

### 后端 API

1. **产品相关 API**（已存在）
   - `GET /api/products` - 产品列表
   - `POST /api/products` - 创建产品
   - `GET /api/products/{id}` - 产品详情
   - `PUT /api/products/{id}` - 更新产品
   - `DELETE /api/products/{id}` - 删除产品

2. **价格相关 API**（已存在）
   - `GET /api/prices` - 价格列表
   - `POST /api/prices` - 创建价格
   - `PUT /api/prices/{id}` - 更新价格
   - `DELETE /api/prices/{id}` - 删除价格

3. **加价规则相关 API**（已存在）
   - `GET /api/price-rules` - 加价规则列表
   - `POST /api/price-rules` - 创建加价规则
   - `PUT /api/price-rules/{id}` - 更新加价规则
   - `DELETE /api/price-rules/{id}` - 删除加价规则

4. **OTA推送相关 API**（需要创建）
   - `GET /api/products/{id}/ota-products` - 获取产品的OTA推送列表
   - `POST /api/products/{id}/push-to-ota` - 推送产品到OTA平台
   - `PUT /api/ota-products/{id}` - 更新OTA推送状态

### 前端实现

1. **产品列表页面**（已存在，需要完善）
   - 添加"详情"按钮
   - 显示关联的酒店和房型信息

2. **产品详情页面**（需要创建）
   - 产品基本信息展示
   - 价格管理标签页
   - 加价规则管理标签页
   - OTA推送管理标签页

3. **价格管理组件**（需要创建）
   - 价格列表展示
   - 价格批量设置
   - 价格导入/导出

4. **加价规则管理组件**（需要创建）
   - 加价规则列表
   - 创建/编辑加价规则对话框
   - 酒店和房型选择器

5. **OTA推送管理组件**（需要创建）
   - OTA平台选择
   - 推送状态管理
   - 推送历史记录

## 注意事项

1. 价格管理只对 `price_source = 'manual'` 的产品有效
2. 加价规则只对 `price_source = 'manual'` 的产品有效
3. OTA推送需要确保产品已设置价格
4. 权限控制：运营用户只能管理自己绑定的景区下的产品

