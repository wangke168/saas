import{_ as J,r as u,s as h,i as K,c as O,o as D,f as E,b as a,w as o,d as i,j as x,E as v,k as Q,l as W,h as d,n as X,t as I,q as Y}from"./app-HzGD55g9.js";const ee={style:{"margin-bottom":"20px"}},ae={__name:"Index",setup(te){const P=u([]),C=u(!1),k=u(!1),p=u(!1),g=u(null),z=u(1),U=u(15),S=u(0),b=u(null),B=h(()=>b.value!==null),A=h(()=>B.value?"编辑软件服务商":"创建软件服务商"),n=u({name:"",code:"",description:"",api_type:"",is_active:!0}),N={name:[{required:!0,message:"请输入服务商名称",trigger:"blur"},{max:255,message:"服务商名称不能超过255个字符",trigger:"blur"}],code:[{required:!0,message:"请输入服务商编码",trigger:"blur"},{max:255,message:"服务商编码不能超过255个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"服务商编码只能包含字母、数字、下划线和连字符",trigger:"blur"}]},_=async()=>{C.value=!0;try{const l={page:z.value,per_page:U.value},e=await x.get("/software-providers",{params:l});P.value=e.data.data||[],S.value=e.data.total||0}catch(l){v.error("获取软件服务商列表失败"),console.error(l)}finally{C.value=!1}},T=()=>{b.value=null,$(),p.value=!0},q=l=>{b.value=l.id,n.value={name:l.name,code:l.code,description:l.description||"",api_type:l.api_type||"",is_active:l.is_active},p.value=!0},M=async()=>{g.value&&await g.value.validate(async l=>{var e,r,s,c,y,w;if(l){k.value=!0;try{B.value?(await x.put(`/software-providers/${b.value}`,n.value),v.success("软件服务商更新成功")):(await x.post("/software-providers",n.value),v.success("软件服务商创建成功")),p.value=!1,_()}catch(V){const m=((r=(e=V.response)==null?void 0:e.data)==null?void 0:r.message)||((w=(y=(c=(s=V.response)==null?void 0:s.data)==null?void 0:c.errors)==null?void 0:y.code)==null?void 0:w[0])||"操作失败";v.error(m)}finally{k.value=!1}}})},j=async l=>{var e,r;try{await Y.confirm(`确定要删除软件服务商"${l.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await x.delete(`/software-providers/${l.id}`),v.success("删除成功"),_()}catch(s){if(s!=="cancel"){const c=((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败";v.error(c),console.error(s)}}},$=()=>{var l;n.value={name:"",code:"",description:"",api_type:"",is_active:!0},(l=g.value)==null||l.clearValidate()},R=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return K(()=>{_()}),(l,e)=>{const r=i("el-button"),s=i("el-table-column"),c=i("el-tag"),y=i("el-table"),w=i("el-pagination"),V=i("el-card"),m=i("el-input"),f=i("el-form-item"),F=i("el-switch"),L=i("el-form"),Z=i("el-dialog"),G=Q("loading");return D(),O("div",null,[e[14]||(e[14]=E("h2",null,"软件服务商管理",-1)),a(V,null,{default:o(()=>[E("div",ee,[a(r,{type:"primary",onClick:T},{default:o(()=>[...e[9]||(e[9]=[d("创建软件服务商",-1)])]),_:1})]),W((D(),X(y,{data:P.value,border:""},{default:o(()=>[a(s,{prop:"name",label:"服务商名称",width:"200"}),a(s,{prop:"code",label:"服务商编码",width:"150"}),a(s,{prop:"description",label:"描述","show-overflow-tooltip":""}),a(s,{prop:"api_type",label:"API类型",width:"120"}),a(s,{label:"关联景区数量",width:"120"},{default:o(({row:t})=>[d(I(t.scenic_spots_count||0),1)]),_:1}),a(s,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:t})=>[a(c,{type:t.is_active?"success":"danger"},{default:o(()=>[d(I(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(s,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:t})=>[d(I(R(t.created_at)),1)]),_:1}),a(s,{label:"操作",width:"150",fixed:"right"},{default:o(({row:t})=>[a(r,{size:"small",onClick:H=>q(t)},{default:o(()=>[...e[10]||(e[10]=[d("编辑",-1)])]),_:1},8,["onClick"]),a(r,{size:"small",type:"danger",onClick:H=>j(t)},{default:o(()=>[...e[11]||(e[11]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,C.value]]),a(w,{"current-page":z.value,"onUpdate:currentPage":e[0]||(e[0]=t=>z.value=t),"page-size":U.value,"onUpdate:pageSize":e[1]||(e[1]=t=>U.value=t),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),a(Z,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=t=>p.value=t),title:A.value,width:"600px",onClose:$},{footer:o(()=>[a(r,{onClick:e[7]||(e[7]=t=>p.value=!1)},{default:o(()=>[...e[12]||(e[12]=[d("取消",-1)])]),_:1}),a(r,{type:"primary",onClick:M,loading:k.value},{default:o(()=>[...e[13]||(e[13]=[d("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(L,{ref_key:"formRef",ref:g,model:n.value,rules:N,"label-width":"120px"},{default:o(()=>[a(f,{label:"服务商名称",prop:"name"},{default:o(()=>[a(m,{modelValue:n.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.name=t),placeholder:"请输入服务商名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"服务商编码",prop:"code"},{default:o(()=>[a(m,{modelValue:n.value.code,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.code=t),placeholder:"请输入服务商编码（唯一）",disabled:B.value},null,8,["modelValue","disabled"])]),_:1}),a(f,{label:"描述",prop:"description"},{default:o(()=>[a(m,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.description=t),type:"textarea",rows:4,placeholder:"请输入服务商描述"},null,8,["modelValue"])]),_:1}),a(f,{label:"API类型",prop:"api_type"},{default:o(()=>[a(m,{modelValue:n.value.api_type,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.api_type=t),placeholder:"请输入API类型（可选）"},null,8,["modelValue"])]),_:1}),a(f,{label:"状态",prop:"is_active"},{default:o(()=>[a(F,{modelValue:n.value.is_active,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.is_active=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=J(ae,[["__scopeId","data-v-faaf2cee"]]);export{oe as default};
