import{r as m,i as G,c as J,o as _,f as M,b as t,w as o,d as r,j as U,E as V,e as Q,k as W,l as X,m as Y,h as d,n as g,t as f,p as Z,q as ee,s as $,v as B}from"./app-ZhZD_hbr.js";const te={style:{"margin-bottom":"20px",display:"flex",gap:"10px","flex-wrap":"wrap"}},oe={__name:"Index",setup(ae){Q();const D=m([]),w=m(!1),k=m(1),x=m(15),T=m(0),l=m({status:null,order_no:"",ota_order_no:"",check_in_date:null}),v=async()=>{w.value=!0;try{const n={page:k.value,per_page:x.value};l.value.status&&(n.status=l.value.status),l.value.order_no&&(n.order_no=l.value.order_no),l.value.ota_order_no&&(n.ota_order_no=l.value.ota_order_no),l.value.check_in_date&&(n.check_in_date=l.value.check_in_date);const e=await U.get("/orders",{params:n});D.value=e.data.data,T.value=e.data.total}catch{V.error("获取订单列表失败")}finally{w.value=!1}},p=()=>{k.value=1,v()},N=()=>{l.value={status:null,order_no:"",ota_order_no:"",check_in_date:null},p()},j=n=>n?(parseFloat(n)/100).toFixed(2):"0.00",O=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",z=n=>({paid_pending:"已支付/待确认",confirming:"确认中",confirmed:"预订成功",rejected:"预订失败/拒单",cancel_requested:"申请取消中",cancel_rejected:"取消拒绝",cancel_approved:"取消通过",verified:"核销订单"})[n]||n,q=n=>({paid_pending:"warning",confirming:"info",confirmed:"success",rejected:"danger",cancel_requested:"warning",cancel_rejected:"info",cancel_approved:"info",verified:"success"})[n]||"",A=n=>{B.alert(`
        <div style="text-align: left;">
            <p><strong>订单号：</strong>${n.order_no}</p>
            <p><strong>OTA订单号：</strong>${n.ota_order_no||"-"}</p>
            <p><strong>状态：</strong>${z(n.status)}</p>
            <p><strong>入住日期：</strong>${n.check_in_date}</p>
            <p><strong>离店日期：</strong>${n.check_out_date}</p>
            <p><strong>房间数：</strong>${n.room_count}</p>
            <p><strong>订单金额：</strong>¥${j(n.total_amount)}</p>
            <p><strong>联系人：</strong>${n.contact_name}</p>
            <p><strong>联系电话：</strong>${n.contact_phone}</p>
        </div>
        `,"订单详情",{dangerouslyUseHTMLString:!0})},S=async(n,e)=>{var i,h;try{let c="";if(e==="rejected"){const{value:b}=await B.prompt("请输入拒单原因","拒单",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"});c=b}await U.post(`/orders/${n.id}/update-status`,{status:e,remark:c}),V.success("订单状态更新成功"),v()}catch(c){if(c!=="cancel"){const b=((h=(i=c.response)==null?void 0:i.data)==null?void 0:h.message)||"更新订单状态失败";V.error(b)}}};return G(()=>{v()}),(n,e)=>{const i=r("el-option"),h=r("el-select"),c=r("el-input"),b=r("el-date-picker"),y=r("el-button"),s=r("el-table-column"),E=r("el-tag"),F=r("el-icon"),C=r("el-dropdown-item"),K=r("el-dropdown-menu"),L=r("el-dropdown"),P=r("el-table"),H=r("el-pagination"),I=r("el-card"),R=W("loading");return _(),J("div",null,[e[14]||(e[14]=M("h2",null,"订单管理",-1)),t(I,null,{default:o(()=>[M("div",te,[t(h,{modelValue:l.value.status,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.status=a),placeholder:"订单状态",clearable:"",style:{width:"150px"},onChange:p},{default:o(()=>[t(i,{label:"已支付/待确认",value:"paid_pending"}),t(i,{label:"确认中",value:"confirming"}),t(i,{label:"预订成功",value:"confirmed"}),t(i,{label:"预订失败/拒单",value:"rejected"}),t(i,{label:"申请取消中",value:"cancel_requested"}),t(i,{label:"取消拒绝",value:"cancel_rejected"}),t(i,{label:"取消通过",value:"cancel_approved"}),t(i,{label:"核销订单",value:"verified"})]),_:1},8,["modelValue"]),t(c,{modelValue:l.value.order_no,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.order_no=a),placeholder:"订单号",clearable:"",style:{width:"200px"},onClear:p,onKeyup:Y(p,["enter"])},null,8,["modelValue"]),t(c,{modelValue:l.value.ota_order_no,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.ota_order_no=a),placeholder:"OTA订单号",clearable:"",style:{width:"200px"},onClear:p,onKeyup:Y(p,["enter"])},null,8,["modelValue"]),t(b,{modelValue:l.value.check_in_date,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.check_in_date=a),type:"date",placeholder:"入住日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"150px"},onChange:p},null,8,["modelValue"]),t(y,{onClick:p},{default:o(()=>[...e[6]||(e[6]=[d("筛选",-1)])]),_:1}),t(y,{onClick:N},{default:o(()=>[...e[7]||(e[7]=[d("重置",-1)])]),_:1})]),X((_(),g(P,{data:D.value,border:""},{default:o(()=>[t(s,{prop:"order_no",label:"订单号",width:"180"}),t(s,{prop:"ota_order_no",label:"OTA订单号",width:"180"}),t(s,{label:"OTA平台",width:"120"},{default:o(({row:a})=>{var u;return[d(f(((u=a.ota_platform)==null?void 0:u.name)||"-"),1)]}),_:1}),t(s,{label:"产品",width:"150"},{default:o(({row:a})=>{var u;return[d(f(((u=a.product)==null?void 0:u.name)||"-"),1)]}),_:1}),t(s,{label:"酒店",width:"150"},{default:o(({row:a})=>{var u;return[d(f(((u=a.hotel)==null?void 0:u.name)||"-"),1)]}),_:1}),t(s,{prop:"status",label:"状态",width:"120"},{default:o(({row:a})=>[t(E,{type:q(a.status)},{default:o(()=>[d(f(z(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(s,{prop:"check_in_date",label:"入住日期",width:"120"}),t(s,{prop:"check_out_date",label:"离店日期",width:"120"}),t(s,{prop:"room_count",label:"房间数",width:"80"}),t(s,{prop:"total_amount",label:"订单金额",width:"120"},{default:o(({row:a})=>[d(" ¥"+f(j(a.total_amount)),1)]),_:1}),t(s,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:a})=>[d(f(O(a.created_at)),1)]),_:1}),t(s,{label:"操作",width:"250",fixed:"right"},{default:o(({row:a})=>[t(y,{size:"small",onClick:u=>A(a)},{default:o(()=>[...e[8]||(e[8]=[d("详情",-1)])]),_:1},8,["onClick"]),a.status==="paid_pending"?(_(),g(y,{key:0,size:"small",type:"primary",onClick:u=>S(a,"confirming")},{default:o(()=>[...e[9]||(e[9]=[d(" 确认 ",-1)])]),_:1},8,["onClick"])):(_(),g(L,{key:1,onCommand:u=>S(a,u)},{dropdown:o(()=>[t(K,null,{default:o(()=>[a.status==="confirming"?(_(),g(C,{key:0,command:"confirmed"},{default:o(()=>[...e[11]||(e[11]=[d(" 标记为预订成功 ",-1)])]),_:1})):$("",!0),["paid_pending","confirming"].includes(a.status)?(_(),g(C,{key:1,command:"rejected"},{default:o(()=>[...e[12]||(e[12]=[d(" 拒单 ",-1)])]),_:1})):$("",!0),a.status==="confirmed"?(_(),g(C,{key:2,command:"verified"},{default:o(()=>[...e[13]||(e[13]=[d(" 核销 ",-1)])]),_:1})):$("",!0)]),_:2},1024)]),default:o(()=>[t(y,{size:"small"},{default:o(()=>[e[10]||(e[10]=d(" 更新状态",-1)),t(F,{class:"el-icon--right"},{default:o(()=>[t(Z(ee))]),_:1})]),_:1})]),_:2},1032,["onCommand"]))]),_:1})]),_:1},8,["data"])),[[R,w.value]]),t(H,{"current-page":k.value,"onUpdate:currentPage":e[4]||(e[4]=a=>k.value=a),"page-size":x.value,"onUpdate:pageSize":e[5]||(e[5]=a=>x.value=a),total:T.value,onCurrentChange:v,onSizeChange:v,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"])]),_:1})])}}};export{oe as default};
