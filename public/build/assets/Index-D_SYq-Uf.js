import{_ as We,r as m,A as Q,i as Ze,c as V,o as i,f as y,b as l,w as t,d as w,k as A,E as z,l as Ge,m as He,h as g,y as Je,B as Qe,q as T,s as I,F as E,p as M,t as ze,v as Ye}from"./app-dwQB4-it.js";const ea={style:{"margin-bottom":"20px"}},aa={key:0},la={key:0,style:{"margin-bottom":"20px"}},ta={key:1,style:{"margin-bottom":"20px"}},oa={key:0,style:{"font-size":"12px",color:"#F56C6C","margin-top":"5px"}},sa={key:1,style:{"font-size":"12px",color:"#E6A23C","margin-top":"5px"}},ra={key:0,style:{"margin-top":"10px"}},na={style:{display:"flex",gap:"10px",width:"100%"}},ua={__name:"Index",setup(da){const ie=m([]),Y=m([]),pe=m([]),ee=m(!1),ae=m(!1),X=m(!1),N=m(null),le=m(""),W=m(1),te=m(15),me=m(0),Z=m(null),F=m(!1),G=m(null),oe=m(!1),se=m(null),x=m([]),S=m(null),H=m(null),o=m({username:"",password:"",environment:"production",sync_mode:{inventory:"manual",price:"manual",order:"manual"},order_provider:null,credentials:{ctrip:{username:"",password:""},meituan:{username:"",password:""},fliggy:{username:"",password:""}},auth:{type:"username_password",appkey:"",appsecret:"",app_id:"",token:"",access_token:"",params:[]},is_active:!0}),re=Q(()=>Z.value!==null),Te=Q(()=>re.value?"编辑景区":"创建景区"),D=Q(()=>!S.value||!x.value.length?null:x.value.find(s=>s.id===S.value)||null),ve=Q(()=>{if(!D.value||!o.value.webhook_base_url)return null;const s=o.value.webhook_base_url.trim();if(!s)return null;const e=s.replace(/\/+$/,""),r=D.value.code;return r?`${e}/api/webhooks/res-hotel-stock/${r}/push`:null}),v=m({name:"",code:"",address:"",contact_phone:"",description:"",software_provider_ids:[],is_active:!0}),Ae={name:[{required:!0,message:"请输入景区名称",trigger:"blur"},{max:255,message:"景区名称不能超过255个字符",trigger:"blur"}],code:[{pattern:/^[a-zA-Z0-9_-]+$/,message:"景区编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}]},Ie={"auth.type":[{required:!0,message:"请选择认证类型",trigger:"change"}],username:[{required:!0,message:"请输入默认用户名",trigger:"blur"}],password:[{min:0,max:255,message:"密码长度不能超过255个字符",trigger:"blur"}],environment:[{required:!0,message:"请选择环境",trigger:"change"}],"sync_mode.inventory":[{required:!0,message:"请选择库存同步方式",trigger:"change"}],"sync_mode.price":[{required:!0,message:"请选择价格同步方式",trigger:"change"}],"sync_mode.order":[{required:!0,message:"请选择订单处理方式",trigger:"change"}]},P=async()=>{ee.value=!0;try{const s={page:W.value,per_page:te.value};le.value;const e=await A.get("/scenic-spots",{params:s});ie.value=e.data.data||[],me.value=e.data.total||0}catch(s){z.error("获取景区列表失败"),console.error(s)}finally{ee.value=!1}},Ee=async()=>{try{const s=await A.get("/software-providers");Y.value=s.data.data||[]}catch(s){console.error("获取软件服务商列表失败",s)}},Pe=async()=>{try{const s=await A.get("/ota-platforms");pe.value=s.data.data||[]}catch(s){console.error("获取OTA平台列表失败",s)}},Re=()=>{W.value=1,P()},Xe=()=>{Z.value=null,ce(),X.value=!0},Be=s=>{Z.value=s.id,v.value={name:s.name,code:s.code,address:s.address||"",contact_phone:s.contact_phone||"",description:s.description||"",software_provider_ids:s.software_providers?s.software_providers.map(e=>e.id):[],is_active:s.is_active},X.value=!0},Oe=async()=>{N.value&&await N.value.validate(async s=>{var e,r,C,u,d,c;if(s){ae.value=!0;try{if(re.value)await A.put(`/scenic-spots/${Z.value}`,v.value),z.success("景区更新成功");else{const{code:h,..._}=v.value;await A.post("/scenic-spots",_),z.success("景区创建成功")}X.value=!1,P()}catch(h){const _=((r=(e=h.response)==null?void 0:e.data)==null?void 0:r.message)||((c=(d=(u=(C=h.response)==null?void 0:C.data)==null?void 0:u.errors)==null?void 0:d.code)==null?void 0:c[0])||"操作失败";z.error(_)}finally{ae.value=!1}}})},qe=async s=>{try{await Ye.confirm(`确定要删除景区"${s.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await A.delete(`/scenic-spots/${s.id}`),z.success("删除成功"),P()}catch(e){e!=="cancel"&&(z.error("删除失败"),console.error(e))}},ce=()=>{var s;v.value={name:"",code:"",address:"",contact_phone:"",description:"",software_provider_ids:[],is_active:!0},(s=N.value)==null||s.clearValidate()},Fe=async s=>{se.value=s.id,ne();try{const r=(await A.get(`/scenic-spots/${s.id}`)).data.data;x.value=r.software_providers||[],x.value.length===1||x.value.length>1?S.value=x.value[0].id:S.value=null}catch(e){z.error("获取景区信息失败"),console.error(e);return}F.value=!0,S.value&&await fe(S.value)},De=async s=>{s?await fe(s):ne()},fe=async s=>{var e,r,C,u,d,c,h,_,b,n,p,U,j,K,L,R,B,J,a,k,O,_e,ge,be,we,ke,Ve,xe,he,Se,Ce,Ue;try{const q=await A.get(`/scenic-spots/${se.value}/resource-config`,{params:{software_provider_id:s}});if(q.data.success&&q.data.data){const f=q.data.data,$=((e=f.extra_config)==null?void 0:e.auth)||{};let ue=[];$.type==="custom"&&$.params&&(ue=Object.entries($.params).map(([$e,de])=>typeof de=="string"&&de.startsWith("encrypted:")?{key:$e,value:"***EXISTS***"}:{key:$e,value:de})),o.value={username:f.username||"",password:f.password==="***EXISTS***"?"":f.password||"",environment:f.environment||"production",sync_mode:((r=f.extra_config)==null?void 0:r.sync_mode)||{inventory:"manual",price:"manual",order:"manual"},order_provider:((C=f.extra_config)==null?void 0:C.order_provider)||null,credentials:{ctrip:{username:((c=(d=(u=f.extra_config)==null?void 0:u.credentials)==null?void 0:d.ctrip)==null?void 0:c.username)||"",password:((b=(_=(h=f.extra_config)==null?void 0:h.credentials)==null?void 0:_.ctrip)==null?void 0:b.password)==="***EXISTS***"?"":((U=(p=(n=f.extra_config)==null?void 0:n.credentials)==null?void 0:p.ctrip)==null?void 0:U.password)||""},meituan:{username:((L=(K=(j=f.extra_config)==null?void 0:j.credentials)==null?void 0:K.meituan)==null?void 0:L.username)||"",password:((J=(B=(R=f.extra_config)==null?void 0:R.credentials)==null?void 0:B.meituan)==null?void 0:J.password)==="***EXISTS***"?"":((O=(k=(a=f.extra_config)==null?void 0:a.credentials)==null?void 0:k.meituan)==null?void 0:O.password)||""},fliggy:{username:((be=(ge=(_e=f.extra_config)==null?void 0:_e.credentials)==null?void 0:ge.fliggy)==null?void 0:be.username)||"",password:((Ve=(ke=(we=f.extra_config)==null?void 0:we.credentials)==null?void 0:ke.fliggy)==null?void 0:Ve.password)==="***EXISTS***"?"":((Se=(he=(xe=f.extra_config)==null?void 0:xe.credentials)==null?void 0:he.fliggy)==null?void 0:Se.password)||""}},auth:{type:$.type||"username_password",appkey:$.appkey||"",appsecret:$.appsecret==="***EXISTS***"?"":$.appsecret||"",app_id:$.app_id||"",token:$.token==="***EXISTS***"?"":$.token||"",access_token:$.access_token==="***EXISTS***"?"":$.access_token||"",params:Array.isArray(ue)?ue:[]},webhook_base_url:((Ce=f.extra_config)==null?void 0:Ce.webhook_base_url)||"",is_active:f.is_active??!0}}}catch(q){((Ue=q.response)==null?void 0:Ue.status)!==404&&(z.error("获取资源配置失败"),console.error(q))}},je=async()=>{if(G.value){if(o.value.auth.type==="custom"){const s=o.value.auth.params||[];for(let e=0;e<s.length;e++){const r=s[e];if(!r.key||r.key.trim()===""){z.warning(`第 ${e+1} 个参数的参数名不能为空`);return}!r.value||r.value.trim()===""||r.value}}await G.value.validate(async s=>{var e,r,C,u;if(s){oe.value=!0;try{const d={};for(const[_,b]of Object.entries(o.value.credentials||{}))b&&(b.username||b.password)&&(d[_]={username:b.username||"",password:b.password||""});if(!S.value){z.warning("请先选择要配置的服务商");return}let c={...o.value.auth};if(c.type==="custom"&&c.params){const _={};c.params.forEach(b=>{b.key&&b.value&&b.value!=="***EXISTS***"&&(_[b.key]=b.value)}),c.params=_}else delete c.params;const h={software_provider_id:S.value,username:o.value.username,...o.value.password&&o.value.password!=="***EXISTS***"?{password:String(o.value.password)}:{},environment:o.value.environment,is_active:o.value.is_active,sync_mode:o.value.sync_mode,order_provider:o.value.order_provider||null,credentials:Object.keys(d).length>0?d:{},auth:c,webhook_base_url:o.value.webhook_base_url||null};await A.post(`/scenic-spots/${se.value}/resource-config`,h),z.success("资源配置保存成功"),F.value=!1,P()}catch(d){let c="保存失败";if((r=(e=d.response)==null?void 0:e.data)!=null&&r.message)c=d.response.data.message;else if((u=(C=d.response)==null?void 0:C.data)!=null&&u.errors){const h=d.response.data.errors,_=Object.values(h)[0];c=Array.isArray(_)?_[0]:_}z.error(c),console.error("保存资源配置失败:",d)}finally{oe.value=!1}}})}},ne=()=>{var s;o.value={username:"",password:"",environment:"production",sync_mode:{inventory:"",price:"",order:""},order_provider:null,credentials:{ctrip:{username:"",password:""},meituan:{username:"",password:""},fliggy:{username:"",password:""}},auth:{type:"username_password",appkey:"",appsecret:"",app_id:"",token:"",access_token:"",params:[]},webhook_base_url:"",is_active:!0},S.value=null,H.value=null,x.value=[],(s=G.value)==null||s.clearValidate()},Ke=()=>{o.value.auth.params.push({key:"",value:""})},Le=s=>{o.value.auth.params.splice(s,1)},ye=s=>{if(!s)return!1;const e=["password","pwd","secret","key","token","auth"],r=s.toLowerCase();return e.some(C=>r.includes(C))},Me=s=>{s!=="custom"&&(o.value.auth.params=[],H.value=null)},Ne=s=>{if(s)switch(o.value.auth.params=[],s){case"username_password_custom":o.value.auth.params=[{key:"user",value:""},{key:"pwd",value:""}];break;case"appkey_secret_custom":o.value.auth.params=[{key:"api_key",value:""},{key:"api_secret",value:""}];break;case"token_custom":o.value.auth.params=[{key:"access_token",value:""}];break;case"empty":o.value.auth.params=[];break}};return Ze(()=>{P(),Ee(),Pe()}),(s,e)=>{const r=w("el-button"),C=w("el-icon"),u=w("el-input"),d=w("el-table-column"),c=w("el-tag"),h=w("el-table"),_=w("el-pagination"),b=w("el-card"),n=w("el-form-item"),p=w("el-option"),U=w("el-select"),j=w("el-switch"),K=w("el-form"),L=w("el-dialog"),R=w("el-alert"),B=w("el-divider"),J=Ge("loading");return i(),V("div",null,[e[56]||(e[56]=y("h2",null,"景区管理",-1)),l(b,null,{default:t(()=>[y("div",ea,[l(r,{type:"primary",onClick:Xe},{default:t(()=>[...e[29]||(e[29]=[g("创建景区",-1)])]),_:1}),l(u,{modelValue:le.value,"onUpdate:modelValue":e[0]||(e[0]=a=>le.value=a),placeholder:"搜索景区名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:Re},{prefix:t(()=>[l(C,null,{default:t(()=>[l(Je(Qe))]),_:1})]),_:1},8,["modelValue"])]),He((i(),T(h,{data:ie.value,border:""},{default:t(()=>[l(d,{prop:"name",label:"景区名称",width:"200"}),l(d,{prop:"code",label:"景区编码",width:"150"}),l(d,{prop:"address",label:"地址","show-overflow-tooltip":""}),l(d,{prop:"contact_phone",label:"联系电话",width:"150"}),l(d,{label:"软件服务商",width:"200"},{default:t(({row:a})=>[(i(!0),V(E,null,M(a.software_providers||[],k=>(i(),T(c,{key:k.id,style:{"margin-right":"5px","margin-bottom":"5px"}},{default:t(()=>[g(ze(k.name),1)]),_:2},1024))),128)),!a.software_providers||a.software_providers.length===0?(i(),V("span",aa,"-")):I("",!0)]),_:1}),l(d,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:a})=>[l(c,{type:a.is_active?"success":"danger"},{default:t(()=>[g(ze(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"操作",width:"280",fixed:"right"},{default:t(({row:a})=>[l(r,{size:"small",onClick:k=>Be(a)},{default:t(()=>[...e[30]||(e[30]=[g("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"info",onClick:k=>Fe(a)},{default:t(()=>[...e[31]||(e[31]=[g("配置资源方",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:k=>qe(a)},{default:t(()=>[...e[32]||(e[32]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,ee.value]]),l(_,{"current-page":W.value,"onUpdate:currentPage":e[1]||(e[1]=a=>W.value=a),"page-size":te.value,"onUpdate:pageSize":e[2]||(e[2]=a=>te.value=a),"page-sizes":[10,20,50,100],total:me.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:P,onCurrentChange:P},null,8,["current-page","page-size","total"])]),_:1}),l(L,{modelValue:X.value,"onUpdate:modelValue":e[11]||(e[11]=a=>X.value=a),title:Te.value,width:"600px",onClose:ce},{footer:t(()=>[l(r,{onClick:e[10]||(e[10]=a=>X.value=!1)},{default:t(()=>[...e[37]||(e[37]=[g("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Oe,loading:ae.value},{default:t(()=>[...e[38]||(e[38]=[g("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(K,{ref_key:"formRef",ref:N,model:v.value,rules:Ae,"label-width":"120px"},{default:t(()=>[l(n,{label:"景区名称",prop:"name"},{default:t(()=>[l(u,{modelValue:v.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value.name=a),placeholder:"请输入景区名称"},null,8,["modelValue"])]),_:1}),re.value?(i(),T(n,{key:0,label:"景区编码",prop:"code"},{default:t(()=>[l(u,{modelValue:v.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.code=a),placeholder:"系统自动生成",disabled:""},null,8,["modelValue"]),e[33]||(e[33]=y("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 景区编码由系统自动生成，不可修改 ",-1))]),_:1})):(i(),T(n,{key:1},{label:t(()=>[...e[34]||(e[34]=[y("span",null,"景区编码",-1)])]),default:t(()=>[l(u,{value:"系统自动生成",disabled:""}),e[35]||(e[35]=y("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 景区编码将在创建时由系统自动生成 ",-1))]),_:1})),l(n,{label:"地址",prop:"address"},{default:t(()=>[l(u,{modelValue:v.value.address,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.address=a),placeholder:"请输入景区地址"},null,8,["modelValue"])]),_:1}),l(n,{label:"联系电话",prop:"contact_phone"},{default:t(()=>[l(u,{modelValue:v.value.contact_phone,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.contact_phone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(n,{label:"软件服务商",prop:"software_provider_ids"},{default:t(()=>[l(U,{modelValue:v.value.software_provider_ids,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value.software_provider_ids=a),placeholder:"请选择软件服务商（可多选）",multiple:"",clearable:"",style:{width:"100%"}},{default:t(()=>[(i(!0),V(E,null,M(Y.value,a=>(i(),T(p,{key:a.id,label:`${a.name} (${a.api_type||"无类型"})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[36]||(e[36]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 一个景区可以选择多个软件服务商，不同产品可以使用不同的服务商 ",-1))]),_:1}),l(n,{label:"描述",prop:"description"},{default:t(()=>[l(u,{modelValue:v.value.description,"onUpdate:modelValue":e[8]||(e[8]=a=>v.value.description=a),type:"textarea",rows:4,placeholder:"请输入景区描述"},null,8,["modelValue"])]),_:1}),l(n,{label:"状态",prop:"is_active"},{default:t(()=>[l(j,{modelValue:v.value.is_active,"onUpdate:modelValue":e[9]||(e[9]=a=>v.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:F.value,"onUpdate:modelValue":e[28]||(e[28]=a=>F.value=a),title:"资源配置",width:"900px",onClose:ne},{footer:t(()=>[l(r,{onClick:e[27]||(e[27]=a=>F.value=!1)},{default:t(()=>[...e[54]||(e[54]=[g("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:je,loading:oe.value},{default:t(()=>[...e[55]||(e[55]=[g("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(R,{title:"重要提示",type:"warning",description:"一个景区可以有多个软件服务商，请为每个服务商单独配置参数。不同OTA平台的订单需要使用不同的用户名和密码。",closable:!1,style:{"margin-bottom":"20px"}}),x.value&&x.value.length>1?(i(),V("div",la,[l(U,{modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=a=>S.value=a),placeholder:"请选择要配置的服务商",style:{width:"100%"},onChange:De},{default:t(()=>[(i(!0),V(E,null,M(x.value,a=>(i(),T(p,{key:a.id,label:`${a.name} (${a.api_type||"无类型"})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):x.value&&x.value.length===1?(i(),V("div",ta,[l(R,{title:`正在配置服务商：${x.value[0].name}`,type:"info",closable:!1},null,8,["title"])])):(i(),T(R,{key:2,title:"该景区尚未配置软件服务商",type:"warning",description:"请先在景区编辑页面添加软件服务商，然后再配置参数。",closable:!1,style:{"margin-bottom":"20px"}})),l(K,{ref_key:"resourceConfigFormRef",ref:G,model:o.value,rules:Ie,"label-width":"140px"},{default:t(()=>[l(n,{label:"认证类型",prop:"auth.type"},{default:t(()=>[l(U,{modelValue:o.value.auth.type,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.auth.type=a),style:{width:"100%"},onChange:Me},{default:t(()=>[l(p,{label:"用户名密码",value:"username_password"}),l(p,{label:"AppKey/Secret",value:"appkey_secret"}),l(p,{label:"Token",value:"token"}),l(p,{label:"自定义参数",value:"custom"})]),_:1},8,["modelValue"]),e[39]||(e[39]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择认证方式，如果接口使用非标准参数名，请选择"自定义参数" ',-1))]),_:1}),o.value.auth.type==="username_password"?(i(),V(E,{key:0},[l(n,{label:"默认用户名",prop:"username"},{default:t(()=>[l(u,{modelValue:o.value.username,"onUpdate:modelValue":e[14]||(e[14]=a=>o.value.username=a),placeholder:"用于库存推送订阅等非订单场景"},null,8,["modelValue"])]),_:1}),l(n,{label:"默认密码",prop:"password"},{default:t(()=>[l(u,{modelValue:o.value.password,"onUpdate:modelValue":e[15]||(e[15]=a=>o.value.password=a),type:"password","show-password":"",placeholder:"用于库存推送订阅等非订单场景"},null,8,["modelValue"])]),_:1})],64)):I("",!0),o.value.auth.type==="appkey_secret"?(i(),V(E,{key:1},[l(n,{label:"AppKey",prop:"auth.appkey"},{default:t(()=>[l(u,{modelValue:o.value.auth.appkey,"onUpdate:modelValue":e[16]||(e[16]=a=>o.value.auth.appkey=a),placeholder:"请输入AppKey"},null,8,["modelValue"])]),_:1}),l(n,{label:"AppSecret",prop:"auth.appsecret"},{default:t(()=>[l(u,{modelValue:o.value.auth.appsecret,"onUpdate:modelValue":e[17]||(e[17]=a=>o.value.auth.appsecret=a),type:"password","show-password":"",placeholder:"请输入AppSecret"},null,8,["modelValue"])]),_:1})],64)):I("",!0),o.value.auth.type==="token"?(i(),T(n,{key:2,label:"Token",prop:"auth.token"},{default:t(()=>[l(u,{modelValue:o.value.auth.token,"onUpdate:modelValue":e[18]||(e[18]=a=>o.value.auth.token=a),type:"password","show-password":"",placeholder:"请输入Token"},null,8,["modelValue"])]),_:1})):I("",!0),o.value.auth.type==="custom"?(i(),V(E,{key:3},[l(n,{label:"参数模板"},{default:t(()=>[l(U,{modelValue:H.value,"onUpdate:modelValue":e[19]||(e[19]=a=>H.value=a),placeholder:"选择参数模板（可选）",clearable:"",style:{width:"100%"},onChange:Ne},{default:t(()=>[l(p,{label:"用户名密码（自定义参数名）",value:"username_password_custom"}),l(p,{label:"AppKey/Secret（自定义参数名）",value:"appkey_secret_custom"}),l(p,{label:"Token（自定义参数名）",value:"token_custom"}),l(p,{label:"空模板",value:"empty"})]),_:1},8,["modelValue"]),e[40]||(e[40]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 选择模板可以快速填充常用参数，也可以手动添加参数 ",-1))]),_:1}),l(n,{label:"自定义参数"},{default:t(()=>[l(h,{data:o.value.auth.params,border:"",style:{width:"100%"}},{default:t(()=>[l(d,{label:"参数名",width:"200"},{default:t(({row:a,$index:k})=>[l(u,{modelValue:a.key,"onUpdate:modelValue":O=>a.key=O,placeholder:"参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(d,{label:"参数值","min-width":"300"},{default:t(({row:a,$index:k})=>[l(u,{modelValue:a.value,"onUpdate:modelValue":O=>a.value=O,type:ye(a.key)?"password":"text","show-password":ye(a.key),placeholder:"参数值"},null,8,["modelValue","onUpdate:modelValue","type","show-password"])]),_:1}),l(d,{label:"操作",width:"100",fixed:"right"},{default:t(({$index:a})=>[l(r,{size:"small",type:"danger",onClick:k=>Le(a)},{default:t(()=>[...e[41]||(e[41]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(r,{type:"primary",size:"small",style:{"margin-top":"10px"},onClick:Ke},{default:t(()=>[...e[42]||(e[42]=[g("添加参数",-1)])]),_:1}),e[43]||(e[43]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 敏感参数（包含password、secret、key、token等关键词）将自动加密存储 ",-1))]),_:1})],64)):I("",!0),l(n,{label:"环境",prop:"environment"},{default:t(()=>[l(U,{modelValue:o.value.environment,"onUpdate:modelValue":e[20]||(e[20]=a=>o.value.environment=a),style:{width:"100%"}},{default:t(()=>[l(p,{label:"生产环境",value:"production"})]),_:1},8,["modelValue"])]),_:1}),l(B,null,{default:t(()=>[...e[44]||(e[44]=[g("API地址配置",-1)])]),_:1}),l(n,{label:"API地址（出站）"},{default:t(()=>{var a;return[l(u,{value:((a=D.value)==null?void 0:a.api_url)||"未配置",disabled:"",placeholder:"API地址从软件服务商配置中获取"},null,8,["value"]),e[45]||(e[45]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 用于系统主动调用第三方系统的API地址（从软件服务商配置中获取） ",-1)),D.value?D.value.api_url?I("",!0):(i(),V("div",sa,' ⚠️ 该服务商尚未配置API地址，请在"软件服务商管理"中配置 ')):(i(),V("div",oa," ⚠️ 请先选择软件服务商 "))]}),_:1}),l(n,{label:"Webhook基础地址（入站）",prop:"webhook_base_url"},{default:t(()=>[l(u,{modelValue:o.value.webhook_base_url,"onUpdate:modelValue":e[21]||(e[21]=a=>o.value.webhook_base_url=a),placeholder:"如：https://api.example.com（可选）",clearable:""},null,8,["modelValue"]),e[46]||(e[46]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 用于第三方系统推送数据到我方系统的回调地址基础URL（不含路径）。如果该景区的酒店不使用PMS推送价库，可以留空。 ",-1)),ve.value?(i(),V("div",ra,[l(R,{title:`完整Webhook地址：${ve.value}`,type:"info",closable:!1},null,8,["title"])])):I("",!0)]),_:1}),l(B,null,{default:t(()=>[...e[47]||(e[47]=[g("同步方式配置",-1)])]),_:1}),l(n,{label:"库存同步方式",prop:"sync_mode.inventory"},{default:t(()=>[l(U,{modelValue:o.value.sync_mode.inventory,"onUpdate:modelValue":e[22]||(e[22]=a=>o.value.sync_mode.inventory=a),style:{width:"100%"}},{default:t(()=>[l(p,{label:"资源方推送",value:"push"}),l(p,{label:"手工维护",value:"manual"})]),_:1},8,["modelValue"]),e[48]||(e[48]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"资源方推送"后，系统将自动接收资源方推送的库存信息 ',-1))]),_:1}),l(n,{label:"价格同步方式",prop:"sync_mode.price"},{default:t(()=>[l(U,{modelValue:o.value.sync_mode.price,"onUpdate:modelValue":e[23]||(e[23]=a=>o.value.sync_mode.price=a),style:{width:"100%"}},{default:t(()=>[l(p,{label:"资源方推送",value:"push"}),l(p,{label:"手工维护",value:"manual"})]),_:1},8,["modelValue"]),e[49]||(e[49]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"资源方推送"后，系统将自动接收资源方推送的价格信息 ',-1))]),_:1}),l(n,{label:"订单处理方式",prop:"sync_mode.order"},{default:t(()=>[l(U,{modelValue:o.value.sync_mode.order,"onUpdate:modelValue":e[24]||(e[24]=a=>o.value.sync_mode.order=a),style:{width:"100%"}},{default:t(()=>[l(p,{label:"系统直连",value:"auto"}),l(p,{label:"手工操作",value:"manual"}),l(p,{label:"其他系统",value:"other"})]),_:1},8,["modelValue"]),e[50]||(e[50]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"系统直连"后，订单将自动调用资源方接口；如果库存推送和订单下发使用不同的服务商，请在下方配置订单下发服务商 ',-1))]),_:1}),o.value.sync_mode.order==="auto"||o.value.sync_mode.order==="other"?(i(),T(n,{key:4,label:"订单下发服务商",prop:"order_provider"},{default:t(()=>[l(U,{modelValue:o.value.order_provider,"onUpdate:modelValue":e[25]||(e[25]=a=>o.value.order_provider=a),placeholder:"请选择订单下发服务商（可选）",clearable:"",style:{width:"100%"}},{default:t(()=>[(i(!0),V(E,null,M(Y.value,a=>(i(),T(p,{key:a.id,label:`${a.name} (${a.api_type||"无类型"})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[51]||(e[51]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},[g(" 如果库存推送和订单下发使用不同的服务商，请在此选择订单下发服务商。留空则使用产品配置的服务商。 "),y("br"),g(" 例如：库存推送使用横店，订单下发使用自我游，则在此选择自我游服务商。 ")],-1))]),_:1})):I("",!0),l(B,null,{default:t(()=>[...e[52]||(e[52]=[g("OTA平台认证信息",-1)])]),_:1}),(i(!0),V(E,null,M(pe.value,a=>(i(),T(n,{key:a.id,label:`${a.name}认证信息`},{default:t(()=>[y("div",na,[l(u,{modelValue:o.value.credentials[a.code].username,"onUpdate:modelValue":k=>o.value.credentials[a.code].username=k,placeholder:"用户名",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(u,{modelValue:o.value.credentials[a.code].password,"onUpdate:modelValue":k=>o.value.credentials[a.code].password=k,type:"password",placeholder:"密码",style:{flex:"1"},"show-password":""},null,8,["modelValue","onUpdate:modelValue"])]),e[53]||(e[53]=y("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 该平台订单将使用此认证信息调用资源方接口 ",-1))]),_:2},1032,["label"]))),128)),l(n,{label:"状态",prop:"is_active"},{default:t(()=>[l(j,{modelValue:o.value.is_active,"onUpdate:modelValue":e[26]||(e[26]=a=>o.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pa=We(ua,[["__scopeId","data-v-08389e99"]]);export{pa as default};
