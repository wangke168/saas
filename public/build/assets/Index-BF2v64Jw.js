import{_ as _e,u as ve,r,A as G,i as me,c as E,o as f,f as q,b as a,w as o,d as u,k as V,E as y,e as fe,l as ge,m as be,h as c,F as N,p as R,q as F,y as he,B as Ve,t as C,v as ye}from"./app-BrfGEasZ.js";const xe={style:{"margin-bottom":"20px"}},we={__name:"Index",setup(Se){const J=fe(),k=ve(),A=r([]),x=r([]),w=r([]),I=r(!1),M=r(!1),b=r(!1),U=r(null),$=r(""),z=r(null),B=r(null),S=r(1),H=r(15),j=r(0),D=r(null),P=G(()=>D.value!==null),O=G(()=>P.value?"编辑打包酒店":"创建打包酒店"),n=r({scenic_spot_id:null,software_provider_id:null,name:"",code:"",external_hotel_id:"",address:"",contact_phone:"",description:"",is_active:!0}),Q={scenic_spot_id:[{required:!0,message:"请选择所属景区",trigger:"change"}],name:[{required:!0,message:"请输入酒店名称",trigger:"blur"},{max:255,message:"酒店名称不能超过255个字符",trigger:"blur"}]},g=async()=>{I.value=!0;try{const t={page:S.value,per_page:H.value};z.value&&(t.scenic_spot_id=z.value),B.value!==null&&(t.is_active=B.value),$.value&&(t.search=$.value);const e=await V.get("/res-hotels",{params:t});A.value=e.data.data||[],j.value=e.data.total||0}catch(t){y.error("获取打包酒店列表失败"),console.error(t)}finally{I.value=!1}},W=async()=>{var t,e,s;try{if(((t=k.user)==null?void 0:t.role)!=="admin")x.value=((e=k.user)==null?void 0:e.scenic_spots)||[];else{const d=await V.get("/scenic-spots");x.value=d.data.data||[]}}catch(d){console.error("获取景区列表失败",d),(s=k.user)!=null&&s.scenic_spots&&(x.value=k.user.scenic_spots)}},X=async()=>{w.value=[]},K=async t=>{if(n.value.software_provider_id=null,!t){w.value=[];return}try{const s=(await V.get(`/scenic-spots/${t}`)).data.data;w.value=s.software_providers||[]}catch(e){console.error("获取景区服务商列表失败",e),w.value=[]}},Z=()=>{S.value=1,g()},L=()=>{S.value=1,g()},ee=()=>{D.value=null,Y(),b.value=!0},le=t=>{J.push(`/res-hotels/${t.id}`)},ae=async t=>{D.value=t.id,t.scenic_spot_id&&await K(t.scenic_spot_id),n.value={scenic_spot_id:t.scenic_spot_id,software_provider_id:t.software_provider_id||null,name:t.name,code:t.code,external_hotel_id:t.external_hotel_id||"",address:t.address||"",contact_phone:t.contact_phone||"",description:t.description||"",is_active:t.is_active},b.value=!0},te=async()=>{U.value&&await U.value.validate(async t=>{var e,s,d,_,h,p;if(t){M.value=!0;try{P.value?(await V.put(`/res-hotels/${D.value}`,n.value),y.success("打包酒店更新成功")):(await V.post("/res-hotels",n.value),y.success("打包酒店创建成功")),b.value=!1,g()}catch(i){const T=((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.message)||((p=(h=(_=(d=i.response)==null?void 0:d.data)==null?void 0:_.errors)==null?void 0:h.code)==null?void 0:p[0])||"操作失败";y.error(T)}finally{M.value=!1}}})},oe=async t=>{try{await ye.confirm(`确定要删除打包酒店"${t.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await V.delete(`/res-hotels/${t.id}`),y.success("删除成功"),g()}catch(e){e!=="cancel"&&(y.error("删除失败"),console.error(e))}},Y=()=>{var t;n.value={scenic_spot_id:null,software_provider_id:null,name:"",code:"",external_hotel_id:"",address:"",contact_phone:"",description:"",is_active:!0},(t=U.value)==null||t.clearValidate()},ne=t=>{if(!t)return"";const e=new Date(t),s=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0"),h=String(e.getHours()).padStart(2,"0"),p=String(e.getMinutes()).padStart(2,"0");return`${s}-${d}-${_} ${h}:${p}`};return me(()=>{g(),W(),X()}),(t,e)=>{const s=u("el-button"),d=u("el-option"),_=u("el-select"),h=u("el-icon"),p=u("el-input"),i=u("el-table-column"),T=u("el-tag"),se=u("el-table"),re=u("el-pagination"),de=u("el-card"),v=u("el-form-item"),ue=u("el-switch"),ie=u("el-form"),pe=u("el-dialog"),ce=ge("loading");return f(),E("div",null,[e[23]||(e[23]=q("h2",null,"打包酒店管理",-1)),a(de,null,{default:o(()=>[q("div",xe,[a(s,{type:"primary",onClick:ee},{default:o(()=>[...e[16]||(e[16]=[c("创建打包酒店",-1)])]),_:1}),a(_,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=l=>z.value=l),placeholder:"筛选景区",clearable:"",style:{width:"200px","margin-left":"10px"},onChange:L},{default:o(()=>[(f(!0),E(N,null,R(x.value,l=>(f(),F(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(_,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=l=>B.value=l),placeholder:"筛选状态",clearable:"",style:{width:"150px","margin-left":"10px"},onChange:L},{default:o(()=>[a(d,{label:"启用",value:!0}),a(d,{label:"禁用",value:!1})]),_:1},8,["modelValue"]),a(p,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=l=>$.value=l),placeholder:"搜索酒店名称或外部编号",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:Z},{prefix:o(()=>[a(h,null,{default:o(()=>[a(he(Ve))]),_:1})]),_:1},8,["modelValue"])]),be((f(),F(se,{data:A.value,border:""},{default:o(()=>[a(i,{prop:"name",label:"酒店名称",width:"200"}),a(i,{prop:"code",label:"酒店编码",width:"150"}),a(i,{prop:"external_hotel_id",label:"外部酒店编号",width:"150"},{default:o(({row:l})=>[c(C(l.external_hotel_id||"-"),1)]),_:1}),a(i,{label:"所属景区",width:"150"},{default:o(({row:l})=>{var m;return[c(C(((m=l.scenic_spot)==null?void 0:m.name)||"-"),1)]}),_:1}),a(i,{label:"软件服务商",width:"150"},{default:o(({row:l})=>{var m;return[c(C(((m=l.software_provider)==null?void 0:m.name)||"-"),1)]}),_:1}),a(i,{prop:"address",label:"地址","show-overflow-tooltip":""}),a(i,{prop:"contact_phone",label:"联系电话",width:"150"}),a(i,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:l})=>[a(T,{type:l.is_active?"success":"danger"},{default:o(()=>[c(C(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:l})=>[c(C(ne(l.created_at)),1)]),_:1}),a(i,{label:"操作",width:"250",fixed:"right"},{default:o(({row:l})=>[a(s,{size:"small",type:"primary",onClick:m=>le(l)},{default:o(()=>[...e[17]||(e[17]=[c("查看详情",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",onClick:m=>ae(l)},{default:o(()=>[...e[18]||(e[18]=[c("编辑",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"danger",onClick:m=>oe(l)},{default:o(()=>[...e[19]||(e[19]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,I.value]]),a(re,{"current-page":S.value,"onUpdate:currentPage":e[3]||(e[3]=l=>S.value=l),"page-size":H.value,"onUpdate:pageSize":e[4]||(e[4]=l=>H.value=l),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),a(pe,{modelValue:b.value,"onUpdate:modelValue":e[15]||(e[15]=l=>b.value=l),title:O.value,width:"600px",onClose:Y},{footer:o(()=>[a(s,{onClick:e[14]||(e[14]=l=>b.value=!1)},{default:o(()=>[...e[21]||(e[21]=[c("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:te,loading:M.value},{default:o(()=>[...e[22]||(e[22]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(ie,{ref_key:"formRef",ref:U,model:n.value,rules:Q,"label-width":"120px"},{default:o(()=>[a(v,{label:"所属景区",prop:"scenic_spot_id"},{default:o(()=>[a(_,{modelValue:n.value.scenic_spot_id,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.scenic_spot_id=l),placeholder:"请选择景区",style:{width:"100%"},disabled:P.value,onChange:K},{default:o(()=>[(f(!0),E(N,null,R(x.value,l=>(f(),F(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(v,{label:"酒店名称",prop:"name"},{default:o(()=>[a(p,{modelValue:n.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.name=l),placeholder:"请输入酒店名称"},null,8,["modelValue"])]),_:1}),a(v,{label:"酒店编码",prop:"code"},{default:o(()=>[a(p,{modelValue:n.value.code,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.code=l),placeholder:"系统自动生成",disabled:!0},null,8,["modelValue"]),e[20]||(e[20]=q("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 酒店编码由系统自动生成，格式：H + 5位数字（如 H00001） ",-1))]),_:1}),a(v,{label:"外部酒店编号",prop:"external_hotel_id"},{default:o(()=>[a(p,{modelValue:n.value.external_hotel_id,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.external_hotel_id=l),placeholder:"用于资源方系统对接的酒店编号（可选）"},null,8,["modelValue"])]),_:1}),a(v,{label:"软件服务商",prop:"software_provider_id"},{default:o(()=>[a(_,{modelValue:n.value.software_provider_id,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.software_provider_id=l),placeholder:"请选择软件服务商（可选）",clearable:"",style:{width:"100%"}},{default:o(()=>[(f(!0),E(N,null,R(w.value,l=>(f(),F(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"地址",prop:"address"},{default:o(()=>[a(p,{modelValue:n.value.address,"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.address=l),placeholder:"请输入酒店地址"},null,8,["modelValue"])]),_:1}),a(v,{label:"联系电话",prop:"contact_phone"},{default:o(()=>[a(p,{modelValue:n.value.contact_phone,"onUpdate:modelValue":e[11]||(e[11]=l=>n.value.contact_phone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(v,{label:"描述",prop:"description"},{default:o(()=>[a(p,{modelValue:n.value.description,"onUpdate:modelValue":e[12]||(e[12]=l=>n.value.description=l),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),a(v,{label:"状态",prop:"is_active"},{default:o(()=>[a(ue,{modelValue:n.value.is_active,"onUpdate:modelValue":e[13]||(e[13]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=_e(we,[["__scopeId","data-v-bd7c96ab"]]);export{ke as default};
