import{_ as W,r as B,i as X,c as y,o as p,b as t,w as e,d as m,k as x,x as Y,E as _,e as Z,l as ee,m as te,s as C,h as r,t as i,f as g,y as ae,z as se,q as I,v as $}from"./app-R4Sboner.js";const le={class:"pkg-order-detail-container"},ne={class:"card-header"},oe={class:"order-detail"},re={key:0,class:"detail-content"},ie={style:{display:"flex","align-items":"center",gap:"8px"}},de={class:"item-status-summary"},ue={key:0},ce={key:1,style:{color:"#909399"}},pe={key:0},_e={key:1,style:{color:"#909399"}},fe={__name:"Detail",setup(me){const E=Y(),S=Z(),o=B(null),D=B(!1),f=B({}),h=async()=>{D.value=!0;try{const a=await x.get(`/pkg-orders/${E.params.id}`);o.value=a.data}catch{_.error("获取打包订单详情失败")}finally{D.value=!1}},L=()=>{S.push("/pkg-orders")},k=a=>!a&&a!==0?"0.00":parseFloat(a).toFixed(2),z=a=>a?typeof a=="string"?a.split("T")[0]:a:"",T=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",V=a=>({paid:"warning",confirmed:"success",failed:"danger",cancelled:"info"})[a]||"",q=a=>({paid:"已支付",confirmed:"已确认",failed:"失败",cancelled:"已取消"})[a]||a,N=a=>({TICKET:"primary",HOTEL:"success"})[a]||"",O=a=>({TICKET:"门票",HOTEL:"酒店"})[a]||a,H=a=>({pending:"info",processing:"warning",success:"success",failed:"danger",pending_manual:"warning"})[a]||"",R=a=>({pending:"待处理",processing:"处理中",success:"成功",failed:"失败",pending_manual:"待人工处理"})[a]||a,A=a=>({paid:"已支付，等待订单项处理",confirmed:"所有订单项已成功，订单已确认",failed:"部分或全部订单项失败",cancelled:"订单已取消"})[a]||"",w=a=>{var s;return(s=o.value)!=null&&s.items?o.value.items.filter(d=>d.status===a).length:0},F=a=>{var l;if(!((l=o.value)!=null&&l.check_in_date))return!1;const s=new Date(o.value.check_in_date),d=new Date;return d.setHours(0,0,0,0),s<=d},K=async a=>{var s,d;try{await $.confirm("确定要接单吗？系统将尝试调用资源方接口接单。","接单确认",{type:"info",confirmButtonText:"确定",cancelButtonText:"取消"}),f.value[a.id]="confirm";const l=await x.post(`/api/pkg-orders/${o.value.id}/items/${a.id}/confirm`);l.data.success?(_.success("接单成功"),h()):_.error(l.data.message||"接单失败")}catch(l){if(l!=="cancel"){const u=((d=(s=l.response)==null?void 0:s.data)==null?void 0:d.message)||"接单失败";_.error(u)}}finally{f.value[a.id]=null}},P=async a=>{var s,d;try{const l={use_date:o.value.check_in_date,use_quantity:a.quantity,passengers:[]};await $.confirm("确定要核销该订单项吗？","核销确认",{type:"info",confirmButtonText:"确定",cancelButtonText:"取消"}),f.value[a.id]="verify";const u=await x.post(`/api/pkg-orders/${o.value.id}/items/${a.id}/verify`,l);u.data.success?(_.success("核销成功"),h()):_.error(u.data.message||"核销失败")}catch(l){if(l!=="cancel"){const u=((d=(s=l.response)==null?void 0:s.data)==null?void 0:d.message)||"核销失败";_.error(u)}}finally{f.value[a.id]=null}},j=async a=>{var s,d;try{await $.confirm("确定要重试吗？系统将重新处理该订单项。","重试确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),f.value[a.id]="retry";const l=await x.post(`/api/pkg-orders/${o.value.id}/items/${a.id}/retry`);l.data.success?(_.success("已重新提交处理任务"),h()):_.error(l.data.message||"重试失败")}catch(l){if(l!=="cancel"){const u=((d=(s=l.response)==null?void 0:s.data)==null?void 0:d.message)||"重试失败";_.error(u)}}finally{f.value[a.id]=null}};return X(()=>{h()}),(a,s)=>{const d=m("el-button"),l=m("el-descriptions-item"),u=m("el-tag"),G=m("el-icon"),J=m("el-tooltip"),M=m("el-descriptions"),v=m("el-card"),c=m("el-table-column"),Q=m("el-table"),U=ee("loading");return p(),y("div",le,[t(v,null,{header:e(()=>[g("div",ne,[s[1]||(s[1]=g("span",null,"打包订单详情",-1)),t(d,{onClick:L},{default:e(()=>[...s[0]||(s[0]=[r("返回列表",-1)])]),_:1})])]),default:e(()=>[te((p(),y("div",oe,[o.value?(p(),y("div",re,[t(v,{class:"info-card"},{header:e(()=>[...s[2]||(s[2]=[g("h3",null,"订单基本信息",-1)])]),default:e(()=>[t(M,{column:2,border:""},{default:e(()=>[t(l,{label:"订单号"},{default:e(()=>[r(i(o.value.order_no),1)]),_:1}),t(l,{label:"OTA订单号"},{default:e(()=>[r(i(o.value.ota_order_no||"-"),1)]),_:1}),t(l,{label:"订单状态"},{default:e(()=>[g("div",ie,[t(u,{type:V(o.value.status)},{default:e(()=>[r(i(q(o.value.status)),1)]),_:1},8,["type"]),t(J,{content:A(o.value.status),placement:"top"},{default:e(()=>[t(G,{class:"status-help-icon",style:{cursor:"help",color:"#909399"}},{default:e(()=>[t(ae(se))]),_:1})]),_:1},8,["content"])])]),_:1}),t(l,{label:"订单项状态"},{default:e(()=>[g("div",de,[t(u,{type:"success",size:"small"},{default:e(()=>[r("成功: "+i(w("success")),1)]),_:1}),t(u,{type:"danger",size:"small",style:{"margin-left":"8px"}},{default:e(()=>[r("失败: "+i(w("failed")),1)]),_:1}),t(u,{type:"warning",size:"small",style:{"margin-left":"8px"}},{default:e(()=>[r("待处理: "+i(w("pending")),1)]),_:1}),t(u,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:e(()=>[r("处理中: "+i(w("processing")),1)]),_:1})])]),_:1}),t(l,{label:"OTA平台"},{default:e(()=>{var n;return[r(i(((n=o.value.ota_platform)==null?void 0:n.name)||"-"),1)]}),_:1}),t(l,{label:"打包产品"},{default:e(()=>{var n;return[r(i(((n=o.value.product)==null?void 0:n.product_name)||"-"),1)]}),_:1}),t(l,{label:"景区"},{default:e(()=>{var n,b;return[r(i(((b=(n=o.value.product)==null?void 0:n.scenic_spot)==null?void 0:b.name)||"-"),1)]}),_:1}),t(l,{label:"订单总额"},{default:e(()=>[r(" ¥"+i(k(o.value.total_amount)),1)]),_:1}),t(l,{label:"结算金额"},{default:e(()=>[r(" ¥"+i(k(o.value.settlement_amount)),1)]),_:1}),t(l,{label:"下单时间"},{default:e(()=>[r(i(T(o.value.created_at)),1)]),_:1}),t(l,{label:"支付时间"},{default:e(()=>[r(i(T(o.value.paid_at)),1)]),_:1}),t(l,{label:"确认时间"},{default:e(()=>[r(i(T(o.value.confirmed_at)),1)]),_:1})]),_:1})]),_:1}),t(v,{class:"info-card"},{header:e(()=>[...s[3]||(s[3]=[g("h3",null,"酒店信息",-1)])]),default:e(()=>[t(M,{column:2,border:""},{default:e(()=>[t(l,{label:"酒店名称"},{default:e(()=>{var n;return[r(i(((n=o.value.hotel)==null?void 0:n.name)||"-"),1)]}),_:1}),t(l,{label:"房型名称"},{default:e(()=>{var n;return[r(i(((n=o.value.room_type)==null?void 0:n.name)||"-"),1)]}),_:1}),t(l,{label:"入住日期"},{default:e(()=>[r(i(z(o.value.check_in_date)),1)]),_:1}),t(l,{label:"离店日期"},{default:e(()=>[r(i(z(o.value.check_out_date)),1)]),_:1}),t(l,{label:"入住天数"},{default:e(()=>[r(i(o.value.stay_days)+" 天 ",1)]),_:1})]),_:1})]),_:1}),t(v,{class:"info-card"},{header:e(()=>[...s[4]||(s[4]=[g("h3",null,"联系人信息",-1)])]),default:e(()=>[t(M,{column:2,border:""},{default:e(()=>[t(l,{label:"联系人姓名"},{default:e(()=>[r(i(o.value.contact_name||"-"),1)]),_:1}),t(l,{label:"联系电话"},{default:e(()=>[r(i(o.value.contact_phone||"-"),1)]),_:1}),t(l,{label:"联系邮箱"},{default:e(()=>[r(i(o.value.contact_email||"-"),1)]),_:1})]),_:1})]),_:1}),t(v,{class:"info-card"},{header:e(()=>[...s[5]||(s[5]=[g("h3",null,"订单项列表",-1)])]),default:e(()=>[t(Q,{data:o.value.items,style:{width:"100%"},border:""},{default:e(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{label:"类型",width:"100"},{default:e(({row:n})=>[t(u,{type:N(n.item_type)},{default:e(()=>[r(i(O(n.item_type)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"resource_name",label:"资源名称","min-width":"200"}),t(c,{prop:"quantity",label:"数量",width:"80"}),t(c,{label:"单价",width:"120",align:"right"},{default:e(({row:n})=>[n.unit_price?(p(),y("span",ue," ¥"+i(k(n.unit_price)),1)):(p(),y("span",ce,"-"))]),_:1}),t(c,{label:"总价",width:"120",align:"right"},{default:e(({row:n})=>[n.total_price?(p(),y("span",pe," ¥"+i(k(n.total_price)),1)):(p(),y("span",_e,"-"))]),_:1}),t(c,{label:"状态",width:"120"},{default:e(({row:n})=>[t(u,{type:H(n.status)},{default:e(()=>[r(i(R(n.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"resource_order_no",label:"资源方订单号","min-width":"180"}),t(c,{prop:"error_message",label:"错误信息","min-width":"200","show-overflow-tooltip":""}),t(c,{prop:"processed_at",label:"处理时间",width:"180"},{default:e(({row:n})=>[r(i(T(n.processed_at)),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:e(({row:n})=>[n.status==="pending"?(p(),I(d,{key:0,type:"primary",size:"small",onClick:b=>K(n),loading:f.value[n.id]==="confirm"},{default:e(()=>[...s[6]||(s[6]=[r(" 接单 ",-1)])]),_:1},8,["onClick","loading"])):C("",!0),n.status==="success"&&F(n)?(p(),I(d,{key:1,type:"success",size:"small",onClick:b=>P(n),loading:f.value[n.id]==="verify"},{default:e(()=>[...s[7]||(s[7]=[r(" 核销 ",-1)])]),_:1},8,["onClick","loading"])):C("",!0),n.status==="failed"?(p(),I(d,{key:2,type:"warning",size:"small",onClick:b=>j(n),loading:f.value[n.id]==="retry"},{default:e(()=>[...s[8]||(s[8]=[r(" 重试 ",-1)])]),_:1},8,["onClick","loading"])):C("",!0)]),_:1})]),_:1},8,["data"])]),_:1})])):C("",!0)])),[[U,D.value]])]),_:1})])}}},ye=W(fe,[["__scopeId","data-v-f54871e1"]]);export{ye as default};
