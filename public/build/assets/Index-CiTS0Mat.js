import{_ as ml,u as cl,r as s,A as ee,i as yl,c as Ce,o as R,f as q,b as l,w as t,d as _,k as V,E as v,l as fl,m as qe,h as d,F as $e,p as Se,q as L,y as gl,B as _l,t as x,v as De}from"./app-JTASQpWe.js";const bl={style:{"margin-bottom":"20px"}},Vl={style:{"margin-bottom":"20px"}},xl={style:{"margin-left":"20px",color:"#909399"}},Cl={style:{"margin-bottom":"20px"}},ql={style:{"margin-right":"20px"}},wl={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},kl={__name:"Index",setup(hl){const N=cl(),we=s([]),B=s([]),le=s(!1),ae=s(!1),$=s(!1),j=s(null),O=s(""),Z=s(null),E=s(1),te=s(15),ke=s(0),K=s(null),oe=s(!1),ne=s([]),ue=s(!1),S=s(null),D=s(!1),Y=s(null),se=s(!1),P=s(null),ie=s(!1),re=s([]),de=s(!1),C=s(null),U=s(null),A=s(!1),G=s(null),pe=s(!1),M=s(!1),J=s(null),ve=s(!1),Q=s(null),me=s({}),z=s(1),ce=s(30),ye=s(0),fe=ee(()=>K.value!==null),Fe=ee(()=>fe.value?"编辑酒店":"创建酒店"),he=ee(()=>P.value!==null),Be=ee(()=>he.value?"编辑房型":"添加房型"),m=s({scenic_spot_id:null,name:"",code:"",external_code:"",address:"",contact_phone:"",is_connected:!1,is_active:!0}),g=s({name:"",code:"",external_code:"",max_occupancy:2,description:"",is_active:!0}),w=s({dateRange:null,total_quantity:0,available_quantity:0}),b=s({date:null,total_quantity:0,available_quantity:0,source:"manual"}),Ee={scenic_spot_id:[{required:!0,message:"请选择所属景区",trigger:"change"}],name:[{required:!0,message:"请输入酒店名称",trigger:"blur"},{max:255,message:"酒店名称不能超过255个字符",trigger:"blur"}],code:[{pattern:/^[a-zA-Z0-9_-]+$/,message:"酒店编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}]},Pe={name:[{required:!0,message:"请输入房型名称",trigger:"blur"}],code:[{pattern:/^[a-zA-Z0-9_-]+$/,message:"房型编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],max_occupancy:[{required:!0,message:"请输入最大入住人数",trigger:"blur"},{type:"number",min:1,message:"最大入住人数至少为1",trigger:"blur"}]},Ae={dateRange:[{required:!0,message:"请选择日期范围",trigger:"change"}],total_quantity:[{required:!0,message:"请输入总库存",trigger:"blur"},{type:"number",min:0,message:"总库存不能小于0",trigger:"blur"}],available_quantity:[{required:!0,message:"请输入可用库存",trigger:"blur"},{type:"number",min:0,message:"可用库存不能小于0",trigger:"blur"}]},Me={total_quantity:[{required:!0,message:"请输入总库存",trigger:"blur"},{type:"number",min:0,message:"总库存不能小于0",trigger:"blur"}],available_quantity:[{required:!0,message:"请输入可用库存",trigger:"blur"},{type:"number",min:0,message:"可用库存不能小于0",trigger:"blur"}]},T=async()=>{le.value=!0;try{const a={page:E.value,per_page:te.value};Z.value&&(a.scenic_spot_id=Z.value),O.value&&(a.search=O.value);const e=await V.get("/hotels",{params:a});we.value=e.data.data||[],ke.value=e.data.total||0}catch(a){v.error("获取酒店列表失败"),console.error(a)}finally{le.value=!1}},He=async()=>{var a,e,u;try{if(((a=N.user)==null?void 0:a.role)!=="admin")B.value=((e=N.user)==null?void 0:e.scenic_spots)||[];else{const p=await V.get("/scenic-spots");B.value=p.data.data||[]}}catch(p){console.error("获取景区列表失败",p),(u=N.user)!=null&&u.scenic_spots&&(B.value=N.user.scenic_spots)}},Le=()=>{E.value=1,T()},Ne=()=>{E.value=1,T()},je=()=>{K.value=null,Re(),$.value=!0},Oe=a=>{K.value=a.id,m.value={scenic_spot_id:a.scenic_spot_id,name:a.name,code:a.code,external_code:a.external_code||"",address:a.address||"",contact_phone:a.contact_phone||"",is_connected:a.is_connected||!1,is_active:a.is_active},$.value=!0},Ze=async()=>{j.value&&await j.value.validate(async a=>{var e,u,p,f,k,c;if(a){ae.value=!0;try{fe.value?(await V.put(`/hotels/${K.value}`,m.value),v.success("酒店更新成功")):(await V.post("/hotels",m.value),v.success("酒店创建成功")),$.value=!1,T()}catch(r){const h=((u=(e=r.response)==null?void 0:e.data)==null?void 0:u.message)||((c=(k=(f=(p=r.response)==null?void 0:p.data)==null?void 0:f.errors)==null?void 0:k.code)==null?void 0:c[0])||"操作失败";v.error(h)}finally{ae.value=!1}}})},Ke=async a=>{try{await De.confirm(`确定要删除酒店"${a.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await V.delete(`/hotels/${a.id}`),v.success("删除成功"),T()}catch(e){e!=="cancel"&&(v.error("删除失败"),console.error(e))}},Re=()=>{var a;m.value={scenic_spot_id:null,name:"",code:"",external_code:"",address:"",contact_phone:"",is_connected:!1,is_active:!0},(a=j.value)==null||a.clearValidate()},Ye=async a=>{S.value=a,oe.value=!0,await ge(a.id)},ge=async a=>{ue.value=!0;try{const e=await V.get("/room-types",{params:{hotel_id:a}});ne.value=e.data.data||[]}catch(e){v.error("获取房型列表失败"),console.error(e)}finally{ue.value=!1}},Ge=()=>{P.value=null,Ue(),D.value=!0},Je=a=>{P.value=a.id,g.value={name:a.name,code:a.code,external_code:a.external_code||"",max_occupancy:a.max_occupancy||2,description:a.description||"",is_active:a.is_active},D.value=!0},Qe=async()=>{Y.value&&await Y.value.validate(async a=>{var e,u,p,f,k,c;if(a){se.value=!0;try{const r={...g.value,hotel_id:S.value.id};he.value?(await V.put(`/room-types/${P.value}`,r),v.success("房型更新成功")):(await V.post("/room-types",r),v.success("房型创建成功")),D.value=!1,await ge(S.value.id)}catch(r){const h=((u=(e=r.response)==null?void 0:e.data)==null?void 0:u.message)||((c=(k=(f=(p=r.response)==null?void 0:p.data)==null?void 0:f.errors)==null?void 0:k.code)==null?void 0:c[0])||"操作失败";v.error(h)}finally{se.value=!1}}})},We=async a=>{try{await De.confirm(`确定要删除房型"${a.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await V.delete(`/room-types/${a.id}`),v.success("删除成功"),await ge(S.value.id)}catch(e){e!=="cancel"&&(v.error("删除失败"),console.error(e))}},Ue=()=>{var a;g.value={name:"",code:"",external_code:"",max_occupancy:2,description:"",is_active:!0},(a=Y.value)==null||a.clearValidate()},Xe=()=>{S.value=null,ne.value=[],P.value=null},el=async a=>{C.value=a,z.value=1,ie.value=!0,await I(a.id)},I=async a=>{de.value=!0;try{const e={room_type_id:a,page:z.value,per_page:ce.value};U.value&&U.value.length===2&&(e.start_date=W(U.value[0]),e.end_date=W(U.value[1]));const u=await V.get("/inventories",{params:e});re.value=u.data.data||[],ye.value=u.data.total||0}catch(e){v.error("获取库存列表失败"),console.error(e)}finally{de.value=!1}},ll=()=>{z.value=1,C.value&&I(C.value.id)},al=()=>{C.value&&I(C.value.id)},tl=()=>{z.value=1,C.value&&I(C.value.id)},ol=()=>{ze(),A.value=!0},nl=async()=>{G.value&&await G.value.validate(async a=>{var e,u;if(a){pe.value=!0;try{const[p,f]=w.value.dateRange,k=[],c=new Date(p),r=new Date(f);for(;c<=r;)k.push({date:W(c),total_quantity:w.value.total_quantity,available_quantity:w.value.available_quantity}),c.setDate(c.getDate()+1);await V.post("/inventories",{room_type_id:C.value.id,inventories:k}),v.success("批量添加库存成功"),A.value=!1,await I(C.value.id)}catch(p){const f=((u=(e=p.response)==null?void 0:e.data)==null?void 0:u.message)||"操作失败";v.error(f)}finally{pe.value=!1}}})},ul=a=>{if(a.source==="api"){v.warning("接口推送的库存不可编辑");return}Q.value=a.id,b.value={date:a.date,total_quantity:a.total_quantity,available_quantity:a.available_quantity,source:a.source},M.value=!0},sl=async()=>{J.value&&await J.value.validate(async a=>{var e,u;if(a){ve.value=!0;try{await V.put(`/inventories/${Q.value}`,{total_quantity:b.value.total_quantity,available_quantity:b.value.available_quantity}),v.success("库存更新成功"),M.value=!1,await I(C.value.id)}catch(p){const f=((u=(e=p.response)==null?void 0:e.data)==null?void 0:u.message)||"操作失败";v.error(f)}finally{ve.value=!1}}})},il=async a=>{try{const e=a.is_closed?"open":"close";await V.post(`/inventories/${a.id}/${e}`),v.success(a.is_closed?"库存已开启":"库存已关闭"),await I(C.value.id)}catch(e){v.error("操作失败"),console.error(e)}},rl=async a=>{var e,u;try{me.value[a.id]=!0;const p=await V.post(`/inventories/${a.id}/push-to-ota`);p.data.success?v.success("推送任务已提交，正在后台处理中"):v.error(p.data.message||"推送失败")}catch(p){const f=((u=(e=p.response)==null?void 0:e.data)==null?void 0:u.message)||"推送失败";v.error(f),console.error(p)}finally{me.value[a.id]=!1}},ze=()=>{var a;w.value={dateRange:null,total_quantity:0,available_quantity:0},(a=G.value)==null||a.clearValidate()},dl=()=>{var a;b.value={date:null,total_quantity:0,available_quantity:0,source:"manual"},(a=J.value)==null||a.clearValidate(),Q.value=null},pl=()=>{C.value=null,re.value=[],U.value=null,Q.value=null,z.value=1,ye.value=0},W=a=>{if(!a)return"";const e=new Date(a),u=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${u}-${p}-${f}`};return yl(()=>{T(),He()}),(a,e)=>{const u=_("el-button"),p=_("el-option"),f=_("el-select"),k=_("el-icon"),c=_("el-input"),r=_("el-table-column"),h=_("el-tag"),_e=_("el-table"),Te=_("el-pagination"),vl=_("el-card"),y=_("el-form-item"),be=_("el-switch"),X=_("el-form"),F=_("el-dialog"),H=_("el-input-number"),Ve=_("el-date-picker"),xe=fl("loading");return R(),Ce("div",null,[e[61]||(e[61]=q("h2",null,"酒店管理",-1)),l(vl,null,{default:t(()=>[q("div",bl,[l(u,{type:"primary",onClick:je},{default:t(()=>[...e[37]||(e[37]=[d("创建酒店",-1)])]),_:1}),l(f,{modelValue:Z.value,"onUpdate:modelValue":e[0]||(e[0]=o=>Z.value=o),placeholder:"筛选景区",clearable:"",style:{width:"200px","margin-left":"10px"},onChange:Ne},{default:t(()=>[(R(!0),Ce($e,null,Se(B.value,o=>(R(),L(p,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(c,{modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=o=>O.value=o),placeholder:"搜索酒店名称、编码或外部编号",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:Le},{prefix:t(()=>[l(k,null,{default:t(()=>[l(gl(_l))]),_:1})]),_:1},8,["modelValue"])]),qe((R(),L(_e,{data:we.value,border:""},{default:t(()=>[l(r,{prop:"name",label:"酒店名称",width:"200"}),l(r,{prop:"code",label:"酒店编码",width:"150"}),l(r,{prop:"external_code",label:"外部酒店编号",width:"150"},{default:t(({row:o})=>[d(x(o.external_code||"-"),1)]),_:1}),l(r,{label:"所属景区",width:"150"},{default:t(({row:o})=>{var i;return[d(x(((i=o.scenic_spot)==null?void 0:i.name)||"-"),1)]}),_:1}),l(r,{prop:"address",label:"地址","show-overflow-tooltip":""}),l(r,{prop:"contact_phone",label:"联系电话",width:"150"}),l(r,{label:"系统服务商",width:"150"},{default:t(({row:o})=>{var i,n;return[d(x(((n=(i=o.scenic_spot)==null?void 0:i.software_provider)==null?void 0:n.name)||"-"),1)]}),_:1}),l(r,{prop:"is_connected",label:"是否直连",width:"100"},{default:t(({row:o})=>[l(h,{type:o.is_connected?"success":"info"},{default:t(()=>[d(x(o.is_connected?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:o})=>[l(h,{type:o.is_active?"success":"danger"},{default:t(()=>[d(x(o.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"操作",width:"300",fixed:"right"},{default:t(({row:o})=>[l(u,{size:"small",onClick:i=>Ye(o)},{default:t(()=>[...e[38]||(e[38]=[d("管理房型",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",onClick:i=>Oe(o)},{default:t(()=>[...e[39]||(e[39]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:i=>Ke(o)},{default:t(()=>[...e[40]||(e[40]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,le.value]]),l(Te,{"current-page":E.value,"onUpdate:currentPage":e[2]||(e[2]=o=>E.value=o),"page-size":te.value,"onUpdate:pageSize":e[3]||(e[3]=o=>te.value=o),"page-sizes":[10,20,50,100],total:ke.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:T,onCurrentChange:T},null,8,["current-page","page-size","total"])]),_:1}),l(F,{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=o=>$.value=o),title:Fe.value,width:"600px",onClose:Re},{footer:t(()=>[l(u,{onClick:e[12]||(e[12]=o=>$.value=!1)},{default:t(()=>[...e[44]||(e[44]=[d("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:Ze,loading:ae.value},{default:t(()=>[...e[45]||(e[45]=[d("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(X,{ref_key:"formRef",ref:j,model:m.value,rules:Ee,"label-width":"120px"},{default:t(()=>[l(y,{label:"所属景区",prop:"scenic_spot_id"},{default:t(()=>[l(f,{modelValue:m.value.scenic_spot_id,"onUpdate:modelValue":e[4]||(e[4]=o=>m.value.scenic_spot_id=o),placeholder:"请选择景区",style:{width:"100%"},disabled:fe.value},{default:t(()=>[(R(!0),Ce($e,null,Se(B.value,o=>(R(),L(p,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(y,{label:"酒店名称",prop:"name"},{default:t(()=>[l(c,{modelValue:m.value.name,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value.name=o),placeholder:"请输入酒店名称"},null,8,["modelValue"])]),_:1}),l(y,{label:"酒店编码",prop:"code"},{default:t(()=>[l(c,{modelValue:m.value.code,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value.code=o),placeholder:"系统自动生成",disabled:!0},null,8,["modelValue"]),e[41]||(e[41]=q("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 酒店编码由系统自动生成，格式：H + 5位数字（如 H00001） ",-1))]),_:1}),l(y,{label:"外部酒店编号",prop:"external_code"},{default:t(()=>[l(c,{modelValue:m.value.external_code,"onUpdate:modelValue":e[7]||(e[7]=o=>m.value.external_code=o),placeholder:"用于资源方系统对接的酒店编号（可选）"},null,8,["modelValue"]),e[42]||(e[42]=q("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 如果配置了外部编号，系统将优先使用外部编号与资源方系统对接；如果为空，则使用酒店编码 ",-1))]),_:1}),l(y,{label:"地址",prop:"address"},{default:t(()=>[l(c,{modelValue:m.value.address,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value.address=o),placeholder:"请输入酒店地址"},null,8,["modelValue"])]),_:1}),l(y,{label:"联系电话",prop:"contact_phone"},{default:t(()=>[l(c,{modelValue:m.value.contact_phone,"onUpdate:modelValue":e[9]||(e[9]=o=>m.value.contact_phone=o),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(y,{label:"是否直连",prop:"is_connected"},{default:t(()=>[l(be,{modelValue:m.value.is_connected,"onUpdate:modelValue":e[10]||(e[10]=o=>m.value.is_connected=o)},null,8,["modelValue"]),e[43]||(e[43]=q("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 开启后，系统将自动处理该酒店的订单 ",-1))]),_:1}),l(y,{label:"状态",prop:"is_active"},{default:t(()=>[l(be,{modelValue:m.value.is_active,"onUpdate:modelValue":e[11]||(e[11]=o=>m.value.is_active=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(F,{modelValue:oe.value,"onUpdate:modelValue":e[36]||(e[36]=o=>oe.value=o),title:"房型管理",width:"1200px",onClose:Xe},{default:t(()=>{var o;return[q("div",Vl,[l(u,{type:"primary",onClick:Ge},{default:t(()=>[...e[46]||(e[46]=[d("添加房型",-1)])]),_:1}),q("span",xl," 酒店："+x((o=S.value)==null?void 0:o.name),1)]),qe((R(),L(_e,{data:ne.value,border:""},{default:t(()=>[l(r,{prop:"name",label:"房型名称",width:"150"}),l(r,{prop:"code",label:"房型编码",width:"150"}),l(r,{prop:"max_occupancy",label:"最大入住人数",width:"120"}),l(r,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(r,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:i})=>[l(h,{type:i.is_active?"success":"danger"},{default:t(()=>[d(x(i.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"操作",width:"250",fixed:"right"},{default:t(({row:i})=>[l(u,{size:"small",onClick:n=>el(i)},{default:t(()=>[...e[47]||(e[47]=[d("管理库存",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",onClick:n=>Je(i)},{default:t(()=>[...e[48]||(e[48]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:n=>We(i)},{default:t(()=>[...e[49]||(e[49]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,ue.value]]),l(F,{modelValue:D.value,"onUpdate:modelValue":e[21]||(e[21]=i=>D.value=i),title:Be.value,width:"500px","append-to-body":"",onClose:Ue},{footer:t(()=>[l(u,{onClick:e[20]||(e[20]=i=>D.value=!1)},{default:t(()=>[...e[52]||(e[52]=[d("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:Qe,loading:se.value},{default:t(()=>[...e[53]||(e[53]=[d("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(X,{ref_key:"roomTypeFormRef",ref:Y,model:g.value,rules:Pe,"label-width":"120px"},{default:t(()=>[l(y,{label:"房型名称",prop:"name"},{default:t(()=>[l(c,{modelValue:g.value.name,"onUpdate:modelValue":e[14]||(e[14]=i=>g.value.name=i),placeholder:"请输入房型名称"},null,8,["modelValue"])]),_:1}),l(y,{label:"房型编码",prop:"code"},{default:t(()=>[l(c,{modelValue:g.value.code,"onUpdate:modelValue":e[15]||(e[15]=i=>g.value.code=i),placeholder:"系统自动生成",disabled:!0},null,8,["modelValue"]),e[50]||(e[50]=q("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 房型编码由系统自动生成，格式：R + 5位数字（如 R00001） ",-1))]),_:1}),l(y,{label:"外部房型标识",prop:"external_code"},{default:t(()=>[l(c,{modelValue:g.value.external_code,"onUpdate:modelValue":e[16]||(e[16]=i=>g.value.external_code=i),placeholder:"用于资源方系统对接的房型标识（可选）"},null,8,["modelValue"]),e[51]||(e[51]=q("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 如果配置了外部标识，系统将优先使用外部标识与资源方系统对接；如果为空，则使用房型名称。注意：必须与资源方系统中的房型名称完全一致 ",-1))]),_:1}),l(y,{label:"最大入住人数",prop:"max_occupancy"},{default:t(()=>[l(H,{modelValue:g.value.max_occupancy,"onUpdate:modelValue":e[17]||(e[17]=i=>g.value.max_occupancy=i),min:1,max:10},null,8,["modelValue"])]),_:1}),l(y,{label:"描述",prop:"description"},{default:t(()=>[l(c,{modelValue:g.value.description,"onUpdate:modelValue":e[18]||(e[18]=i=>g.value.description=i),type:"textarea",rows:3,placeholder:"请输入房型描述"},null,8,["modelValue"])]),_:1}),l(y,{label:"状态",prop:"is_active"},{default:t(()=>[l(be,{modelValue:g.value.is_active,"onUpdate:modelValue":e[19]||(e[19]=i=>g.value.is_active=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(F,{modelValue:ie.value,"onUpdate:modelValue":e[35]||(e[35]=i=>ie.value=i),title:"库存管理",width:"1000px","append-to-body":"",onClose:pl},{default:t(()=>{var i;return[q("div",Cl,[q("span",ql,"房型："+x((i=C.value)==null?void 0:i.name),1),l(u,{type:"primary",onClick:ol},{default:t(()=>[...e[54]||(e[54]=[d("批量添加库存",-1)])]),_:1}),l(Ve,{modelValue:U.value,"onUpdate:modelValue":e[22]||(e[22]=n=>U.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"20px"},onChange:ll},null,8,["modelValue"])]),qe((R(),L(_e,{data:re.value,border:""},{default:t(()=>[l(r,{prop:"date",label:"日期",width:"120"},{default:t(({row:n})=>[d(x(W(n.date)),1)]),_:1}),l(r,{prop:"total_quantity",label:"总库存",width:"100"}),l(r,{prop:"available_quantity",label:"可用库存",width:"100"}),l(r,{prop:"locked_quantity",label:"锁定库存",width:"100"}),l(r,{prop:"source",label:"来源",width:"100"},{default:t(({row:n})=>[l(h,{type:n.source==="manual"?"primary":"success"},{default:t(()=>[d(x(n.source==="manual"?"人工维护":"接口推送"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"is_closed",label:"状态",width:"100"},{default:t(({row:n})=>[l(h,{type:n.is_closed?"danger":"success"},{default:t(()=>[d(x(n.is_closed?"已关闭":"正常"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"操作",width:"300",fixed:"right"},{default:t(({row:n})=>[l(u,{size:"small",onClick:Ie=>ul(n)},{default:t(()=>[...e[55]||(e[55]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:n.is_closed?"success":"warning",onClick:Ie=>il(n)},{default:t(()=>[d(x(n.is_closed?"开启":"关闭"),1)]),_:2},1032,["type","onClick"]),l(u,{size:"small",type:"primary",onClick:Ie=>rl(n),loading:me.value[n.id]},{default:t(()=>[...e[56]||(e[56]=[d(" 推送到OTA ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[xe,de.value]]),l(Te,{"current-page":z.value,"onUpdate:currentPage":e[23]||(e[23]=n=>z.value=n),"page-size":ce.value,"onUpdate:pageSize":e[24]||(e[24]=n=>ce.value=n),"page-sizes":[30,50,100],total:ye.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:tl,onCurrentChange:al},null,8,["current-page","page-size","total"]),l(F,{modelValue:A.value,"onUpdate:modelValue":e[29]||(e[29]=n=>A.value=n),title:"批量添加库存",width:"600px","append-to-body":"",onClose:ze},{footer:t(()=>[l(u,{onClick:e[28]||(e[28]=n=>A.value=!1)},{default:t(()=>[...e[57]||(e[57]=[d("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:nl,loading:pe.value},{default:t(()=>[...e[58]||(e[58]=[d("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(X,{ref_key:"batchInventoryFormRef",ref:G,model:w.value,rules:Ae,"label-width":"120px"},{default:t(()=>[l(y,{label:"日期范围",prop:"dateRange"},{default:t(()=>[l(Ve,{modelValue:w.value.dateRange,"onUpdate:modelValue":e[25]||(e[25]=n=>w.value.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(y,{label:"总库存",prop:"total_quantity"},{default:t(()=>[l(H,{modelValue:w.value.total_quantity,"onUpdate:modelValue":e[26]||(e[26]=n=>w.value.total_quantity=n),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(y,{label:"可用库存",prop:"available_quantity"},{default:t(()=>[l(H,{modelValue:w.value.available_quantity,"onUpdate:modelValue":e[27]||(e[27]=n=>w.value.available_quantity=n),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(F,{modelValue:M.value,"onUpdate:modelValue":e[34]||(e[34]=n=>M.value=n),title:"编辑库存",width:"500px","append-to-body":"",onClose:dl},{footer:t(()=>[l(u,{onClick:e[33]||(e[33]=n=>M.value=!1)},{default:t(()=>[...e[59]||(e[59]=[d("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:sl,loading:ve.value,disabled:b.value.source==="api"},{default:t(()=>[...e[60]||(e[60]=[d(" 确定 ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[l(X,{ref_key:"inventoryFormRef",ref:J,model:b.value,rules:Me,"label-width":"120px"},{default:t(()=>[l(y,{label:"日期"},{default:t(()=>[l(Ve,{modelValue:b.value.date,"onUpdate:modelValue":e[30]||(e[30]=n=>b.value.date=n),type:"date",placeholder:"选择日期",style:{width:"100%"},disabled:""},null,8,["modelValue"])]),_:1}),l(y,{label:"总库存",prop:"total_quantity"},{default:t(()=>[l(H,{modelValue:b.value.total_quantity,"onUpdate:modelValue":e[31]||(e[31]=n=>b.value.total_quantity=n),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(y,{label:"可用库存",prop:"available_quantity"},{default:t(()=>[l(H,{modelValue:b.value.available_quantity,"onUpdate:modelValue":e[32]||(e[32]=n=>b.value.available_quantity=n),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(y,{label:"来源"},{default:t(()=>[l(h,{type:b.value.source==="manual"?"primary":"success"},{default:t(()=>[d(x(b.value.source==="manual"?"人工维护":"接口推送"),1)]),_:1},8,["type"]),q("span",wl,x(b.value.source==="manual"?"（可编辑）":"（接口推送，不可编辑）"),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]}),_:1},8,["modelValue"])]}),_:1},8,["modelValue"])])}}},Ul=ml(kl,[["__scopeId","data-v-2bf8c882"]]);export{Ul as default};
