import{_ as J,r as u,A as h,i as K,c as O,o as D,f as A,b as l,w as o,d as i,k as x,E as g,l as Q,m as W,h as d,q as X,t as U,v as Y}from"./app-dwQB4-it.js";const ee={style:{"margin-bottom":"20px"}},le={__name:"Index",setup(ae){const B=u([]),C=u(!1),I=u(!1),m=u(!1),f=u(null),P=u(1),k=u(15),S=u(0),b=u(null),z=h(()=>b.value!==null),E=h(()=>z.value?"编辑软件服务商":"创建软件服务商"),r=u({name:"",code:"",description:"",api_type:"",api_url:"",is_active:!0}),q={name:[{required:!0,message:"请输入服务商名称",trigger:"blur"},{max:255,message:"服务商名称不能超过255个字符",trigger:"blur"}],code:[{required:!0,message:"请输入服务商编码",trigger:"blur"},{max:255,message:"服务商编码不能超过255个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"服务商编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],api_url:[{required:!0,message:"请输入API地址",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:["blur","change"]},{max:255,message:"API地址不能超过255个字符",trigger:"blur"}]},_=async()=>{C.value=!0;try{const t={page:P.value,per_page:k.value},e=await x.get("/software-providers",{params:t});B.value=e.data.data||[],S.value=e.data.total||0}catch(t){g.error("获取软件服务商列表失败"),console.error(t)}finally{C.value=!1}},N=()=>{b.value=null,$(),m.value=!0},R=t=>{b.value=t.id,r.value={name:t.name,code:t.code,description:t.description||"",api_type:t.api_type||"",api_url:t.api_url||"",is_active:t.is_active},m.value=!0},T=async()=>{f.value&&await f.value.validate(async t=>{var e,s,n,c,y,V;if(t){I.value=!0;try{z.value?(await x.put(`/software-providers/${b.value}`,r.value),g.success("软件服务商更新成功")):(await x.post("/software-providers",r.value),g.success("软件服务商创建成功")),m.value=!1,_()}catch(w){const p=((s=(e=w.response)==null?void 0:e.data)==null?void 0:s.message)||((V=(y=(c=(n=w.response)==null?void 0:n.data)==null?void 0:c.errors)==null?void 0:y.code)==null?void 0:V[0])||"操作失败";g.error(p)}finally{I.value=!1}}})},L=async t=>{var e,s;try{await Y.confirm(`确定要删除软件服务商"${t.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await x.delete(`/software-providers/${t.id}`),g.success("删除成功"),_()}catch(n){if(n!=="cancel"){const c=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"删除失败";g.error(c),console.error(n)}}},$=()=>{var t;r.value={name:"",code:"",description:"",api_type:"",api_url:"",is_active:!0},(t=f.value)==null||t.clearValidate()},M=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return K(()=>{_()}),(t,e)=>{const s=i("el-button"),n=i("el-table-column"),c=i("el-tag"),y=i("el-table"),V=i("el-pagination"),w=i("el-card"),p=i("el-input"),v=i("el-form-item"),j=i("el-switch"),F=i("el-form"),Z=i("el-dialog"),G=Q("loading");return D(),O("div",null,[e[16]||(e[16]=A("h2",null,"软件服务商管理",-1)),l(w,null,{default:o(()=>[A("div",ee,[l(s,{type:"primary",onClick:N},{default:o(()=>[...e[10]||(e[10]=[d("创建软件服务商",-1)])]),_:1})]),W((D(),X(y,{data:B.value,border:""},{default:o(()=>[l(n,{prop:"name",label:"服务商名称",width:"200"}),l(n,{prop:"code",label:"服务商编码",width:"150"}),l(n,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(n,{prop:"api_type",label:"API类型",width:"120"}),l(n,{prop:"api_url",label:"API地址",width:"200","show-overflow-tooltip":""}),l(n,{label:"关联景区数量",width:"120"},{default:o(({row:a})=>[d(U(a.scenic_spots_count||0),1)]),_:1}),l(n,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:a})=>[l(c,{type:a.is_active?"success":"danger"},{default:o(()=>[d(U(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(n,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:a})=>[d(U(M(a.created_at)),1)]),_:1}),l(n,{label:"操作",width:"150",fixed:"right"},{default:o(({row:a})=>[l(s,{size:"small",onClick:H=>R(a)},{default:o(()=>[...e[11]||(e[11]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(s,{size:"small",type:"danger",onClick:H=>L(a)},{default:o(()=>[...e[12]||(e[12]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,C.value]]),l(V,{"current-page":P.value,"onUpdate:currentPage":e[0]||(e[0]=a=>P.value=a),"page-size":k.value,"onUpdate:pageSize":e[1]||(e[1]=a=>k.value=a),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),l(Z,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=a=>m.value=a),title:E.value,width:"600px",onClose:$},{footer:o(()=>[l(s,{onClick:e[8]||(e[8]=a=>m.value=!1)},{default:o(()=>[...e[14]||(e[14]=[d("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:T,loading:I.value},{default:o(()=>[...e[15]||(e[15]=[d("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(F,{ref_key:"formRef",ref:f,model:r.value,rules:q,"label-width":"120px"},{default:o(()=>[l(v,{label:"服务商名称",prop:"name"},{default:o(()=>[l(p,{modelValue:r.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"请输入服务商名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"服务商编码",prop:"code"},{default:o(()=>[l(p,{modelValue:r.value.code,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.code=a),placeholder:"请输入服务商编码（唯一）",disabled:z.value},null,8,["modelValue","disabled"])]),_:1}),l(v,{label:"描述",prop:"description"},{default:o(()=>[l(p,{modelValue:r.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.description=a),type:"textarea",rows:4,placeholder:"请输入服务商描述"},null,8,["modelValue"])]),_:1}),l(v,{label:"API类型",prop:"api_type"},{default:o(()=>[l(p,{modelValue:r.value.api_type,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.api_type=a),placeholder:"请输入API类型（可选）"},null,8,["modelValue"])]),_:1}),l(v,{label:"API地址",prop:"api_url"},{default:o(()=>[l(p,{modelValue:r.value.api_url,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.api_url=a),placeholder:"请输入服务商API地址（必填）"},null,8,["modelValue"]),e[13]||(e[13]=A("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 每个服务商的API地址不同，请填写完整的URL ",-1))]),_:1}),l(v,{label:"状态",prop:"is_active"},{default:o(()=>[l(j,{modelValue:r.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=J(le,[["__scopeId","data-v-4175d656"]]);export{oe as default};
