import{_ as ge,r as u,s as Y,i as _e,c as A,o as y,f as C,b as l,w as o,d as c,j as b,E as V,k as ye,l as Ve,h as v,x as be,y as we,n as $,t as ee,F as M,v as L,p as xe,q as Ce}from"./app-DOrDR003.js";const Ue={style:{"margin-bottom":"20px"}},ke={style:{display:"flex",gap:"10px",width:"100%"}},ze={__name:"Index",setup(Se){const K=u([]),B=u([]),P=u([]),E=u(!1),F=u(!1),U=u(!1),h=u(null),I=u(""),q=u(1),D=u(15),Z=u(0),R=u(null),S=u(!1),T=u(null),O=u(!1),G=u(null),r=u({api_url:"",username:"",password:"",environment:"production",sync_mode:{inventory:"manual",price:"manual",order:"manual"},order_provider:null,credentials:{ctrip:{username:"",password:""},meituan:{username:"",password:""},fliggy:{username:"",password:""}},is_active:!0}),N=Y(()=>R.value!==null),le=Y(()=>N.value?"编辑景区":"创建景区"),d=u({name:"",code:"",address:"",contact_phone:"",description:"",software_provider_id:null,is_active:!0}),ae={name:[{required:!0,message:"请输入景区名称",trigger:"blur"},{max:255,message:"景区名称不能超过255个字符",trigger:"blur"}],code:[{required:!0,message:"请输入景区编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"景区编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}]},oe={api_url:[{required:!0,message:"请输入接口地址",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:["blur","change"]}],username:[{required:!0,message:"请输入默认用户名",trigger:"blur"}],password:[{min:0,max:255,message:"密码长度不能超过255个字符",trigger:"blur"}],environment:[{required:!0,message:"请选择环境",trigger:"change"}],"sync_mode.inventory":[{required:!0,message:"请选择库存同步方式",trigger:"change"}],"sync_mode.price":[{required:!0,message:"请选择价格同步方式",trigger:"change"}],"sync_mode.order":[{required:!0,message:"请选择订单处理方式",trigger:"change"}]},w=async()=>{E.value=!0;try{const t={page:q.value,per_page:D.value};I.value;const e=await b.get("/scenic-spots",{params:t});K.value=e.data.data||[],Z.value=e.data.total||0}catch(t){V.error("获取景区列表失败"),console.error(t)}finally{E.value=!1}},te=async()=>{try{const t=await b.get("/software-providers");B.value=t.data.data||[]}catch(t){console.error("获取软件服务商列表失败",t)}},re=async()=>{try{const t=await b.get("/ota-platforms");P.value=t.data.data||[]}catch(t){console.error("获取OTA平台列表失败",t)}},ne=()=>{q.value=1,w()},se=()=>{R.value=null,H(),U.value=!0},de=t=>{R.value=t.id,d.value={name:t.name,code:t.code,address:t.address||"",contact_phone:t.contact_phone||"",description:t.description||"",software_provider_id:t.software_provider_id,is_active:t.is_active},U.value=!0},ue=async()=>{h.value&&await h.value.validate(async t=>{var e,i,f,s,n,m;if(t){F.value=!0;try{N.value?(await b.put(`/scenic-spots/${R.value}`,d.value),V.success("景区更新成功")):(await b.post("/scenic-spots",d.value),V.success("景区创建成功")),U.value=!1,w()}catch(k){const x=((i=(e=k.response)==null?void 0:e.data)==null?void 0:i.message)||((m=(n=(s=(f=k.response)==null?void 0:f.data)==null?void 0:s.errors)==null?void 0:n.code)==null?void 0:m[0])||"操作失败";V.error(x)}finally{F.value=!1}}})},ie=async t=>{try{await Ce.confirm(`确定要删除景区"${t.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await b.delete(`/scenic-spots/${t.id}`),V.success("删除成功"),w()}catch(e){e!=="cancel"&&(V.error("删除失败"),console.error(e))}},H=()=>{var t;d.value={name:"",code:"",address:"",contact_phone:"",description:"",software_provider_id:null,is_active:!0},(t=h.value)==null||t.clearValidate()},pe=async t=>{var e,i,f,s;G.value=t.id,S.value=!0;try{const n=await b.get(`/scenic-spots/${t.id}/resource-config`);if(n.data.success&&n.data.data){const m=n.data.data;r.value={api_url:m.api_url||"",username:m.username||"",password:"",environment:m.environment||"production",sync_mode:((e=m.extra_config)==null?void 0:e.sync_mode)||{inventory:"manual",price:"manual",order:"manual"},order_provider:((i=m.extra_config)==null?void 0:i.order_provider)||null,credentials:((f=m.extra_config)==null?void 0:f.credentials)||{ctrip:{username:"",password:""},meituan:{username:"",password:""},fliggy:{username:"",password:""}},is_active:m.is_active??!0}}else j()}catch(n){((s=n.response)==null?void 0:s.status)!==404&&(V.error("获取资源配置失败"),console.error(n)),j()}},me=async()=>{T.value&&await T.value.validate(async t=>{var e,i,f,s;if(t){O.value=!0;try{const n={...r.value,credentials:r.value.credentials||{}};await b.post(`/scenic-spots/${G.value}/resource-config`,n),V.success("资源配置保存成功"),S.value=!1,w()}catch(n){let m="保存失败";if((i=(e=n.response)==null?void 0:e.data)!=null&&i.message)m=n.response.data.message;else if((s=(f=n.response)==null?void 0:f.data)!=null&&s.errors){const k=n.response.data.errors,x=Object.values(k)[0];m=Array.isArray(x)?x[0]:x}V.error(m),console.error("保存资源配置失败:",n)}finally{O.value=!1}}})},j=()=>{var t;r.value={api_url:"",username:"",password:"",environment:"production",sync_mode:{inventory:"manual",price:"manual",order:"manual"},order_provider:null,credentials:{ctrip:{username:"",password:""},meituan:{username:"",password:""},fliggy:{username:"",password:""}},is_active:!0},(t=T.value)==null||t.clearValidate()};return _e(()=>{w(),te(),re()}),(t,e)=>{const i=c("el-button"),f=c("el-icon"),s=c("el-input"),n=c("el-table-column"),m=c("el-tag"),k=c("el-table"),x=c("el-pagination"),ce=c("el-card"),p=c("el-form-item"),g=c("el-option"),z=c("el-select"),J=c("el-switch"),Q=c("el-form"),W=c("el-dialog"),ve=c("el-alert"),X=c("el-divider"),fe=ye("loading");return y(),A("div",null,[e[37]||(e[37]=C("h2",null,"景区管理",-1)),l(ce,null,{default:o(()=>[C("div",Ue,[l(i,{type:"primary",onClick:se},{default:o(()=>[...e[23]||(e[23]=[v("创建景区",-1)])]),_:1}),l(s,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),placeholder:"搜索景区名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:ne},{prefix:o(()=>[l(f,null,{default:o(()=>[l(be(we))]),_:1})]),_:1},8,["modelValue"])]),Ve((y(),$(k,{data:K.value,border:""},{default:o(()=>[l(n,{prop:"name",label:"景区名称",width:"200"}),l(n,{prop:"code",label:"景区编码",width:"150"}),l(n,{prop:"address",label:"地址","show-overflow-tooltip":""}),l(n,{prop:"contact_phone",label:"联系电话",width:"150"}),l(n,{label:"软件服务商",width:"150"},{default:o(({row:a})=>{var _;return[v(ee(((_=a.software_provider)==null?void 0:_.name)||"-"),1)]}),_:1}),l(n,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:a})=>[l(m,{type:a.is_active?"success":"danger"},{default:o(()=>[v(ee(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(n,{label:"操作",width:"280",fixed:"right"},{default:o(({row:a})=>[l(i,{size:"small",onClick:_=>de(a)},{default:o(()=>[...e[24]||(e[24]=[v("编辑",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"info",onClick:_=>pe(a)},{default:o(()=>[...e[25]||(e[25]=[v("配置资源方",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"danger",onClick:_=>ie(a)},{default:o(()=>[...e[26]||(e[26]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,E.value]]),l(x,{"current-page":q.value,"onUpdate:currentPage":e[1]||(e[1]=a=>q.value=a),"page-size":D.value,"onUpdate:pageSize":e[2]||(e[2]=a=>D.value=a),"page-sizes":[10,20,50,100],total:Z.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1}),l(W,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a),title:le.value,width:"600px",onClose:H},{footer:o(()=>[l(i,{onClick:e[10]||(e[10]=a=>U.value=!1)},{default:o(()=>[...e[27]||(e[27]=[v("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ue,loading:F.value},{default:o(()=>[...e[28]||(e[28]=[v("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(Q,{ref_key:"formRef",ref:h,model:d.value,rules:ae,"label-width":"120px"},{default:o(()=>[l(p,{label:"景区名称",prop:"name"},{default:o(()=>[l(s,{modelValue:d.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.name=a),placeholder:"请输入景区名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"景区编码",prop:"code"},{default:o(()=>[l(s,{modelValue:d.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.code=a),placeholder:"请输入景区编码（唯一）",disabled:N.value},null,8,["modelValue","disabled"])]),_:1}),l(p,{label:"地址",prop:"address"},{default:o(()=>[l(s,{modelValue:d.value.address,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.address=a),placeholder:"请输入景区地址"},null,8,["modelValue"])]),_:1}),l(p,{label:"联系电话",prop:"contact_phone"},{default:o(()=>[l(s,{modelValue:d.value.contact_phone,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.contact_phone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(p,{label:"软件服务商",prop:"software_provider_id"},{default:o(()=>[l(z,{modelValue:d.value.software_provider_id,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.software_provider_id=a),placeholder:"请选择软件服务商",clearable:"",style:{width:"100%"}},{default:o(()=>[(y(!0),A(M,null,L(B.value,a=>(y(),$(g,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"描述",prop:"description"},{default:o(()=>[l(s,{modelValue:d.value.description,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.description=a),type:"textarea",rows:4,placeholder:"请输入景区描述"},null,8,["modelValue"])]),_:1}),l(p,{label:"状态",prop:"is_active"},{default:o(()=>[l(J,{modelValue:d.value.is_active,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:S.value,"onUpdate:modelValue":e[22]||(e[22]=a=>S.value=a),title:"资源配置",width:"800px",onClose:j},{footer:o(()=>[l(i,{onClick:e[21]||(e[21]=a=>S.value=!1)},{default:o(()=>[...e[35]||(e[35]=[v("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:me,loading:O.value},{default:o(()=>[...e[36]||(e[36]=[v("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(ve,{title:"重要提示",type:"warning",description:"不同OTA平台的订单需要使用不同的用户名和密码。请为每个OTA平台配置对应的认证信息。",closable:!1,style:{"margin-bottom":"20px"}}),l(Q,{ref_key:"resourceConfigFormRef",ref:T,model:r.value,rules:oe,"label-width":"140px"},{default:o(()=>[l(p,{label:"接口地址",prop:"api_url"},{default:o(()=>[l(s,{modelValue:r.value.api_url,"onUpdate:modelValue":e[12]||(e[12]=a=>r.value.api_url=a),placeholder:"例如：https://e.hengdianworld.com/Interface/hotel_order.aspx"},null,8,["modelValue"])]),_:1}),l(p,{label:"默认用户名",prop:"username"},{default:o(()=>[l(s,{modelValue:r.value.username,"onUpdate:modelValue":e[13]||(e[13]=a=>r.value.username=a),placeholder:"用于库存推送订阅等非订单场景"},null,8,["modelValue"])]),_:1}),l(p,{label:"默认密码",prop:"password"},{default:o(()=>[l(s,{modelValue:r.value.password,"onUpdate:modelValue":e[14]||(e[14]=a=>r.value.password=a),type:"password","show-password":"",placeholder:"用于库存推送订阅等非订单场景"},null,8,["modelValue"])]),_:1}),l(p,{label:"环境",prop:"environment"},{default:o(()=>[l(z,{modelValue:r.value.environment,"onUpdate:modelValue":e[15]||(e[15]=a=>r.value.environment=a),style:{width:"100%"}},{default:o(()=>[l(g,{label:"生产环境",value:"production"})]),_:1},8,["modelValue"])]),_:1}),l(X,null,{default:o(()=>[...e[29]||(e[29]=[v("同步方式配置",-1)])]),_:1}),l(p,{label:"库存同步方式",prop:"sync_mode.inventory"},{default:o(()=>[l(z,{modelValue:r.value.sync_mode.inventory,"onUpdate:modelValue":e[16]||(e[16]=a=>r.value.sync_mode.inventory=a),style:{width:"100%"}},{default:o(()=>[l(g,{label:"资源方推送",value:"push"}),l(g,{label:"手工维护",value:"manual"})]),_:1},8,["modelValue"]),e[30]||(e[30]=C("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"资源方推送"后，系统将自动接收资源方推送的库存信息 ',-1))]),_:1}),l(p,{label:"价格同步方式",prop:"sync_mode.price"},{default:o(()=>[l(z,{modelValue:r.value.sync_mode.price,"onUpdate:modelValue":e[17]||(e[17]=a=>r.value.sync_mode.price=a),style:{width:"100%"}},{default:o(()=>[l(g,{label:"资源方推送",value:"push"}),l(g,{label:"手工维护",value:"manual"})]),_:1},8,["modelValue"]),e[31]||(e[31]=C("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"资源方推送"后，系统将自动接收资源方推送的价格信息 ',-1))]),_:1}),l(p,{label:"订单处理方式",prop:"sync_mode.order"},{default:o(()=>[l(z,{modelValue:r.value.sync_mode.order,"onUpdate:modelValue":e[18]||(e[18]=a=>r.value.sync_mode.order=a),style:{width:"100%"}},{default:o(()=>[l(g,{label:"系统直连",value:"auto"}),l(g,{label:"手工操作",value:"manual"}),l(g,{label:"其他系统",value:"other"})]),_:1},8,["modelValue"]),e[32]||(e[32]=C("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}},' 选择"系统直连"后，订单将自动调用资源方接口；选择"其他系统"需要指定系统服务商 ',-1))]),_:1}),r.value.sync_mode.order==="other"?(y(),$(p,{key:0,label:"订单系统服务商",prop:"order_provider"},{default:o(()=>[l(z,{modelValue:r.value.order_provider,"onUpdate:modelValue":e[19]||(e[19]=a=>r.value.order_provider=a),placeholder:"请选择系统服务商",style:{width:"100%"}},{default:o(()=>[(y(!0),A(M,null,L(B.value,a=>(y(),$(g,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):xe("",!0),l(X,null,{default:o(()=>[...e[33]||(e[33]=[v("OTA平台认证信息",-1)])]),_:1}),(y(!0),A(M,null,L(P.value,a=>(y(),$(p,{key:a.id,label:`${a.name}认证信息`},{default:o(()=>[C("div",ke,[l(s,{modelValue:r.value.credentials[a.code].username,"onUpdate:modelValue":_=>r.value.credentials[a.code].username=_,placeholder:"用户名",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(s,{modelValue:r.value.credentials[a.code].password,"onUpdate:modelValue":_=>r.value.credentials[a.code].password=_,type:"password",placeholder:"密码",style:{flex:"1"},"show-password":""},null,8,["modelValue","onUpdate:modelValue"])]),e[34]||(e[34]=C("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 该平台订单将使用此认证信息调用资源方接口 ",-1))]),_:2},1032,["label"]))),128)),l(p,{label:"状态",prop:"is_active"},{default:o(()=>[l(J,{modelValue:r.value.is_active,"onUpdate:modelValue":e[20]||(e[20]=a=>r.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},he=ge(ze,[["__scopeId","data-v-59a748f6"]]);export{he as default};
