import{_ as le,r,x as T,i as ae,c as F,o as C,f as M,b as a,w as o,d as s,j as f,E as _,k as te,l as oe,h as c,p as ne,z as se,n as N,t as j,F as re,y as de,v as ue}from"./app-ZhZD_hbr.js";const ie={style:{"margin-bottom":"20px"}},pe={__name:"Index",setup(ce){const E=r([]),I=r([]),k=r(!1),z=r(!1),m=r(!1),g=r(null),U=r(""),b=r(1),S=r(15),D=r(0),V=r(null),$=T(()=>V.value!==null),q=T(()=>$.value?"编辑景区":"创建景区"),n=r({name:"",code:"",address:"",contact_phone:"",description:"",software_provider_id:null,is_active:!0}),R={name:[{required:!0,message:"请输入景区名称",trigger:"blur"},{max:255,message:"景区名称不能超过255个字符",trigger:"blur"}],code:[{required:!0,message:"请输入景区编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"景区编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}]},v=async()=>{k.value=!0;try{const t={page:b.value,per_page:S.value};U.value;const e=await f.get("/scenic-spots",{params:t});E.value=e.data.data||[],D.value=e.data.total||0}catch(t){_.error("获取景区列表失败"),console.error(t)}finally{k.value=!1}},A=async()=>{try{const t=await f.get("/software-providers");I.value=t.data.data||[]}catch(t){console.error("获取软件服务商列表失败",t)}},K=()=>{b.value=1,v()},L=()=>{V.value=null,P(),m.value=!0},Z=t=>{V.value=t.id,n.value={name:t.name,code:t.code,address:t.address||"",contact_phone:t.contact_phone||"",description:t.description||"",software_provider_id:t.software_provider_id,is_active:t.is_active},m.value=!0},G=async()=>{g.value&&await g.value.validate(async t=>{var e,i,y,u,d,w;if(t){z.value=!0;try{$.value?(await f.put(`/scenic-spots/${V.value}`,n.value),_.success("景区更新成功")):(await f.post("/scenic-spots",n.value),_.success("景区创建成功")),m.value=!1,v()}catch(x){const B=((i=(e=x.response)==null?void 0:e.data)==null?void 0:i.message)||((w=(d=(u=(y=x.response)==null?void 0:y.data)==null?void 0:u.errors)==null?void 0:d.code)==null?void 0:w[0])||"操作失败";_.error(B)}finally{z.value=!1}}})},H=async t=>{try{await ue.confirm(`确定要删除景区"${t.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await f.delete(`/scenic-spots/${t.id}`),_.success("删除成功"),v()}catch(e){e!=="cancel"&&(_.error("删除失败"),console.error(e))}},P=()=>{var t;n.value={name:"",code:"",address:"",contact_phone:"",description:"",software_provider_id:null,is_active:!0},(t=g.value)==null||t.clearValidate()};return ae(()=>{v(),A()}),(t,e)=>{const i=s("el-button"),y=s("el-icon"),u=s("el-input"),d=s("el-table-column"),w=s("el-tag"),x=s("el-table"),B=s("el-pagination"),J=s("el-card"),p=s("el-form-item"),O=s("el-option"),Q=s("el-select"),W=s("el-switch"),X=s("el-form"),Y=s("el-dialog"),ee=te("loading");return C(),F("div",null,[e[17]||(e[17]=M("h2",null,"景区管理",-1)),a(J,null,{default:o(()=>[M("div",ie,[a(i,{type:"primary",onClick:L},{default:o(()=>[...e[12]||(e[12]=[c("创建景区",-1)])]),_:1}),a(u,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=l=>U.value=l),placeholder:"搜索景区名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:K},{prefix:o(()=>[a(y,null,{default:o(()=>[a(ne(se))]),_:1})]),_:1},8,["modelValue"])]),oe((C(),N(x,{data:E.value,border:""},{default:o(()=>[a(d,{prop:"name",label:"景区名称",width:"200"}),a(d,{prop:"code",label:"景区编码",width:"150"}),a(d,{prop:"address",label:"地址","show-overflow-tooltip":""}),a(d,{prop:"contact_phone",label:"联系电话",width:"150"}),a(d,{label:"软件服务商",width:"150"},{default:o(({row:l})=>{var h;return[c(j(((h=l.software_provider)==null?void 0:h.name)||"-"),1)]}),_:1}),a(d,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:l})=>[a(w,{type:l.is_active?"success":"danger"},{default:o(()=>[c(j(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[a(i,{size:"small",onClick:h=>Z(l)},{default:o(()=>[...e[13]||(e[13]=[c("编辑",-1)])]),_:1},8,["onClick"]),a(i,{size:"small",type:"danger",onClick:h=>H(l)},{default:o(()=>[...e[14]||(e[14]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,k.value]]),a(B,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=l=>b.value=l),"page-size":S.value,"onUpdate:pageSize":e[2]||(e[2]=l=>S.value=l),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1}),a(Y,{modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=l=>m.value=l),title:q.value,width:"600px",onClose:P},{footer:o(()=>[a(i,{onClick:e[10]||(e[10]=l=>m.value=!1)},{default:o(()=>[...e[15]||(e[15]=[c("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:G,loading:z.value},{default:o(()=>[...e[16]||(e[16]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(X,{ref_key:"formRef",ref:g,model:n.value,rules:R,"label-width":"120px"},{default:o(()=>[a(p,{label:"景区名称",prop:"name"},{default:o(()=>[a(u,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.name=l),placeholder:"请输入景区名称"},null,8,["modelValue"])]),_:1}),a(p,{label:"景区编码",prop:"code"},{default:o(()=>[a(u,{modelValue:n.value.code,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.code=l),placeholder:"请输入景区编码（唯一）",disabled:$.value},null,8,["modelValue","disabled"])]),_:1}),a(p,{label:"地址",prop:"address"},{default:o(()=>[a(u,{modelValue:n.value.address,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.address=l),placeholder:"请输入景区地址"},null,8,["modelValue"])]),_:1}),a(p,{label:"联系电话",prop:"contact_phone"},{default:o(()=>[a(u,{modelValue:n.value.contact_phone,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.contact_phone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(p,{label:"软件服务商",prop:"software_provider_id"},{default:o(()=>[a(Q,{modelValue:n.value.software_provider_id,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.software_provider_id=l),placeholder:"请选择软件服务商",clearable:"",style:{width:"100%"}},{default:o(()=>[(C(!0),F(re,null,de(I.value,l=>(C(),N(O,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"描述",prop:"description"},{default:o(()=>[a(u,{modelValue:n.value.description,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.description=l),type:"textarea",rows:4,placeholder:"请输入景区描述"},null,8,["modelValue"])]),_:1}),a(p,{label:"状态",prop:"is_active"},{default:o(()=>[a(W,{modelValue:n.value.is_active,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ve=le(pe,[["__scopeId","data-v-0e5ac13e"]]);export{ve as default};
