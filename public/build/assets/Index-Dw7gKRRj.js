import{r,i as de,c as H,o as V,f as J,b as l,w as t,d as i,k,E as f,l as pe,m as me,h as p,y as ve,B as ce,q as P,t as Q,v as fe}from"./app-tRAPUw1F.js";const _e={style:{"margin-bottom":"20px"}},ge={key:1},Ve={__name:"Index",setup(ye){const z=r(!1),q=r([]),w=r(""),x=r(null),C=r(1),E=r(15),B=r(0),g=r(!1),T=r("创建OTA平台"),$=r(!1),A=r(null),U=r(!1),K=r(null),m=r({name:"",code:"",description:"",is_active:!0}),y=r(!1),O=r(!1),S=r(null),F=r(null),u=r({account:"",secret_key:"",aes_key:"",aes_iv:"",rsa_private_key:"",rsa_public_key:"",api_url:"",callback_url:"",environment:"sandbox",is_active:!0}),W={name:[{required:!0,message:"请输入平台名称",trigger:"blur"}],code:[{required:!0,message:"请选择平台编码",trigger:"change"}]},X={account:[{required:!0,message:"请输入Account/AppKey",trigger:"blur"}],secret_key:[{required:!0,message:"请输入Secret Key/PartnerId",trigger:"blur"}],api_url:[{required:!0,message:"请输入API URL",trigger:"blur"}],environment:[{required:!0,message:"请选择环境",trigger:"change"}]},c=async()=>{var n,e,o;z.value=!0;try{const s={page:C.value,per_page:E.value};w.value&&(s.search=w.value),x.value!==null&&(s.is_active=x.value);const d=await k.get("/admin/ota-platforms",{params:s});q.value=d.data.data||[],B.value=((n=d.data.meta)==null?void 0:n.total)||0}catch(s){console.error("获取OTA平台列表失败:",s);const d=((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||s.message||"获取OTA平台列表失败";f.error(d)}finally{z.value=!1}},Y=()=>{C.value=1,c()},Z=()=>{U.value=!1,K.value=null,T.value="创建OTA平台",g.value=!0},h=n=>{U.value=!0,K.value=n.id,T.value="编辑OTA平台",m.value={name:n.name,code:n.code,description:n.description||"",is_active:n.is_active},g.value=!0},ee=async n=>{var e,o;try{await fe.confirm(`确定要删除平台"${n.name}"吗？`,"删除确认",{type:"warning"}),await k.delete(`/admin/ota-platforms/${n.id}`),f.success("删除成功"),c()}catch(s){s!=="cancel"&&f.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||"删除失败")}},le=async()=>{A.value&&await A.value.validate(async n=>{var e,o;if(n){$.value=!0;try{U.value?(await k.put(`/admin/ota-platforms/${K.value}`,m.value),f.success("更新成功")):(await k.post("/admin/ota-platforms",m.value),f.success("创建成功")),g.value=!1,c()}catch(s){f.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||"操作失败")}finally{$.value=!1}}})},ae=async n=>{F.value=n;try{const e=await k.get(`/admin/ota-platforms/${n.id}/config`);if(e.data.data){const o=e.data.data;u.value={account:o.account||"",secret_key:o.secret_key||"",aes_key:o.aes_key||"",aes_iv:o.aes_iv||"",rsa_private_key:o.rsa_private_key||"",rsa_public_key:o.rsa_public_key||"",api_url:o.api_url||"",callback_url:o.callback_url||"",environment:o.environment||"sandbox",is_active:o.is_active??!0}}else R();y.value=!0}catch{R(),y.value=!0}},te=async()=>{S.value&&await S.value.validate(async n=>{var e,o;if(n){O.value=!0;try{await k.post(`/admin/ota-platforms/${F.value.id}/config`,u.value),f.success("配置保存成功"),y.value=!1,c()}catch(s){f.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||"保存配置失败")}finally{O.value=!1}}})},oe=()=>{var n;m.value={name:"",code:"",description:"",is_active:!0},(n=A.value)==null||n.clearValidate()},R=()=>{var n;u.value={account:"",secret_key:"",aes_key:"",aes_iv:"",rsa_private_key:"",rsa_public_key:"",api_url:"",callback_url:"",environment:"sandbox",is_active:!0},(n=S.value)==null||n.clearValidate()};return de(()=>{c()}),(n,e)=>{const o=i("el-button"),s=i("el-icon"),d=i("el-input"),b=i("el-option"),D=i("el-select"),_=i("el-table-column"),I=i("el-tag"),ne=i("el-table"),ue=i("el-pagination"),re=i("el-card"),v=i("el-form-item"),M=i("el-switch"),L=i("el-form"),N=i("el-dialog"),j=i("el-radio"),se=i("el-radio-group"),ie=pe("loading");return V(),H("div",null,[e[32]||(e[32]=J("h2",null,"OTA平台管理",-1)),l(re,null,{default:t(()=>[J("div",_e,[l(o,{type:"primary",onClick:Z},{default:t(()=>[...e[20]||(e[20]=[p("创建OTA平台",-1)])]),_:1}),l(d,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),placeholder:"搜索平台名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:Y},{prefix:t(()=>[l(s,null,{default:t(()=>[l(ve(ce))]),_:1})]),_:1},8,["modelValue"]),l(D,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"状态筛选",clearable:"",style:{width:"150px","margin-left":"10px"},onChange:c},{default:t(()=>[l(b,{label:"全部",value:""}),l(b,{label:"启用",value:!0}),l(b,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),me((V(),P(ne,{data:q.value,border:""},{default:t(()=>[l(_,{prop:"name",label:"平台名称",width:"150"}),l(_,{prop:"code",label:"平台编码",width:"150"}),l(_,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(_,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:a})=>[l(I,{type:a.is_active?"success":"danger"},{default:t(()=>[p(Q(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"配置状态",width:"120"},{default:t(({row:a})=>[a.config?(V(),P(I,{key:0,type:"success"},{default:t(()=>[...e[21]||(e[21]=[p("已配置",-1)])]),_:1})):(V(),P(I,{key:1,type:"warning"},{default:t(()=>[...e[22]||(e[22]=[p("未配置",-1)])]),_:1}))]),_:1}),l(_,{label:"环境",width:"100"},{default:t(({row:a})=>[a.config?(V(),P(I,{key:0,type:a.config.environment==="production"?"success":"info"},{default:t(()=>[p(Q(a.config.environment==="production"?"生产":"测试"),1)]),_:2},1032,["type"])):(V(),H("span",ge,"-"))]),_:1}),l(_,{label:"操作",width:"300",fixed:"right"},{default:t(({row:a})=>[l(o,{size:"small",onClick:G=>ae(a)},{default:t(()=>[...e[23]||(e[23]=[p("配置",-1)])]),_:1},8,["onClick"]),l(o,{size:"small",onClick:G=>h(a)},{default:t(()=>[...e[24]||(e[24]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(o,{size:"small",type:"danger",onClick:G=>ee(a)},{default:t(()=>[...e[25]||(e[25]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,z.value]]),l(ue,{"current-page":C.value,"onUpdate:currentPage":e[2]||(e[2]=a=>C.value=a),"page-size":E.value,"onUpdate:pageSize":e[3]||(e[3]=a=>E.value=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])]),_:1}),l(N,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),title:T.value,width:"600px",onClose:oe},{footer:t(()=>[l(o,{onClick:e[8]||(e[8]=a=>g.value=!1)},{default:t(()=>[...e[26]||(e[26]=[p("取消",-1)])]),_:1}),l(o,{type:"primary",onClick:le,loading:$.value},{default:t(()=>[...e[27]||(e[27]=[p("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(L,{ref_key:"formRef",ref:A,model:m.value,rules:W,"label-width":"120px"},{default:t(()=>[l(v,{label:"平台名称",prop:"name"},{default:t(()=>[l(d,{modelValue:m.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.name=a),placeholder:"请输入平台名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"平台编码",prop:"code"},{default:t(()=>[l(D,{modelValue:m.value.code,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value.code=a),placeholder:"请选择平台编码",style:{width:"100%"},disabled:U.value},{default:t(()=>[l(b,{label:"携程",value:"ctrip"}),l(b,{label:"飞猪",value:"fliggy"}),l(b,{label:"美团",value:"meituan"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(v,{label:"描述",prop:"description"},{default:t(()=>[l(d,{modelValue:m.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value.description=a),type:"textarea",rows:4,placeholder:"请输入平台描述"},null,8,["modelValue"])]),_:1}),l(v,{label:"状态",prop:"is_active"},{default:t(()=>[l(M,{modelValue:m.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(N,{modelValue:y.value,"onUpdate:modelValue":e[19]||(e[19]=a=>y.value=a),title:"OTA平台配置",width:"700px",onClose:R},{footer:t(()=>[l(o,{onClick:e[18]||(e[18]=a=>y.value=!1)},{default:t(()=>[...e[30]||(e[30]=[p("取消",-1)])]),_:1}),l(o,{type:"primary",onClick:te,loading:O.value},{default:t(()=>[...e[31]||(e[31]=[p("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(L,{ref_key:"configFormRef",ref:S,model:u.value,rules:X,"label-width":"140px"},{default:t(()=>[l(v,{label:"Account/AppKey",prop:"account"},{default:t(()=>[l(d,{modelValue:u.value.account,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value.account=a),placeholder:"请输入Account或AppKey"},null,8,["modelValue"])]),_:1}),l(v,{label:"Secret Key/PartnerId",prop:"secret_key"},{default:t(()=>[l(d,{modelValue:u.value.secret_key,"onUpdate:modelValue":e[11]||(e[11]=a=>u.value.secret_key=a),type:"password","show-password":"",placeholder:"请输入Secret Key或PartnerId"},null,8,["modelValue"])]),_:1}),l(v,{label:"AES Key",prop:"aes_key"},{default:t(()=>[l(d,{modelValue:u.value.aes_key,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.aes_key=a),type:"password","show-password":"",placeholder:"请输入AES Key（16字节）"},null,8,["modelValue"])]),_:1}),l(v,{label:"AES IV",prop:"aes_iv"},{default:t(()=>[l(d,{modelValue:u.value.aes_iv,"onUpdate:modelValue":e[13]||(e[13]=a=>u.value.aes_iv=a),placeholder:"请输入AES IV（可选，携程需要）"},null,8,["modelValue"])]),_:1}),l(v,{label:"API URL",prop:"api_url"},{default:t(()=>[l(d,{modelValue:u.value.api_url,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.api_url=a),placeholder:"请输入API地址"},null,8,["modelValue"])]),_:1}),l(v,{label:"Callback URL",prop:"callback_url"},{default:t(()=>[l(d,{modelValue:u.value.callback_url,"onUpdate:modelValue":e[15]||(e[15]=a=>u.value.callback_url=a),placeholder:"请输入回调地址"},null,8,["modelValue"])]),_:1}),l(v,{label:"环境",prop:"environment"},{default:t(()=>[l(se,{modelValue:u.value.environment,"onUpdate:modelValue":e[16]||(e[16]=a=>u.value.environment=a)},{default:t(()=>[l(j,{label:"sandbox"},{default:t(()=>[...e[28]||(e[28]=[p("测试环境",-1)])]),_:1}),l(j,{label:"production"},{default:t(()=>[...e[29]||(e[29]=[p("生产环境",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"状态",prop:"is_active"},{default:t(()=>[l(M,{modelValue:u.value.is_active,"onUpdate:modelValue":e[17]||(e[17]=a=>u.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{Ve as default};
