import{r as n,x as N,i as Ee,c as pe,o as T,b as l,m as te,w as t,d as g,l as Ie,q as A,k as w,B as Ne,E as p,e as Ae,f as U,s as ce,h as r,t as m,v as me}from"./app-CQIcOIsZ.js";const He={key:0},Le={style:{"margin-bottom":"20px"}},Oe={style:{"margin-bottom":"20px"}},Pe={style:{"margin-right":"20px"}},je={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},Ke={__name:"Detail",setup(Ge){const h=Ne(),ae=Ae(),k=n(null),H=n(!1),oe=n([]),L=n(!1),R=n(!1),B=n(null),O=n(!1),Y=n(null),P=n(!1),j=n([]),G=n(!1),V=n(null),S=n(null),$=n(!1),M=n(null),J=n(!1),C=n(!1),q=n(null),K=n(!1),D=n(null),se=N(()=>Y.value!==null),_e=N(()=>se.value?"编辑房型":"添加房型"),E=N(()=>D.value!==null),ve=N(()=>E.value?"编辑价库":"添加价库"),c=n({name:"",code:"",external_room_id:"",max_occupancy:2,bed_type:"",room_area:null,description:"",is_active:!0}),d=n({dateRange:null,cost_price:0,sale_price:0,stock_total:0,stock_sold:0}),i=n({biz_date:null,cost_price:0,sale_price:0,stock_total:0,stock_sold:0,source:"manual"}),fe={name:[{required:!0,message:"请输入房型名称",trigger:"blur"}],max_occupancy:[{required:!0,message:"请输入最大入住人数",trigger:"blur"},{type:"number",min:1,message:"最大入住人数至少为1",trigger:"blur"}]},ge={dateRange:[{required:!0,message:"请选择日期范围",trigger:"change"}],cost_price:[{required:!0,message:"请输入成本价",trigger:"blur"},{type:"number",min:0,message:"成本价不能小于0",trigger:"blur"}],sale_price:[{required:!0,message:"请输入售价",trigger:"blur"},{type:"number",min:0,message:"售价不能小于0",trigger:"blur"}],stock_total:[{required:!0,message:"请输入总库存",trigger:"blur"},{type:"number",min:0,message:"总库存不能小于0",trigger:"blur"}]},ye={biz_date:[{required:!0,message:"请选择日期",trigger:"change"}],cost_price:[{required:!0,message:"请输入成本价",trigger:"blur"},{type:"number",min:0,message:"成本价不能小于0",trigger:"blur"}],sale_price:[{required:!0,message:"请输入售价",trigger:"blur"},{type:"number",min:0,message:"售价不能小于0",trigger:"blur"}],stock_total:[{required:!0,message:"请输入总库存",trigger:"blur"},{type:"number",min:0,message:"总库存不能小于0",trigger:"blur"}]},be=()=>{ae.push("/res-hotels")},ke=async()=>{H.value=!0;try{const a=await w.get(`/res-hotels/${h.params.id}`);k.value=a.data.data,await Q()}catch(a){p.error("获取酒店详情失败"),console.error(a),ae.push("/res-hotels")}finally{H.value=!1}},Q=async()=>{L.value=!0;try{const a=await w.get("/res-room-types",{params:{hotel_id:h.params.id}});oe.value=a.data.data||[]}catch(a){p.error("获取房型列表失败"),console.error(a)}finally{L.value=!1}},Ve=()=>{Y.value=null,re(),R.value=!0},xe=a=>{Y.value=a.id,c.value={name:a.name,code:a.code,external_room_id:a.external_room_id||"",max_occupancy:a.max_occupancy||2,bed_type:a.bed_type||"",room_area:a.room_area||null,description:a.description||"",is_active:a.is_active},R.value=!0},we=async()=>{B.value&&await B.value.validate(async a=>{var e,f;if(a){O.value=!0;try{const u={...c.value,hotel_id:h.params.id};se.value?(await w.put(`/res-room-types/${Y.value}`,u),p.success("房型更新成功")):(await w.post("/res-room-types",u),p.success("房型创建成功")),R.value=!1,await Q()}catch(u){const y=((f=(e=u.response)==null?void 0:e.data)==null?void 0:f.message)||"操作失败";p.error(y)}finally{O.value=!1}}})},Se=async a=>{try{await me.confirm(`确定要删除房型"${a.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await w.delete(`/res-room-types/${a.id}`),p.success("删除成功"),await Q()}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error(e))}},re=()=>{var a;c.value={name:"",code:"",external_room_id:"",max_occupancy:2,bed_type:"",room_area:null,description:"",is_active:!0},(a=B.value)==null||a.clearValidate()},he=async a=>{V.value=a,P.value=!0,await z(a.id)},z=async a=>{G.value=!0;try{const e={hotel_id:h.params.id,room_type_id:a};S.value&&S.value.length===2&&(e.start_date=S.value[0],e.end_date=S.value[1]);const f=await w.get("/res-hotel-daily-stocks",{params:e});j.value=f.data.data||[]}catch(e){p.error("获取价库列表失败"),console.error(e)}finally{G.value=!1}},Re=()=>{V.value&&z(V.value.id)},Ce=()=>{ue(),$.value=!0},De=async()=>{M.value&&await M.value.validate(async a=>{var e,f;if(a){if(d.value.sale_price<d.value.cost_price){p.error("售价不能低于成本价");return}if(d.value.stock_sold>d.value.stock_total){p.error("已售库存不能超过总库存");return}J.value=!0;try{await w.post("/res-hotel-daily-stocks/batch",{hotel_id:h.params.id,room_type_id:V.value.id,start_date:d.value.dateRange[0],end_date:d.value.dateRange[1],cost_price:d.value.cost_price,sale_price:d.value.sale_price,stock_total:d.value.stock_total,stock_sold:d.value.stock_sold||0}),p.success("批量设置成功"),$.value=!1,await z(V.value.id)}catch(u){const y=((f=(e=u.response)==null?void 0:e.data)==null?void 0:f.message)||"操作失败";p.error(y)}finally{J.value=!1}}})},Te=()=>{D.value=null,ne(),C.value=!0},Ue=a=>{if(a.source==="api"){p.warning("接口推送的价库数据不可编辑");return}D.value=a.id,i.value={biz_date:a.biz_date,cost_price:a.cost_price,sale_price:a.sale_price,stock_total:a.stock_total,stock_sold:a.stock_sold,source:a.source},C.value=!0},$e=async()=>{q.value&&await q.value.validate(async a=>{var e,f;if(a){if(i.value.sale_price<i.value.cost_price){p.error("售价不能低于成本价");return}if(i.value.stock_sold>i.value.stock_total){p.error("已售库存不能超过总库存");return}K.value=!0;try{const u={hotel_id:h.params.id,room_type_id:V.value.id,...i.value};E.value?(await w.put(`/res-hotel-daily-stocks/${D.value}`,u),p.success("价库更新成功")):(await w.post("/res-hotel-daily-stocks",u),p.success("价库创建成功")),C.value=!1,await z(V.value.id)}catch(u){const y=((f=(e=u.response)==null?void 0:e.data)==null?void 0:f.message)||"操作失败";p.error(y)}finally{K.value=!1}}})},ze=async a=>{if(a.source==="api"){p.warning("接口推送的价库数据不可删除");return}try{await me.confirm(`确定要删除日期 ${de(a.biz_date)} 的价库记录吗？`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await w.delete(`/res-hotel-daily-stocks/${a.id}`),p.success("删除成功"),await z(V.value.id)}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error(e))}},ue=()=>{var a;d.value={dateRange:null,cost_price:0,sale_price:0,stock_total:0,stock_sold:0},(a=M.value)==null||a.clearValidate()},ne=()=>{var a;i.value={biz_date:null,cost_price:0,sale_price:0,stock_total:0,stock_sold:0,source:"manual"},(a=q.value)==null||a.clearValidate(),D.value=null},Fe=()=>{V.value=null,j.value=[],S.value=null,D.value=null},Be=a=>{if(!a)return"";const e=new Date(a),f=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),W=String(e.getHours()).padStart(2,"0"),X=String(e.getMinutes()).padStart(2,"0");return`${f}-${u}-${y} ${W}:${X}`},de=a=>{if(!a)return"";const e=new Date(a),f=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0");return`${f}-${u}-${y}`};return Ee(()=>{ke()}),(a,e)=>{const f=g("el-page-header"),u=g("el-descriptions-item"),y=g("el-tag"),W=g("el-descriptions"),X=g("el-divider"),b=g("el-button"),v=g("el-table-column"),ie=g("el-table"),Ye=g("el-card"),F=g("el-input"),_=g("el-form-item"),x=g("el-input-number"),Me=g("el-switch"),Z=g("el-form"),I=g("el-dialog"),ee=g("el-date-picker"),le=Ie("loading");return T(),pe("div",null,[l(f,{onBack:be,title:"返回打包酒店列表"},{content:t(()=>[...e[26]||(e[26]=[U("span",null,"打包酒店详情",-1)])]),_:1}),te((T(),A(Ye,{style:{"margin-top":"20px"}},{default:t(()=>[k.value?(T(),pe("div",He,[l(W,{title:"酒店基本信息",column:2,border:""},{default:t(()=>[l(u,{label:"酒店名称"},{default:t(()=>[r(m(k.value.name),1)]),_:1}),l(u,{label:"酒店编码"},{default:t(()=>[r(m(k.value.code),1)]),_:1}),l(u,{label:"所属景区"},{default:t(()=>{var s;return[r(m(((s=k.value.scenic_spot)==null?void 0:s.name)||"-"),1)]}),_:1}),l(u,{label:"软件服务商"},{default:t(()=>{var s;return[r(m(((s=k.value.software_provider)==null?void 0:s.name)||"-"),1)]}),_:1}),l(u,{label:"外部酒店编号"},{default:t(()=>[r(m(k.value.external_hotel_id||"-"),1)]),_:1}),l(u,{label:"状态"},{default:t(()=>[l(y,{type:k.value.is_active?"success":"danger"},{default:t(()=>[r(m(k.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),l(u,{label:"地址"},{default:t(()=>[r(m(k.value.address||"-"),1)]),_:1}),l(u,{label:"联系电话"},{default:t(()=>[r(m(k.value.contact_phone||"-"),1)]),_:1}),l(u,{label:"创建时间"},{default:t(()=>[r(m(Be(k.value.created_at)),1)]),_:1}),l(u,{label:"酒店描述",span:2},{default:t(()=>[r(m(k.value.description||"-"),1)]),_:1})]),_:1}),l(X,{"content-position":"left"},{default:t(()=>[...e[27]||(e[27]=[r("房型管理",-1)])]),_:1}),U("div",Le,[l(b,{type:"primary",onClick:Ve},{default:t(()=>[...e[28]||(e[28]=[r("添加房型",-1)])]),_:1})]),te((T(),A(ie,{data:oe.value,border:""},{default:t(()=>[l(v,{prop:"name",label:"房型名称",width:"150"}),l(v,{prop:"code",label:"房型编码",width:"150"}),l(v,{prop:"external_room_id",label:"外部房型ID",width:"150"},{default:t(({row:s})=>[r(m(s.external_room_id||"-"),1)]),_:1}),l(v,{prop:"max_occupancy",label:"最大入住人数",width:"120"}),l(v,{prop:"bed_type",label:"床型",width:"100"}),l(v,{prop:"room_area",label:"房间面积（㎡）",width:"120"},{default:t(({row:s})=>[r(m(s.room_area||"-"),1)]),_:1}),l(v,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(v,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:s})=>[l(y,{type:s.is_active?"success":"danger"},{default:t(()=>[r(m(s.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(v,{label:"操作",width:"200",fixed:"right"},{default:t(({row:s})=>[l(b,{size:"small",type:"primary",onClick:o=>he(s)},{default:t(()=>[...e[29]||(e[29]=[r("管理价库",-1)])]),_:1},8,["onClick"]),l(b,{size:"small",onClick:o=>xe(s)},{default:t(()=>[...e[30]||(e[30]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(b,{size:"small",type:"danger",onClick:o=>Se(s)},{default:t(()=>[...e[31]||(e[31]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,L.value]])])):ce("",!0)]),_:1})),[[le,H.value]]),l(I,{modelValue:R.value,"onUpdate:modelValue":e[9]||(e[9]=s=>R.value=s),title:_e.value,width:"600px",onClose:re},{footer:t(()=>[l(b,{onClick:e[8]||(e[8]=s=>R.value=!1)},{default:t(()=>[...e[33]||(e[33]=[r("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:we,loading:O.value},{default:t(()=>[...e[34]||(e[34]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Z,{ref_key:"roomTypeFormRef",ref:B,model:c.value,rules:fe,"label-width":"120px"},{default:t(()=>[l(_,{label:"房型名称",prop:"name"},{default:t(()=>[l(F,{modelValue:c.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.name=s),placeholder:"请输入房型名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"房型编码",prop:"code"},{default:t(()=>[l(F,{modelValue:c.value.code,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value.code=s),placeholder:"系统自动生成",disabled:!0},null,8,["modelValue"]),e[32]||(e[32]=U("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 房型编码由系统自动生成，格式：R + 5位数字（如 R00001） ",-1))]),_:1}),l(_,{label:"外部房型ID",prop:"external_room_id"},{default:t(()=>[l(F,{modelValue:c.value.external_room_id,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.external_room_id=s),placeholder:"用于API对接的第三方房型ID（可选）"},null,8,["modelValue"])]),_:1}),l(_,{label:"最大入住人数",prop:"max_occupancy"},{default:t(()=>[l(x,{modelValue:c.value.max_occupancy,"onUpdate:modelValue":e[3]||(e[3]=s=>c.value.max_occupancy=s),min:1,max:10},null,8,["modelValue"])]),_:1}),l(_,{label:"床型",prop:"bed_type"},{default:t(()=>[l(F,{modelValue:c.value.bed_type,"onUpdate:modelValue":e[4]||(e[4]=s=>c.value.bed_type=s),placeholder:"如：双床、大床等"},null,8,["modelValue"])]),_:1}),l(_,{label:"房间面积（㎡）",prop:"room_area"},{default:t(()=>[l(x,{modelValue:c.value.room_area,"onUpdate:modelValue":e[5]||(e[5]=s=>c.value.room_area=s),min:0,precision:2},null,8,["modelValue"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:t(()=>[l(F,{modelValue:c.value.description,"onUpdate:modelValue":e[6]||(e[6]=s=>c.value.description=s),type:"textarea",rows:3,placeholder:"请输入房型描述"},null,8,["modelValue"])]),_:1}),l(_,{label:"状态",prop:"is_active"},{default:t(()=>[l(Me,{modelValue:c.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=s=>c.value.is_active=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(I,{modelValue:P.value,"onUpdate:modelValue":e[25]||(e[25]=s=>P.value=s),title:"价库管理",width:"1200px",onClose:Fe},{default:t(()=>{var s;return[U("div",Oe,[U("span",Pe,"房型："+m((s=V.value)==null?void 0:s.name),1),l(b,{type:"primary",onClick:Ce},{default:t(()=>[...e[35]||(e[35]=[r("批量设置",-1)])]),_:1}),l(b,{type:"primary",onClick:Te},{default:t(()=>[...e[36]||(e[36]=[r("添加价库",-1)])]),_:1}),l(ee,{modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=o=>S.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"20px"},"value-format":"YYYY-MM-DD",onChange:Re},null,8,["modelValue"])]),te((T(),A(ie,{data:j.value,border:""},{default:t(()=>[l(v,{prop:"biz_date",label:"日期",width:"120"},{default:t(({row:o})=>[r(m(de(o.biz_date)),1)]),_:1}),l(v,{prop:"cost_price",label:"成本价",width:"100"},{default:t(({row:o})=>[r(" ¥"+m(o.cost_price),1)]),_:1}),l(v,{prop:"sale_price",label:"售价",width:"100"},{default:t(({row:o})=>[r(" ¥"+m(o.sale_price),1)]),_:1}),l(v,{prop:"stock_total",label:"总库存",width:"100"}),l(v,{prop:"stock_sold",label:"已售",width:"100"}),l(v,{prop:"stock_available",label:"可用库存",width:"100"}),l(v,{prop:"source",label:"来源",width:"100"},{default:t(({row:o})=>[l(y,{type:o.source==="manual"?"primary":"success"},{default:t(()=>[r(m(o.source==="manual"?"人工维护":"接口推送"),1)]),_:2},1032,["type"])]),_:1}),l(v,{label:"操作",width:"200",fixed:"right"},{default:t(({row:o})=>[l(b,{size:"small",onClick:qe=>Ue(o),disabled:o.source==="api"},{default:t(()=>[...e[37]||(e[37]=[r(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),l(b,{size:"small",type:"danger",onClick:qe=>ze(o),disabled:o.source==="api"},{default:t(()=>[...e[38]||(e[38]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[le,G.value]]),l(I,{modelValue:$.value,"onUpdate:modelValue":e[17]||(e[17]=o=>$.value=o),title:"批量设置价库",width:"600px","append-to-body":"",onClose:ue},{footer:t(()=>[l(b,{onClick:e[16]||(e[16]=o=>$.value=!1)},{default:t(()=>[...e[39]||(e[39]=[r("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:De,loading:J.value},{default:t(()=>[...e[40]||(e[40]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Z,{ref_key:"batchStockFormRef",ref:M,model:d.value,rules:ge,"label-width":"120px"},{default:t(()=>[l(_,{label:"日期范围",prop:"dateRange"},{default:t(()=>[l(ee,{modelValue:d.value.dateRange,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(_,{label:"成本价",prop:"cost_price"},{default:t(()=>[l(x,{modelValue:d.value.cost_price,"onUpdate:modelValue":e[12]||(e[12]=o=>d.value.cost_price=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"售价",prop:"sale_price"},{default:t(()=>[l(x,{modelValue:d.value.sale_price,"onUpdate:modelValue":e[13]||(e[13]=o=>d.value.sale_price=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"总库存",prop:"stock_total"},{default:t(()=>[l(x,{modelValue:d.value.stock_total,"onUpdate:modelValue":e[14]||(e[14]=o=>d.value.stock_total=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"已售库存",prop:"stock_sold"},{default:t(()=>[l(x,{modelValue:d.value.stock_sold,"onUpdate:modelValue":e[15]||(e[15]=o=>d.value.stock_sold=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(I,{modelValue:C.value,"onUpdate:modelValue":e[24]||(e[24]=o=>C.value=o),title:ve.value,width:"600px","append-to-body":"",onClose:ne},{footer:t(()=>[l(b,{onClick:e[23]||(e[23]=o=>C.value=!1)},{default:t(()=>[...e[41]||(e[41]=[r("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:$e,loading:K.value,disabled:i.value.source==="api"},{default:t(()=>[...e[42]||(e[42]=[r(" 确定 ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[l(Z,{ref_key:"stockFormRef",ref:q,model:i.value,rules:ye,"label-width":"120px"},{default:t(()=>[l(_,{label:"日期",prop:"biz_date"},{default:t(()=>[l(ee,{modelValue:i.value.biz_date,"onUpdate:modelValue":e[18]||(e[18]=o=>i.value.biz_date=o),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD",disabled:E.value},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"成本价",prop:"cost_price"},{default:t(()=>[l(x,{modelValue:i.value.cost_price,"onUpdate:modelValue":e[19]||(e[19]=o=>i.value.cost_price=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"售价",prop:"sale_price"},{default:t(()=>[l(x,{modelValue:i.value.sale_price,"onUpdate:modelValue":e[20]||(e[20]=o=>i.value.sale_price=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"总库存",prop:"stock_total"},{default:t(()=>[l(x,{modelValue:i.value.stock_total,"onUpdate:modelValue":e[21]||(e[21]=o=>i.value.stock_total=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"已售库存",prop:"stock_sold"},{default:t(()=>[l(x,{modelValue:i.value.stock_sold,"onUpdate:modelValue":e[22]||(e[22]=o=>i.value.stock_sold=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),E.value?(T(),A(_,{key:0,label:"来源"},{default:t(()=>[l(y,{type:i.value.source==="manual"?"primary":"success"},{default:t(()=>[r(m(i.value.source==="manual"?"人工维护":"接口推送"),1)]),_:1},8,["type"]),U("span",je,m(i.value.source==="manual"?"（可编辑）":"（接口推送，不可编辑）"),1)]),_:1})):ce("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]}),_:1},8,["modelValue"])])}}};export{Ke as default};
