import{_ as jt,r as y,A as X,i as Mt,j as Ft,c as x,o as u,b as l,m as se,w as a,d as h,l as Pt,q as k,k as V,x as Tt,E as f,e as Yt,f as w,s as z,h as i,t as _,F as Z,p as ee,v as U}from"./app-tRAPUw1F.js";const Ot={key:0},Ut={style:{"margin-bottom":"20px",display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},Et={style:{display:"flex","align-items":"center",gap:"10px",width:"100%"}},zt={style:{"font-weight":"bold"}},St={style:{"margin-left":"auto",color:"#909399","font-size":"12px"}},At={key:0},Bt={key:1},It={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},qt={key:0},Nt={key:1},Lt={key:0},Ht={key:1},Wt={key:2},Gt={key:3},Jt={style:{"margin-bottom":"20px"}},Kt={key:0},Qt={key:1,style:{color:"#909399"}},Xt={key:2,style:{"margin-left":"10px"}},Zt={key:3,style:{"margin-left":"10px",color:"#909399"}},ea={style:{"margin-bottom":"20px"}},ta={style:{"margin-bottom":"20px"}},aa={key:0},la={key:1,style:{color:"#909399"}},sa={__name:"Detail",setup(na){const S=Tt(),De=Yt(),ce=y(!1),Ae=y(!1),Be=y(!1),Ie=y(!1),ve=y(!1),m=y(null),N=y([]),$e=y([]),fe=y([]),je=y([]),Me=y("prices"),A=y(!1),ne=y(!1),re=y(null),C=y({room_type_ids:[],market_price:0,settlement_price:0,sale_price:0}),P=y(null),E=y(null),L=y(null),oe=y([]),H=y(!1),ye=y(!1),ie=y(null),c=y({name:"",weekdays:[],dateRange:null,market_price_adjustment:0,settlement_price_adjustment:0,sale_price_adjustment:0,is_active:!0,items:[{hotel_id:null,room_type_id:null}]}),W=y(null),de=y([]),ge=y([]),te=y([]),be=y([]),ae=y(!1),ke=y(!1),G=y({ota_platform_id:null}),J=y(!1),he=y(!1),ue=y(null),K=y(null),R=y({external_code:"",start_date:"",end_date:"",is_active:!0,sort_order:0}),qe={external_code:[{required:!0,message:"请输入横店产品编码",trigger:"blur"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"},{validator:(s,e,n)=>{R.value.start_date&&e&&new Date(e)<new Date(R.value.start_date)?n(new Error("结束日期不能早于开始日期")):n()},trigger:"change"}]},Ne=X(()=>K.value?"编辑时间段映射":"添加时间段映射"),T=y({}),Le={room_type_ids:[{required:!0,message:"请至少选择一个房型",trigger:"change",validator:(s,e,n)=>{!e||e.length===0?n(new Error("请至少选择一个房型")):n()}}],market_price:[{required:!0,message:"请输入门市价",trigger:"blur"}],settlement_price:[{required:!0,message:"请输入结算价",trigger:"blur"}],sale_price:[{required:!0,message:"请输入销售价",trigger:"blur"}]},He={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],weekdays:[{validator:(s,e,n)=>{n()},trigger:"change"}],dateRange:[{validator:(s,e,n)=>{e&&e.length!==2?n(new Error("请选择完整的日期区间")):!e&&(!c.value.weekdays||c.value.weekdays.length===0)?n(new Error("请至少设置日期范围或周几")):n()},trigger:"change"}],market_price_adjustment:[{required:!0,message:"请输入门市价调整",trigger:"blur"}],settlement_price_adjustment:[{required:!0,message:"请输入结算价调整",trigger:"blur"}],sale_price_adjustment:[{required:!0,message:"请输入销售价调整",trigger:"blur"}],items:[{validator:(s,e,n)=>{!e||e.length===0?n(new Error("请至少添加一个适用房型")):e.some(o=>!o.hotel_id||!o.room_type_id)?n(new Error("请完善所有房型信息")):n()},trigger:"change"}]},We=X(()=>P.value?"编辑价格":"添加价格"),Ge=X(()=>W.value?"编辑加价规则":"添加加价规则"),Je=X(()=>{if(!N.value||N.value.length===0)return[];const s=[...new Set(N.value.map(n=>n.room_type_id))],e=new Set;return s.forEach(n=>{const r=te.value.find(o=>o.id===n);r&&r.hotel_id&&e.add(r.hotel_id)}),de.value.filter(n=>e.has(n.id))}),Ke=s=>{if(!s)return[];const e=new Set(N.value.map(n=>n.room_type_id));return te.value.filter(n=>n.hotel_id===s&&e.has(n.id))},Qe=X(()=>{let s=N.value||[];if(E.value&&(s=s.filter(e=>e.room_type_id===E.value)),L.value&&L.value.length===2){const[e,n]=L.value;s=s.filter(r=>{const o=r.date;return o>=e&&o<=n})}return s}),Fe=X(()=>{const s={};return Qe.value.forEach(e=>{const n=e.room_type_id;if(!s[n]){const r=te.value.find(v=>v.id===n),o=de.value.find(v=>v.id===(r==null?void 0:r.hotel_id));s[n]={roomTypeId:n,hotelId:r==null?void 0:r.hotel_id,hotelName:(o==null?void 0:o.name)||"未知酒店",roomTypeName:(r==null?void 0:r.name)||"未知房型",prices:[],dateRanges:[]}}s[n].prices.push(e)}),Object.values(s).forEach(e=>{e.prices.sort((r,o)=>new Date(r.date)-new Date(o.date));const n={};e.prices.forEach(r=>{const o=`${r.market_price}_${r.settlement_price}_${r.sale_price}_${r.source}`;n[o]||(n[o]={market_price:r.market_price,settlement_price:r.settlement_price,sale_price:r.sale_price,source:r.source,dates:[]}),n[o].dates.push(r.date)}),e.dateRanges=Object.values(n).map(r=>{const o=r.dates.sort();let v=[],d=o[0],b=o[0];for(let D=1;D<o.length;D++){const F=new Date(o[D]),B=new Date(o[D-1]);(F-B)/(1e3*60*60*24)===1||(v.push({start:d,end:b,...r}),d=o[D]),b=o[D]}return v.push({start:d,end:b,...r}),v}).flat()}),Object.values(s).forEach(e=>{if(e.prices.length>0){const n=e.prices.map(r=>r.date).sort();e.dateRange=`${M(n[0])} 至 ${M(n[n.length-1])}`}else e.dateRange="-"}),Object.values(s)}),Xe=()=>{De.push("/products")},Y=async()=>{var s,e,n,r,o,v,d;ce.value=!0;try{const b=await V.get(`/products/${S.params.id}`);if(!b.data||!b.data.data)throw new Error("返回数据格式错误");m.value=b.data.data,N.value=m.value.prices||[],$e.value=m.value.price_rules||[],fe.value=m.value.ota_products||[],await Ce(),m.value&&m.value.scenic_spot_id&&(await Te(),await Ye())}catch(b){const D=((e=(s=b.response)==null?void 0:s.data)==null?void 0:e.message)||((r=(n=b.response)==null?void 0:n.data)==null?void 0:r.error)||b.message||"获取产品详情失败";f.error(D),console.error("获取产品详情失败:",{error:b,response:b.response,status:(o=b.response)==null?void 0:o.status,data:(v=b.response)==null?void 0:v.data}),((d=b.response)==null?void 0:d.status)===403&&setTimeout(()=>{De.push("/products")},2e3)}finally{ce.value=!1}},we=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",M=s=>{if(!s)return"";const e=new Date(s),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${o}`},O=s=>s?parseFloat(s).toFixed(2):"0.00",Ze=s=>{if(!s)return"";const e={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"日"};return s.split(",").map(n=>e[n]||n).join("、")},et=()=>{if(!m.value.sale_start_date||!m.value.sale_end_date){f.warning("请先在产品编辑页面设置销售开始日期和结束日期");return}P.value=null,xe(),A.value=!0},Pe=s=>{P.value=s.id,C.value={room_type_ids:[s.room_type_id],market_price:parseFloat(s.market_price),settlement_price:parseFloat(s.settlement_price),sale_price:parseFloat(s.sale_price)},A.value=!0},tt=async s=>{try{await U.confirm("确定要删除该价格记录吗？","提示",{type:"warning"}),await V.delete(`/prices/${s.id}`),f.success("删除成功"),Y()}catch(e){e!=="cancel"&&f.error("删除失败")}},at=(s,e)=>{const n=s.prices.filter(r=>{const o=r.date;return o>=e.start&&o<=e.end});if(n.length!==0){if(n.length===1){Pe(n[0]);return}U.confirm(`该日期范围包含 ${n.length} 天的价格记录。是否批量编辑为相同价格？`,"批量编辑",{confirmButtonText:"批量编辑",cancelButtonText:"取消",type:"info"}).then(()=>{const r=n[0];P.value=null,C.value={room_type_ids:[s.roomTypeId],market_price:parseFloat(r.market_price),settlement_price:parseFloat(r.settlement_price),sale_price:parseFloat(r.sale_price)},A.value=!0}).catch(()=>{})}},lt=async(s,e)=>{try{const n=s.prices.filter(r=>{const o=r.date;return o>=e.start&&o<=e.end});if(n.length===0)return;await U.confirm(`确定要删除该日期范围（${M(e.start)} 至 ${M(e.end)}）的 ${n.length} 条价格记录吗？`,"提示",{type:"warning"}),await Promise.all(n.map(r=>V.delete(`/prices/${r.id}`))),f.success("删除成功"),Y()}catch(n){n!=="cancel"&&f.error("删除失败")}},Te=async()=>{try{const s=await V.get("/hotels",{params:{scenic_spot_id:m.value.scenic_spot_id,per_page:1e3}});de.value=s.data.data||[]}catch(s){console.error("获取酒店列表失败",s)}},Ye=async()=>{try{const s=await V.get("/room-types",{params:{per_page:1e3}});te.value=s.data.data||[],ge.value=te.value.filter(e=>de.value.some(n=>n.id===e.hotel_id))}catch(s){console.error("获取房型列表失败",s)}},Oe=()=>{E.value&&!oe.value.includes(E.value)&&oe.value.push(E.value)},st=()=>{E.value=null,L.value=null},nt=async()=>{re.value&&await re.value.validate(async s=>{var e,n;if(s){ne.value=!0;try{if(P.value)await V.put(`/prices/${P.value}`,{market_price:C.value.market_price,settlement_price:C.value.settlement_price,sale_price:C.value.sale_price}),f.success("价格更新成功");else{if(!m.value.sale_start_date||!m.value.sale_end_date){f.warning("请先在产品编辑页面设置销售开始日期和结束日期"),ne.value=!1;return}const r=m.value.sale_start_date,o=m.value.sale_end_date,v=[],d=new Date(r),b=new Date(o);for(let F=new Date(d);F<=b;F.setDate(F.getDate()+1))v.push({date:F.toISOString().split("T")[0],market_price:C.value.market_price,settlement_price:C.value.settlement_price,sale_price:C.value.sale_price});const D=C.value.room_type_ids.map(F=>V.post("/prices",{product_id:m.value.id,room_type_id:F,prices:v}));await Promise.all(D),f.success(`成功为 ${C.value.room_type_ids.length} 个房型创建价格`)}A.value=!1,xe(),Y()}catch(r){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败";f.error(o)}finally{ne.value=!1}}})},xe=()=>{var s;C.value={room_type_ids:[],market_price:0,settlement_price:0,sale_price:0},P.value=null,(s=re.value)==null||s.clearValidate()},rt=()=>{W.value=null,Ve(),H.value=!0},ot=async s=>{W.value=s.id;try{const e=s.items?s:(await V.get(`/price-rules/${s.id}`)).data.data||s;let n=null,r=[];e.type==="weekday"?(r=e.weekdays?e.weekdays.split(","):[],n=null):e.type==="date_range"?(n=e.start_date&&e.end_date?[e.start_date,e.end_date]:null,r=[]):(n=e.start_date&&e.end_date?[e.start_date,e.end_date]:null,r=e.weekdays?e.weekdays.split(","):[]),c.value={name:e.name||"",weekdays:r,dateRange:n,market_price_adjustment:parseFloat(e.market_price_adjustment)||0,settlement_price_adjustment:parseFloat(e.settlement_price_adjustment)||0,sale_price_adjustment:parseFloat(e.sale_price_adjustment)||0,is_active:e.is_active??!0,items:e.items&&e.items.length>0?e.items.map(o=>({hotel_id:o.hotel_id,room_type_id:o.room_type_id})):[{hotel_id:null,room_type_id:null}]},H.value=!0}catch{f.error("获取加价规则详情失败")}},it=async s=>{try{await U.confirm("确定要删除该加价规则吗？","提示",{type:"warning"}),await V.delete(`/price-rules/${s.id}`),f.success("删除成功"),Y()}catch(e){e!=="cancel"&&f.error("删除失败")}},dt=()=>{c.value.items.push({hotel_id:null,room_type_id:null})},ut=s=>{c.value.items.splice(s,1)},pt=s=>{c.value.items[s].room_type_id=null},_t=async()=>{ie.value&&await ie.value.validate(async s=>{var e,n;if(s){if(!c.value.dateRange&&(!c.value.weekdays||c.value.weekdays.length===0)){f.error("请至少设置日期范围或周几");return}ye.value=!0;try{const r={product_id:m.value.id,name:c.value.name,type:"combined",market_price_adjustment:c.value.market_price_adjustment,settlement_price_adjustment:c.value.settlement_price_adjustment,sale_price_adjustment:c.value.sale_price_adjustment,is_active:c.value.is_active,items:c.value.items};c.value.dateRange&&c.value.dateRange.length===2&&(r.start_date=c.value.dateRange[0],r.end_date=c.value.dateRange[1]),c.value.weekdays&&c.value.weekdays.length>0&&(r.weekdays=c.value.weekdays.join(",")),W.value?(await V.put(`/price-rules/${W.value}`,r),f.success("加价规则更新成功")):(await V.post("/price-rules",r),f.success("加价规则创建成功")),H.value=!1,Ve(),Y()}catch(r){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败";f.error(o)}finally{ye.value=!1}}})},Ve=()=>{var s;c.value={name:"",weekdays:[],dateRange:null,market_price_adjustment:0,settlement_price_adjustment:0,sale_price_adjustment:0,is_active:!0,items:[{hotel_id:null,room_type_id:null}]},W.value=null,(s=ie.value)==null||s.clearValidate()},mt=async()=>{try{const s=await V.get("/ota-platforms",{params:{active_only:!0}});be.value=s.data.data||[]}catch(s){console.error("获取OTA平台列表失败",s)}},ct=()=>{G.value={ota_platform_id:null},ae.value=!0},vt=async()=>{var s,e;if(!G.value.ota_platform_id){f.warning("请选择OTA平台");return}ke.value=!0;try{const n=await V.post(`/products/${S.params.id}/bind-ota`,{ota_platform_id:G.value.ota_platform_id});n.data.success?(f.success("绑定成功"),ae.value=!1,Y()):f.error(n.data.message||"绑定失败")}catch(n){const r=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||"绑定失败";f.error(r)}finally{ke.value=!1}},ft=async s=>{var e,n,r,o;try{await U.confirm(`确定要推送产品到 ${(e=s.ota_platform)==null?void 0:e.name} 吗？`,"确认推送",{type:"warning",confirmButtonText:"确定推送",cancelButtonText:"取消"});const v=await V.post(`/ota-products/${s.id}/push`);v.data.success?(v.data.message&&v.data.message.includes("后台处理")?f.success("推送任务已提交，正在后台处理中"):f.success("推送成功"),v.data.data&&(s.push_status=v.data.data.push_status,s.push_started_at=v.data.data.push_started_at),((n=v.data.data)==null?void 0:n.push_status)==="processing"?bt(s.id):Y()):f.error(v.data.message||"推送失败")}catch(v){if(v!=="cancel"){const d=((o=(r=v.response)==null?void 0:r.data)==null?void 0:o.message)||"推送失败";f.error(d)}}},yt=async s=>{var e,n,r;try{!s.pushed_at?await U.prompt("请选择OTA平台","编辑OTA产品",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"select",inputOptions:be.value.reduce((v,d)=>(v[d.id]=d.name,v),{}),inputValue:(e=s.ota_platform_id)==null?void 0:e.toString()}).then(async({value:v})=>{const d=parseInt(v);await V.put(`/ota-products/${s.id}`,{ota_platform_id:d,is_active:s.is_active}),f.success("更新成功"),Y()}):await U.prompt("请选择状态","编辑OTA产品",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"select",inputOptions:{true:"启用",false:"禁用"},inputValue:s.is_active?"true":"false"}).then(async({value:v})=>{const d=v==="true";await V.put(`/ota-products/${s.id}`,{is_active:d}),f.success("更新成功"),Y()})}catch(o){if(o!=="cancel"){const v=((r=(n=o.response)==null?void 0:n.data)==null?void 0:r.message)||"更新失败";f.error(v)}}},gt=async s=>{var e,n;try{await U.confirm("确定要删除该OTA推送记录吗？","提示",{type:"warning"}),await V.delete(`/ota-products/${s.id}`),f.success("删除成功"),Y()}catch(r){if(r!=="cancel"){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"删除失败";f.error(o)}}},bt=s=>{T.value[s]&&clearInterval(T.value[s]),T.value[s]=setInterval(async()=>{var e,n,r,o;try{const d=(n=(e=(await V.get(`/products/${S.params.id}`)).data.data)==null?void 0:e.ota_products)==null?void 0:n.find(b=>b.id===s);if(d){const b=fe.value.find(D=>D.id===s);b&&(b.push_status=d.push_status,b.push_message=d.push_message,b.push_completed_at=d.push_completed_at),d.push_status!=="processing"&&(clearInterval(T.value[s]),delete T.value[s],d.push_status==="success"?f.success(`产品 ${(r=d.ota_platform)==null?void 0:r.name} 推送成功`):d.push_status==="failed"&&f.error(`产品 ${(o=d.ota_platform)==null?void 0:o.name} 推送失败：${d.push_message||"未知错误"}`))}else clearInterval(T.value[s]),delete T.value[s]}catch(v){console.error("轮询推送状态失败",v),clearInterval(T.value[s]),delete T.value[s]}},3e3)},kt=()=>{Object.values(T.value).forEach(s=>{clearInterval(s)}),T.value={}};Mt(async()=>{await Y(),await mt(),m.value&&(await Te(),await Ye())});const Ce=async()=>{ve.value=!0;try{const s=await V.get(`/products/${S.params.id}/external-code-mappings`);je.value=s.data.data||[]}catch(s){console.error("获取外部编码映射列表失败",s),f.error("获取外部编码映射列表失败")}finally{ve.value=!1}},ht=()=>{K.value=null,Re(),J.value=!0},wt=s=>{K.value=s.id,R.value={external_code:s.external_code,start_date:s.start_date,end_date:s.end_date,is_active:s.is_active,sort_order:s.sort_order},J.value=!0},xt=async s=>{var e,n;try{await U.confirm("确定要删除该时间段映射吗？","提示",{type:"warning"}),await V.delete(`/products/${S.params.id}/external-code-mappings/${s.id}`),f.success("删除成功"),await Ce()}catch(r){if(r!=="cancel"){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"删除失败";f.error(o)}}},Vt=async()=>{ue.value&&await ue.value.validate(async s=>{var e,n;if(s){he.value=!0;try{const r={external_code:R.value.external_code,start_date:R.value.start_date,end_date:R.value.end_date,is_active:R.value.is_active,sort_order:R.value.sort_order};K.value?(await V.put(`/products/${S.params.id}/external-code-mappings/${K.value}`,r),f.success("时间段映射更新成功")):(await V.post(`/products/${S.params.id}/external-code-mappings`,r),f.success("时间段映射创建成功")),J.value=!1,Re(),await Ce()}catch(r){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败";f.error(o)}finally{he.value=!1}}})},Re=()=>{var s;R.value={external_code:"",start_date:"",end_date:"",is_active:!0,sort_order:0},K.value=null,(s=ue.value)==null||s.clearValidate()};return Ft(()=>{kt()}),(s,e)=>{const n=h("el-page-header"),r=h("el-descriptions-item"),o=h("el-tag"),v=h("el-descriptions"),d=h("el-button"),b=h("el-option"),D=h("el-select"),F=h("el-date-picker"),B=h("el-alert"),g=h("el-table-column"),Q=h("el-table"),Ue=h("el-collapse-item"),Ee=h("el-collapse"),Ct=h("el-empty"),$=h("el-form-item"),I=h("el-input-number"),pe=h("el-form"),_e=h("el-dialog"),me=h("el-tab-pane"),ze=h("el-input"),q=h("el-checkbox"),Rt=h("el-checkbox-group"),Se=h("el-switch"),Dt=h("el-tabs"),$t=h("el-card"),le=Pt("loading");return u(),x("div",null,[l(n,{onBack:Xe,title:"返回产品列表"},{content:a(()=>[...e[29]||(e[29]=[w("span",null,"产品详情",-1)])]),_:1}),se((u(),k($t,{style:{"margin-top":"20px"}},{default:a(()=>[m.value?(u(),x("div",Ot,[l(v,{title:"产品基本信息",column:2,border:""},{default:a(()=>[l(r,{label:"产品名称"},{default:a(()=>[i(_(m.value.name),1)]),_:1}),l(r,{label:"产品编码"},{default:a(()=>[i(_(m.value.code),1)]),_:1}),l(r,{label:"所属景区"},{default:a(()=>{var t;return[i(_(((t=m.value.scenic_spot)==null?void 0:t.name)||"-"),1)]}),_:1}),l(r,{label:"价格来源"},{default:a(()=>[l(o,{type:m.value.price_source==="manual"?"primary":"success"},{default:a(()=>[i(_(m.value.price_source==="manual"?"人工维护":"接口推送"),1)]),_:1},8,["type"])]),_:1}),l(r,{label:"状态"},{default:a(()=>[l(o,{type:m.value.is_active?"success":"danger"},{default:a(()=>[i(_(m.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),l(r,{label:"入住天数"},{default:a(()=>[i(_(m.value.stay_days?`${m.value.stay_days} 晚`:"单晚"),1)]),_:1}),l(r,{label:"创建时间"},{default:a(()=>[i(_(we(m.value.created_at)),1)]),_:1}),l(r,{label:"销售开始日期"},{default:a(()=>[i(_(m.value.sale_start_date?M(m.value.sale_start_date):"不限制"),1)]),_:1}),l(r,{label:"销售结束日期"},{default:a(()=>[i(_(m.value.sale_end_date?M(m.value.sale_end_date):"不限制"),1)]),_:1}),l(r,{label:"外部产品编码（默认）",span:2},{default:a(()=>[i(_(m.value.external_code||"未设置")+" ",1),e[30]||(e[30]=w("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," （当没有时间段映射时使用此编码） ",-1))]),_:1}),l(r,{label:"产品描述",span:2},{default:a(()=>[i(_(m.value.description||"-"),1)]),_:1})]),_:1}),l(Dt,{modelValue:Me.value,"onUpdate:modelValue":e[28]||(e[28]=t=>Me.value=t),style:{"margin-top":"20px"}},{default:a(()=>[l(me,{label:"价格管理",name:"prices"},{default:a(()=>[w("div",Ut,[m.value.price_source==="manual"?(u(),k(d,{key:0,type:"primary",onClick:et},{default:a(()=>[...e[31]||(e[31]=[i(" 添加价格 ",-1)])]),_:1})):z("",!0),l(D,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=t=>E.value=t),placeholder:"筛选房型",clearable:"",style:{width:"200px"},onChange:Oe},{default:a(()=>[(u(!0),x(Z,null,ee(ge.value,t=>{var p;return u(),k(b,{key:t.id,label:`${((p=t.hotel)==null?void 0:p.name)||""} - ${t.name}`,value:t.id},null,8,["label","value"])}),128))]),_:1},8,["modelValue"]),l(F,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=t=>L.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"},onChange:Oe},null,8,["modelValue"]),l(d,{onClick:st,size:"small"},{default:a(()=>[...e[32]||(e[32]=[i("重置筛选",-1)])]),_:1}),m.value.price_source!=="manual"?(u(),k(B,{key:1,title:"提示",type:"info",description:"该产品的价格由接口推送，无法手动管理",closable:!1,style:{flex:"1"}})):z("",!0)]),se((u(),x("div",null,[Fe.value.length>0?(u(),k(Ee,{key:0,modelValue:oe.value,"onUpdate:modelValue":e[2]||(e[2]=t=>oe.value=t)},{default:a(()=>[(u(!0),x(Z,null,ee(Fe.value,t=>(u(),k(Ue,{key:t.roomTypeId,name:t.roomTypeId},{title:a(()=>[w("div",Et,[w("span",zt,_(t.hotelName)+" - "+_(t.roomTypeName),1),l(o,{size:"small",type:"info"},{default:a(()=>[i(_(t.prices.length)+" 条价格记录 ",1)]),_:2},1024),w("span",St," 日期范围: "+_(t.dateRange),1)])]),default:a(()=>[l(Q,{data:t.dateRanges,border:"",size:"small",style:{"margin-top":"10px"}},{default:a(()=>[l(g,{label:"日期范围",width:"200"},{default:a(({row:p})=>[p.start===p.end?(u(),x("span",At,_(M(p.start)),1)):(u(),x("span",Bt,_(M(p.start))+" 至 "+_(M(p.end)),1))]),_:1}),l(g,{prop:"market_price",label:"门市价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.market_price)),1)]),_:1}),l(g,{prop:"settlement_price",label:"结算价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.settlement_price)),1)]),_:1}),l(g,{prop:"sale_price",label:"销售价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.sale_price)),1)]),_:1}),l(g,{prop:"source",label:"来源",width:"100"},{default:a(({row:p})=>[l(o,{type:p.source==="manual"?"primary":"success",size:"small"},{default:a(()=>[i(_(p.source==="manual"?"人工":"接口"),1)]),_:2},1032,["type"])]),_:1}),m.value.price_source==="manual"?(u(),k(g,{key:0,label:"操作",width:"200"},{default:a(({row:p})=>[l(d,{size:"small",onClick:j=>at(t,p)},{default:a(()=>[...e[33]||(e[33]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:j=>lt(t,p)},{default:a(()=>[...e[34]||(e[34]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):z("",!0)]),_:2},1032,["data"]),t.dateRanges.length>0?(u(),k(Ee,{key:0,style:{"margin-top":"10px"}},{default:a(()=>[l(Ue,{title:"查看详细日期列表",name:`detail-${t.roomTypeId}`},{default:a(()=>[l(Q,{data:t.prices,border:"",size:"small"},{default:a(()=>[l(g,{prop:"date",label:"日期",width:"120"}),l(g,{prop:"market_price",label:"门市价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.market_price)),1)]),_:1}),l(g,{prop:"settlement_price",label:"结算价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.settlement_price)),1)]),_:1}),l(g,{prop:"sale_price",label:"销售价（元）",width:"120"},{default:a(({row:p})=>[i(_(O(p.sale_price)),1)]),_:1}),l(g,{prop:"source",label:"来源",width:"100"},{default:a(({row:p})=>[l(o,{type:p.source==="manual"?"primary":"success",size:"small"},{default:a(()=>[i(_(p.source==="manual"?"人工":"接口"),1)]),_:2},1032,["type"])]),_:1}),m.value.price_source==="manual"?(u(),k(g,{key:0,label:"操作",width:"150"},{default:a(({row:p})=>[l(d,{size:"small",onClick:j=>Pe(p)},{default:a(()=>[...e[35]||(e[35]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:j=>tt(p)},{default:a(()=>[...e[36]||(e[36]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})):z("",!0)]),_:1},8,["data"])]),_:2},1032,["name"])]),_:2},1024)):z("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):(u(),k(Ct,{key:1,description:"暂无价格数据"}))])),[[le,Ae.value]]),l(_e,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=t=>A.value=t),title:We.value,width:"600px",onClose:xe},{footer:a(()=>[l(d,{onClick:e[7]||(e[7]=t=>A.value=!1)},{default:a(()=>[...e[40]||(e[40]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:nt,loading:ne.value},{default:a(()=>[...e[41]||(e[41]=[i("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(pe,{ref_key:"priceFormRef",ref:re,model:C.value,rules:Le,"label-width":"120px"},{default:a(()=>[l($,{label:"选择房型",prop:"room_type_ids"},{default:a(()=>[l(D,{modelValue:C.value.room_type_ids,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value.room_type_ids=t),multiple:!P.value,disabled:!!P.value,placeholder:P.value?"编辑模式下不可修改房型":"请选择房型（可多选）",style:{width:"100%"}},{default:a(()=>[(u(!0),x(Z,null,ee(ge.value,t=>{var p;return u(),k(b,{key:t.id,label:`${(p=t.hotel)==null?void 0:p.name} - ${t.name}`,value:t.id},null,8,["label","value"])}),128))]),_:1},8,["modelValue","multiple","disabled","placeholder"]),w("span",It,[P.value?(u(),x("span",qt,"编辑模式下只能修改价格，不能修改房型")):(u(),x("span",Nt,"可同时为多个房型设置价格"))])]),_:1}),l($,{label:"日期范围"},{default:a(()=>[m.value.sale_start_date||m.value.sale_end_date?(u(),k(B,{key:0,type:"info",closable:!1},{title:a(()=>[e[37]||(e[37]=w("span",null,"将使用产品的销售日期范围：",-1)),m.value.sale_start_date?(u(),x("span",Lt,_(M(m.value.sale_start_date)),1)):(u(),x("span",Ht,"不限制")),e[38]||(e[38]=w("span",null," 至 ",-1)),m.value.sale_end_date?(u(),x("span",Wt,_(M(m.value.sale_end_date)),1)):(u(),x("span",Gt,"不限制"))]),_:1})):(u(),k(B,{key:1,type:"warning",closable:!1},{title:a(()=>[...e[39]||(e[39]=[w("span",null,"产品未设置销售日期范围，请先在产品编辑页面设置销售开始日期和结束日期",-1)])]),_:1}))]),_:1}),l($,{label:"门市价（元）",prop:"market_price"},{default:a(()=>[l(I,{modelValue:C.value.market_price,"onUpdate:modelValue":e[4]||(e[4]=t=>C.value.market_price=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"结算价（元）",prop:"settlement_price"},{default:a(()=>[l(I,{modelValue:C.value.settlement_price,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value.settlement_price=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"销售价（元）",prop:"sale_price"},{default:a(()=>[l(I,{modelValue:C.value.sale_price,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value.sale_price=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),l(me,{label:"加价规则",name:"priceRules"},{default:a(()=>[w("div",Jt,[m.value.price_source==="manual"?(u(),k(d,{key:0,type:"primary",onClick:rt},{default:a(()=>[...e[42]||(e[42]=[i(" 添加加价规则 ",-1)])]),_:1})):(u(),k(B,{key:1,title:"提示",type:"info",description:"该产品的价格由接口推送，无法设置加价规则",closable:!1,style:{"margin-bottom":"20px"}}))]),se((u(),k(Q,{data:$e.value,border:""},{default:a(()=>[l(g,{prop:"name",label:"规则名称",width:"150"}),l(g,{prop:"type",label:"规则类型",width:"120"},{default:a(({row:t})=>[t.type==="weekday"?(u(),k(o,{key:0},{default:a(()=>[...e[43]||(e[43]=[i("周几规则",-1)])]),_:1})):t.type==="date_range"?(u(),k(o,{key:1},{default:a(()=>[...e[44]||(e[44]=[i("日期区间规则",-1)])]),_:1})):(u(),k(o,{key:2,type:"success"},{default:a(()=>[...e[45]||(e[45]=[i("统一规则",-1)])]),_:1}))]),_:1}),l(g,{label:"规则内容",width:"300"},{default:a(({row:t})=>[w("div",null,[t.start_date&&t.end_date?(u(),x("span",Kt,_(M(t.start_date))+" 至 "+_(M(t.end_date)),1)):(u(),x("span",Qt,"全时段")),t.weekdays?(u(),x("span",Xt," 周"+_(Ze(t.weekdays)),1)):t.start_date||t.end_date?(u(),x("span",Zt," （所有日期） ")):z("",!0)])]),_:1}),l(g,{label:"价格调整",width:"300"},{default:a(({row:t})=>[w("div",null,[w("span",null,"门市价: "+_(t.market_price_adjustment>=0?"+":"")+_(O(t.market_price_adjustment)),1),e[46]||(e[46]=w("br",null,null,-1)),w("span",null,"结算价: "+_(t.settlement_price_adjustment>=0?"+":"")+_(O(t.settlement_price_adjustment)),1),e[47]||(e[47]=w("br",null,null,-1)),w("span",null,"销售价: "+_(t.sale_price_adjustment>=0?"+":"")+_(O(t.sale_price_adjustment)),1)])]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:t})=>[l(o,{type:t.is_active?"success":"danger"},{default:a(()=>[i(_(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),m.value.price_source==="manual"?(u(),k(g,{key:0,label:"操作",width:"200"},{default:a(({row:t})=>[l(d,{size:"small",onClick:p=>ot(t)},{default:a(()=>[...e[48]||(e[48]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:p=>it(t)},{default:a(()=>[...e[49]||(e[49]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})):z("",!0)]),_:1},8,["data"])),[[le,Be.value]]),l(_e,{modelValue:H.value,"onUpdate:modelValue":e[17]||(e[17]=t=>H.value=t),title:Ge.value,width:"700px",onClose:Ve},{footer:a(()=>[l(d,{onClick:e[16]||(e[16]=t=>H.value=!1)},{default:a(()=>[...e[62]||(e[62]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:_t,loading:ye.value},{default:a(()=>[...e[63]||(e[63]=[i("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(pe,{ref_key:"priceRuleFormRef",ref:ie,model:c.value,rules:He,"label-width":"140px"},{default:a(()=>[l($,{label:"规则名称",prop:"name"},{default:a(()=>[l(ze,{modelValue:c.value.name,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.name=t),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l($,{label:"日期范围（可选）",prop:"dateRange"},{default:a(()=>[l(F,{modelValue:c.value.dateRange,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),e[50]||(e[50]=w("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 不选择表示全时段生效 ",-1))]),_:1}),l($,{label:"选择周几（可选）",prop:"weekdays"},{default:a(()=>[l(Rt,{modelValue:c.value.weekdays,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value.weekdays=t)},{default:a(()=>[l(q,{label:"1"},{default:a(()=>[...e[51]||(e[51]=[i("周一",-1)])]),_:1}),l(q,{label:"2"},{default:a(()=>[...e[52]||(e[52]=[i("周二",-1)])]),_:1}),l(q,{label:"3"},{default:a(()=>[...e[53]||(e[53]=[i("周三",-1)])]),_:1}),l(q,{label:"4"},{default:a(()=>[...e[54]||(e[54]=[i("周四",-1)])]),_:1}),l(q,{label:"5"},{default:a(()=>[...e[55]||(e[55]=[i("周五",-1)])]),_:1}),l(q,{label:"6"},{default:a(()=>[...e[56]||(e[56]=[i("周六",-1)])]),_:1}),l(q,{label:"7"},{default:a(()=>[...e[57]||(e[57]=[i("周日",-1)])]),_:1})]),_:1},8,["modelValue"]),e[58]||(e[58]=w("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 不选择表示日期范围内的所有日期都生效 ",-1))]),_:1}),l($,{label:"门市价调整（元）",prop:"market_price_adjustment"},{default:a(()=>[l(I,{modelValue:c.value.market_price_adjustment,"onUpdate:modelValue":e[12]||(e[12]=t=>c.value.market_price_adjustment=t),precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[59]||(e[59]=w("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 正数表示加价，负数表示减价 ",-1))]),_:1}),l($,{label:"结算价调整（元）",prop:"settlement_price_adjustment"},{default:a(()=>[l(I,{modelValue:c.value.settlement_price_adjustment,"onUpdate:modelValue":e[13]||(e[13]=t=>c.value.settlement_price_adjustment=t),precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"销售价调整（元）",prop:"sale_price_adjustment"},{default:a(()=>[l(I,{modelValue:c.value.sale_price_adjustment,"onUpdate:modelValue":e[14]||(e[14]=t=>c.value.sale_price_adjustment=t),precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"适用房型",prop:"items"},{default:a(()=>[l(Q,{data:c.value.items,border:"",style:{width:"100%"}},{default:a(()=>[l(g,{label:"酒店",width:"200"},{default:a(({row:t,$index:p})=>[l(D,{modelValue:t.hotel_id,"onUpdate:modelValue":j=>t.hotel_id=j,placeholder:"请选择酒店",style:{width:"100%"},onChange:j=>pt(p)},{default:a(()=>[(u(!0),x(Z,null,ee(Je.value,j=>(u(),k(b,{key:j.id,label:j.name,value:j.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(g,{label:"房型",width:"200"},{default:a(({row:t,$index:p})=>[l(D,{modelValue:t.room_type_id,"onUpdate:modelValue":j=>t.room_type_id=j,placeholder:"请选择房型",style:{width:"100%"}},{default:a(()=>[(u(!0),x(Z,null,ee(Ke(t.hotel_id),j=>(u(),k(b,{key:j.id,label:j.name,value:j.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(g,{label:"操作",width:"100"},{default:a(({$index:t})=>[l(d,{size:"small",type:"danger",onClick:p=>ut(t)},{default:a(()=>[...e[60]||(e[60]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(d,{type:"primary",size:"small",style:{"margin-top":"10px"},onClick:dt},{default:a(()=>[...e[61]||(e[61]=[i(" 添加房型 ",-1)])]),_:1})]),_:1}),l($,{label:"状态",prop:"is_active"},{default:a(()=>[l(Se,{modelValue:c.value.is_active,"onUpdate:modelValue":e[15]||(e[15]=t=>c.value.is_active=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),l(me,{label:"外部编码映射",name:"externalCodeMappings"},{default:a(()=>[w("div",ea,[l(d,{type:"primary",onClick:ht},{default:a(()=>[...e[64]||(e[64]=[i("添加时间段映射",-1)])]),_:1}),l(B,{type:"info",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>[...e[65]||(e[65]=[w("span",null,"说明：同一产品在不同时间段可以对应不同的横店系统产品编码。时间段不能重叠。",-1)])]),_:1})]),se((u(),k(Q,{data:je.value,border:""},{default:a(()=>[l(g,{prop:"external_code",label:"横店产品编码",width:"200"}),l(g,{label:"生效时间段",width:"300"},{default:a(({row:t})=>[i(_(M(t.start_date))+" 至 "+_(M(t.end_date)),1)]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:t})=>[l(o,{type:t.is_active?"success":"danger"},{default:a(()=>[i(_(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{prop:"sort_order",label:"排序",width:"100"}),l(g,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:t})=>[i(_(we(t.created_at)),1)]),_:1}),l(g,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(d,{size:"small",onClick:p=>wt(t)},{default:a(()=>[...e[66]||(e[66]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:p=>xt(t)},{default:a(()=>[...e[67]||(e[67]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,ve.value]]),l(_e,{modelValue:J.value,"onUpdate:modelValue":e[24]||(e[24]=t=>J.value=t),title:Ne.value,width:"600px",onClose:Re},{footer:a(()=>[l(d,{onClick:e[23]||(e[23]=t=>J.value=!1)},{default:a(()=>[...e[69]||(e[69]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:Vt,loading:he.value},{default:a(()=>[...e[70]||(e[70]=[i("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(pe,{ref_key:"externalCodeMappingFormRef",ref:ue,model:R.value,rules:qe,"label-width":"140px"},{default:a(()=>[l($,{label:"横店产品编码",prop:"external_code"},{default:a(()=>[l(ze,{modelValue:R.value.external_code,"onUpdate:modelValue":e[18]||(e[18]=t=>R.value.external_code=t),placeholder:"请输入横店系统产品编码"},null,8,["modelValue"])]),_:1}),l($,{label:"开始日期",prop:"start_date"},{default:a(()=>[l(F,{modelValue:R.value.start_date,"onUpdate:modelValue":e[19]||(e[19]=t=>R.value.start_date=t),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"结束日期",prop:"end_date"},{default:a(()=>[l(F,{modelValue:R.value.end_date,"onUpdate:modelValue":e[20]||(e[20]=t=>R.value.end_date=t),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"状态",prop:"is_active"},{default:a(()=>[l(Se,{modelValue:R.value.is_active,"onUpdate:modelValue":e[21]||(e[21]=t=>R.value.is_active=t)},null,8,["modelValue"])]),_:1}),l($,{label:"排序",prop:"sort_order"},{default:a(()=>[l(I,{modelValue:R.value.sort_order,"onUpdate:modelValue":e[22]||(e[22]=t=>R.value.sort_order=t),min:0,style:{width:"100%"}},null,8,["modelValue"]),e[68]||(e[68]=w("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 数字越小越优先（当时间段重叠时） ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),l(me,{label:"OTA推送",name:"otaProducts"},{default:a(()=>[w("div",ta,[l(d,{type:"primary",onClick:ct},{default:a(()=>[...e[71]||(e[71]=[i("绑定OTA平台",-1)])]),_:1})]),se((u(),k(Q,{data:fe.value,border:""},{default:a(()=>[l(g,{label:"OTA平台",width:"150"},{default:a(({row:t})=>{var p;return[i(_(((p=t.ota_platform)==null?void 0:p.name)||"-"),1)]}),_:1}),l(g,{label:"OTA产品ID",width:"200"},{default:a(({row:t})=>[t.ota_product_id?(u(),x("span",aa,_(t.ota_product_id),1)):(u(),x("span",la,"-"))]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:t})=>[l(o,{type:t.is_active?"success":"danger"},{default:a(()=>[i(_(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"推送状态",width:"150"},{default:a(({row:t})=>[t.push_status==="processing"?(u(),k(o,{key:0,type:"warning"},{default:a(()=>[...e[72]||(e[72]=[i(" 推送中... ",-1)])]),_:1})):t.push_status==="success"?(u(),k(o,{key:1,type:"success"},{default:a(()=>[...e[73]||(e[73]=[i(" 推送成功 ",-1)])]),_:1})):t.push_status==="failed"?(u(),k(o,{key:2,type:"danger"},{default:a(()=>[...e[74]||(e[74]=[i(" 推送失败 ",-1)])]),_:1})):t.pushed_at?(u(),k(o,{key:3,type:"success"},{default:a(()=>[...e[75]||(e[75]=[i(" 已推送 ",-1)])]),_:1})):(u(),k(o,{key:4,type:"info"},{default:a(()=>[...e[76]||(e[76]=[i(" 未推送 ",-1)])]),_:1}))]),_:1}),l(g,{prop:"pushed_at",label:"推送时间",width:"180"},{default:a(({row:t})=>[i(_(t.pushed_at?we(t.pushed_at):"-"),1)]),_:1}),l(g,{label:"操作",width:"250",fixed:"right"},{default:a(({row:t})=>[l(d,{size:"small",onClick:p=>yt(t)},{default:a(()=>[...e[77]||(e[77]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",onClick:p=>gt(t)},{default:a(()=>[...e[78]||(e[78]=[i("删除",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"primary",onClick:p=>ft(t),disabled:!t.is_active||t.push_status==="processing",loading:t.push_status==="processing"},{default:a(()=>[i(_(t.push_status==="processing"?"推送中...":t.pushed_at?"重新推送":"推送"),1)]),_:2},1032,["onClick","disabled","loading"])]),_:1})]),_:1},8,["data"])),[[le,Ie.value]]),l(_e,{modelValue:ae.value,"onUpdate:modelValue":e[27]||(e[27]=t=>ae.value=t),title:"绑定OTA平台",width:"500px"},{footer:a(()=>[l(d,{onClick:e[26]||(e[26]=t=>ae.value=!1)},{default:a(()=>[...e[79]||(e[79]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:vt,loading:ke.value},{default:a(()=>[...e[80]||(e[80]=[i("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(pe,{model:G.value,"label-width":"120px"},{default:a(()=>[l($,{label:"选择OTA平台",required:""},{default:a(()=>[l(D,{modelValue:G.value.ota_platform_id,"onUpdate:modelValue":e[25]||(e[25]=t=>G.value.ota_platform_id=t),placeholder:"请选择要绑定的OTA平台",style:{width:"100%"}},{default:a(()=>[(u(!0),x(Z,null,ee(be.value,t=>(u(),k(b,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])):z("",!0)]),_:1})),[[le,ce.value]])])}}},oa=jt(sa,[["__scopeId","data-v-c2583569"]]);export{oa as default};
