import{_ as Q,r as _,i as X,j as Z,c as I,o as C,f as p,b as e,w as o,d as u,k as ee,E as te,e as ae,l as le,m as oe,n as L,h as d,t as i,q as ne,s as se}from"./app-CLC_VnxY.js";const re={class:"pkg-order-management-container"},de={class:"filter-bar"},ie={class:"pkg-order-list"},ue={class:"order-items-container"},pe={class:"product-name"},ce={class:"room-type"},_e={__name:"Index",setup(me){const S=ae(),M=_([]),h=_(!1),g=_(1),b=_(15),T=_(0),Y=_([]),v=_("total, sizes, prev, pager, next, jumper"),k=()=>{window.innerWidth<=768?v.value="prev, pager, next":window.innerWidth<=1200?v.value="total, prev, pager, next":v.value="total, sizes, prev, pager, next, jumper"},s=_({status:null,order_no:"",ota_order_no:"",check_in_date:null}),f=async()=>{h.value=!0;try{const t={page:g.value,per_page:b.value};s.value.status&&(t.status=s.value.status),s.value.order_no&&(t.order_no=s.value.order_no),s.value.ota_order_no&&(t.ota_order_no=s.value.ota_order_no),s.value.check_in_date&&(t.check_in_date=s.value.check_in_date);const a=await ee.get("/pkg-orders",{params:t});M.value=a.data.data,T.value=a.data.total}catch{te.error("获取打包订单列表失败")}finally{h.value=!1}},c=()=>{g.value=1,f()},U=()=>{s.value={status:null,order_no:"",ota_order_no:"",check_in_date:null},c()},K=(t,a)=>{},N=t=>{S.push(`/pkg-orders/${t.id}`)},O=t=>t?(parseFloat(t)/100).toFixed(2):"0.00",B=t=>t?typeof t=="string"?t.split("T")[0]:t:"",V=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",F=t=>({paid:"warning",confirmed:"success",failed:"danger",cancelled:"info"})[t]||"",P=t=>({paid:"已支付",confirmed:"已确认",failed:"失败",cancelled:"已取消"})[t]||t,j=t=>({TICKET:"primary",HOTEL:"success"})[t]||"",R=t=>({TICKET:"门票",HOTEL:"酒店"})[t]||t,q=t=>({pending:"info",processing:"warning",success:"success",failed:"danger",pending_manual:"warning"})[t]||"",A=t=>({pending:"待处理",processing:"处理中",success:"成功",failed:"失败",pending_manual:"待人工处理"})[t]||t;return X(()=>{f(),k(),window.addEventListener("resize",k)}),Z(()=>{window.removeEventListener("resize",k)}),(t,a)=>{const y=u("el-option"),H=u("el-select"),z=u("el-input"),W=u("el-date-picker"),x=u("el-button"),n=u("el-table-column"),w=u("el-tag"),D=u("el-table"),$=u("el-pagination"),G=u("el-card"),J=le("loading");return C(),I("div",re,[a[10]||(a[10]=p("h2",null,"打包订单管理",-1)),e(G,null,{default:o(()=>[p("div",de,[e(H,{modelValue:s.value.status,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.status=l),placeholder:"订单状态",clearable:"",style:{width:"150px"},onChange:c},{default:o(()=>[e(y,{label:"已支付",value:"paid"}),e(y,{label:"已确认",value:"confirmed"}),e(y,{label:"失败",value:"failed"}),e(y,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),e(z,{modelValue:s.value.order_no,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.order_no=l),placeholder:"订单号",clearable:"",style:{width:"200px"},onClear:c,onKeyup:L(c,["enter"])},null,8,["modelValue"]),e(z,{modelValue:s.value.ota_order_no,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.ota_order_no=l),placeholder:"OTA订单号",clearable:"",style:{width:"200px"},onClear:c,onKeyup:L(c,["enter"])},null,8,["modelValue"]),e(W,{modelValue:s.value.check_in_date,"onUpdate:modelValue":a[3]||(a[3]=l=>s.value.check_in_date=l),type:"date",placeholder:"入住日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"150px"},onChange:c},null,8,["modelValue"]),e(x,{onClick:c},{default:o(()=>[...a[6]||(a[6]=[d("筛选",-1)])]),_:1}),e(x,{onClick:U},{default:o(()=>[...a[7]||(a[7]=[d("重置",-1)])]),_:1})]),oe((C(),I("div",ie,[e(D,{data:M.value,style:{width:"100%"},"expand-row-keys":Y.value,"row-key":"id",onExpandChange:K},{default:o(()=>[e(n,{type:"expand"},{default:o(({row:l})=>[p("div",ue,[a[8]||(a[8]=p("h4",{class:"items-title"},"订单项列表",-1)),e(D,{data:l.items,style:{width:"100%"},border:""},{default:o(()=>[e(n,{prop:"id",label:"ID",width:"80"}),e(n,{label:"类型",width:"100"},{default:o(({row:r})=>[e(w,{type:j(r.item_type)},{default:o(()=>[d(i(R(r.item_type)),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"resource_name",label:"资源名称"}),e(n,{prop:"quantity",label:"数量",width:"80"}),e(n,{label:"状态",width:"120"},{default:o(({row:r})=>[e(w,{type:q(r.status)},{default:o(()=>[d(i(A(r.status)),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"resource_order_no",label:"资源方订单号"}),e(n,{prop:"error_message",label:"错误信息","show-overflow-tooltip":""}),e(n,{prop:"processed_at",label:"处理时间",width:"180"},{default:o(({row:r})=>[d(i(V(r.processed_at)),1)]),_:1})]),_:1},8,["data"])])]),_:1}),e(n,{prop:"order_no",label:"订单号",width:"180"}),e(n,{prop:"ota_order_no",label:"OTA订单号",width:"200"}),e(n,{label:"打包产品","min-width":"200"},{default:o(({row:l})=>{var r,m,E;return[p("div",null,[p("div",pe,i(((r=l.product)==null?void 0:r.product_name)||"-"),1),(E=(m=l.product)==null?void 0:m.scenic_spot)!=null&&E.name?(C(),ne(w,{key:0,size:"small",type:"info",class:"scenic-tag"},{default:o(()=>[d(i(l.product.scenic_spot.name),1)]),_:2},1024)):se("",!0)])]}),_:1}),e(n,{label:"酒店/房型",width:"200"},{default:o(({row:l})=>{var r,m;return[p("div",null,[p("div",null,i(((r=l.hotel)==null?void 0:r.name)||"-"),1),p("div",ce,i(((m=l.room_type)==null?void 0:m.name)||"-"),1)])]}),_:1}),e(n,{label:"入住日期",width:"120"},{default:o(({row:l})=>[d(i(B(l.check_in_date)),1)]),_:1}),e(n,{prop:"stay_days",label:"入住天数",width:"100"}),e(n,{label:"状态",width:"120"},{default:o(({row:l})=>[e(w,{type:F(l.status)},{default:o(()=>[d(i(P(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(n,{label:"订单总额",width:"120",align:"right"},{default:o(({row:l})=>[d(" ¥"+i(O(l.total_amount)),1)]),_:1}),e(n,{label:"下单时间",width:"180"},{default:o(({row:l})=>[d(i(V(l.created_at)),1)]),_:1}),e(n,{label:"操作",width:"120",fixed:"right"},{default:o(({row:l})=>[e(x,{type:"primary",link:"",size:"small",onClick:r=>N(l)},{default:o(()=>[...a[9]||(a[9]=[d(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","expand-row-keys"])])),[[J,h.value]]),e($,{"current-page":g.value,"onUpdate:currentPage":a[4]||(a[4]=l=>g.value=l),"page-size":b.value,"onUpdate:pageSize":a[5]||(a[5]=l=>b.value=l),total:T.value,onCurrentChange:f,onSizeChange:f,class:"pagination-container",layout:v.value},null,8,["current-page","page-size","total","layout"])]),_:1})])}}},ve=Q(_e,[["__scopeId","data-v-63b67b3b"]]);export{ve as default};
