import{_ as me,r as s,x as J,i as ve,c as S,o as p,f as P,b as t,w as o,d as u,k as b,E as m,l as _e,m as fe,h as c,y as ge,z as ye,q as $,s as O,F as M,p as T,t as B,v as be}from"./app-Czjj7pNL.js";const Ve={style:{"margin-bottom":"20px"}},xe={key:0,style:{color:"#909399"}},Se={key:0,style:{color:"#909399"}},he={__name:"Index",setup(ke){const q=s([]),A=s([]),D=s(!1),F=s(!1),V=s(!1),k=s(null),C=s(""),w=s(1),E=s(15),L=s(0),z=s(null),h=s(!1),j=s(null),I=s(!1),K=s(null),g=s({scenic_spot_ids:[]}),R=J(()=>z.value!==null),Q=J(()=>R.value?"编辑资源方":"创建资源方"),n=s({name:"",code:"",description:"",contact_name:"",contact_phone:"",contact_email:"",is_active:!0}),W={name:[{required:!0,message:"请输入资源方名称",trigger:"blur"},{max:255,message:"资源方名称不能超过255个字符",trigger:"blur"}],code:[{pattern:/^[a-zA-Z0-9_-]+$/,message:"资源方编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}]},y=async()=>{D.value=!0;try{const a={page:w.value,per_page:E.value};C.value&&(a.search=C.value);const e=await b.get("/resource-providers",{params:a});q.value=e.data.data||[],L.value=e.data.total||0}catch(a){m.error("获取资源方列表失败"),console.error(a)}finally{D.value=!1}},X=async()=>{try{const a=await b.get("/scenic-spots",{params:{per_page:1e3}});A.value=a.data.data||[]}catch(a){console.error("获取景区列表失败",a)}},Y=()=>{w.value=1,y()},ee=()=>{z.value=null,Z(),V.value=!0},le=a=>{z.value=a.id,n.value={name:a.name,code:a.code,description:a.description||"",contact_name:a.contact_name||"",contact_phone:a.contact_phone||"",contact_email:a.contact_email||"",is_active:a.is_active},V.value=!0},te=async()=>{k.value&&await k.value.validate(async a=>{var e,r,v,d,i,x;if(a){F.value=!0;try{R.value?(await b.put(`/resource-providers/${z.value}`,n.value),m.success("资源方更新成功")):(await b.post("/resource-providers",n.value),m.success("资源方创建成功")),V.value=!1,y()}catch(U){const N=((r=(e=U.response)==null?void 0:e.data)==null?void 0:r.message)||((x=(i=(d=(v=U.response)==null?void 0:v.data)==null?void 0:d.errors)==null?void 0:i.code)==null?void 0:x[0])||"操作失败";m.error(N)}finally{F.value=!1}}})},ae=async a=>{try{await be.confirm(`确定要删除资源方"${a.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await b.delete(`/resource-providers/${a.id}`),m.success("删除成功"),y()}catch(e){e!=="cancel"&&(m.error("删除失败"),console.error(e))}},oe=async a=>{var e;K.value=a.id,h.value=!0;try{const v=((e=(await b.get(`/resource-providers/${a.id}`)).data.data)==null?void 0:e.scenic_spots)||[];g.value={scenic_spot_ids:v.map(d=>d.id)}}catch(r){m.error("获取景区信息失败"),console.error(r),g.value={scenic_spot_ids:[]}}},ne=async()=>{var a,e;I.value=!0;try{await b.post(`/resource-providers/${K.value}/scenic-spots`,{scenic_spot_ids:g.value.scenic_spot_ids}),m.success("景区绑定成功"),h.value=!1,y()}catch(r){const v=((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)||"操作失败";m.error(v)}finally{I.value=!1}},Z=()=>{var a;n.value={name:"",code:"",description:"",contact_name:"",contact_phone:"",contact_email:"",is_active:!0},(a=k.value)==null||a.clearValidate()},se=()=>{var a;g.value={scenic_spot_ids:[]},(a=j.value)==null||a.clearValidate()},re=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return ve(()=>{y(),X()}),(a,e)=>{const r=u("el-button"),v=u("el-icon"),d=u("el-input"),i=u("el-table-column"),x=u("el-tag"),U=u("el-table"),N=u("el-pagination"),ie=u("el-card"),_=u("el-form-item"),ue=u("el-switch"),G=u("el-form"),H=u("el-dialog"),de=u("el-option"),ce=u("el-select"),pe=_e("loading");return p(),S("div",null,[e[24]||(e[24]=P("h2",null,"资源方管理",-1)),t(ie,null,{default:o(()=>[P("div",Ve,[t(r,{type:"primary",onClick:ee},{default:o(()=>[...e[15]||(e[15]=[c("创建资源方",-1)])]),_:1}),t(d,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),placeholder:"搜索资源方名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:Y},{prefix:o(()=>[t(v,null,{default:o(()=>[t(ge(ye))]),_:1})]),_:1},8,["modelValue"])]),fe((p(),$(U,{data:q.value,border:""},{default:o(()=>[t(i,{prop:"name",label:"资源方名称",width:"200"}),t(i,{prop:"code",label:"资源方编码",width:"150"}),t(i,{prop:"description",label:"描述","show-overflow-tooltip":""}),t(i,{prop:"contact_name",label:"联系人",width:"120"}),t(i,{prop:"contact_phone",label:"联系电话",width:"150"}),t(i,{prop:"contact_email",label:"联系邮箱",width:"200"}),t(i,{label:"绑定景区",width:"200"},{default:o(({row:l})=>[(p(!0),S(M,null,T(l.scenic_spots||[],f=>(p(),$(x,{key:f.id,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:o(()=>[c(B(f.name),1)]),_:2},1024))),128)),!l.scenic_spots||l.scenic_spots.length===0?(p(),S("span",xe," 未绑定 ")):O("",!0)]),_:1}),t(i,{label:"绑定用户",width:"150"},{default:o(({row:l})=>[(p(!0),S(M,null,T(l.users||[],f=>(p(),$(x,{key:f.id,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:o(()=>[c(B(f.name),1)]),_:2},1024))),128)),!l.users||l.users.length===0?(p(),S("span",Se," 未绑定 ")):O("",!0)]),_:1}),t(i,{prop:"is_active",label:"状态",width:"100"},{default:o(({row:l})=>[t(x,{type:l.is_active?"success":"danger"},{default:o(()=>[c(B(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:l})=>[c(B(re(l.created_at)),1)]),_:1}),t(i,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[t(r,{size:"small",onClick:f=>le(l)},{default:o(()=>[...e[16]||(e[16]=[c("编辑",-1)])]),_:1},8,["onClick"]),t(r,{size:"small",type:"info",onClick:f=>oe(l)},{default:o(()=>[...e[17]||(e[17]=[c("管理景区",-1)])]),_:1},8,["onClick"]),t(r,{size:"small",type:"danger",onClick:f=>ae(l)},{default:o(()=>[...e[18]||(e[18]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,D.value]]),t(N,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=l=>w.value=l),"page-size":E.value,"onUpdate:pageSize":e[2]||(e[2]=l=>E.value=l),"page-sizes":[10,20,50,100],total:L.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),t(H,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=l=>V.value=l),title:Q.value,width:"600px",onClose:Z},{footer:o(()=>[t(r,{onClick:e[10]||(e[10]=l=>V.value=!1)},{default:o(()=>[...e[19]||(e[19]=[c("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:te,loading:F.value},{default:o(()=>[...e[20]||(e[20]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(G,{ref_key:"formRef",ref:k,model:n.value,rules:W,"label-width":"120px"},{default:o(()=>[t(_,{label:"资源方名称",prop:"name"},{default:o(()=>[t(d,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.name=l),placeholder:"请输入资源方名称"},null,8,["modelValue"])]),_:1}),t(_,{label:"资源方编码",prop:"code"},{default:o(()=>[t(d,{modelValue:n.value.code,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.code=l),placeholder:"请输入资源方编码（唯一，留空自动生成）",disabled:R.value},null,8,["modelValue","disabled"])]),_:1}),t(_,{label:"描述",prop:"description"},{default:o(()=>[t(d,{modelValue:n.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.description=l),type:"textarea",rows:4,placeholder:"请输入资源方描述"},null,8,["modelValue"])]),_:1}),t(_,{label:"联系人",prop:"contact_name"},{default:o(()=>[t(d,{modelValue:n.value.contact_name,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.contact_name=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),t(_,{label:"联系电话",prop:"contact_phone"},{default:o(()=>[t(d,{modelValue:n.value.contact_phone,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.contact_phone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(_,{label:"联系邮箱",prop:"contact_email"},{default:o(()=>[t(d,{modelValue:n.value.contact_email,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.contact_email=l),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),t(_,{label:"状态",prop:"is_active"},{default:o(()=>[t(ue,{modelValue:n.value.is_active,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(H,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=l=>h.value=l),title:"管理景区",width:"600px",onClose:se},{footer:o(()=>[t(r,{onClick:e[13]||(e[13]=l=>h.value=!1)},{default:o(()=>[...e[22]||(e[22]=[c("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:ne,loading:I.value},{default:o(()=>[...e[23]||(e[23]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(G,{ref_key:"scenicSpotsFormRef",ref:j,model:g.value,"label-width":"120px"},{default:o(()=>[t(_,{label:"绑定景区"},{default:o(()=>[t(ce,{modelValue:g.value.scenic_spot_ids,"onUpdate:modelValue":e[12]||(e[12]=l=>g.value.scenic_spot_ids=l),placeholder:"请选择要绑定的景区（可多选）",multiple:"",style:{width:"100%"}},{default:o(()=>[(p(!0),S(M,null,T(A.value,l=>(p(),$(de,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[21]||(e[21]=P("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 选择该资源方可以管理的景区 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},we=me(he,[["__scopeId","data-v-90012158"]]);export{we as default};
