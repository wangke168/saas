import{_ as _t,r as v,s as K,i as ct,c as w,o as u,b as l,l as ne,w as t,d as h,k as ft,n as b,j as D,A as vt,E as y,e as yt,f as R,p as O,h as i,t as m,F as L,v as H,q as U}from"./app-C7b5dp06.js";const gt={key:0},bt={style:{"margin-bottom":"20px",display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},kt={style:{display:"flex","align-items":"center",gap:"10px",width:"100%"}},ht={style:{"font-weight":"bold"}},wt={style:{"margin-left":"auto",color:"#909399","font-size":"12px"}},Vt={key:0},Rt={key:1},xt={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},Dt={key:0},Ct={key:1},$t={key:0},jt={key:1},Pt={key:2},Tt={key:3},Ft={style:{"margin-bottom":"20px"}},Ot={key:0},It={key:1},Ut={style:{"margin-bottom":"20px"}},zt={key:0},Mt={key:1,style:{color:"#909399"}},Bt={__name:"Detail",setup(Et){const ve=vt(),ye=yt(),re=v(!1),je=v(!1),Pe=v(!1),Te=v(!1),p=v(null),B=v([]),ge=v([]),be=v([]),ke=v("prices"),z=v(!1),Q=v(!1),X=v(null),V=v({room_type_ids:[],market_price:0,settlement_price:0,sale_price:0}),P=v(null),I=v(null),E=v(null),Z=v([]),A=v(!1),oe=v(!1),ee=v(null),c=v({name:"",type:"weekday",weekdays:[],dateRange:null,market_price_adjustment:0,settlement_price_adjustment:0,sale_price_adjustment:0,is_active:!0,items:[{hotel_id:null,room_type_id:null}]}),Y=v(null),te=v([]),ie=v([]),W=v([]),ue=v([]),G=v(!1),de=v(!1),S=v({ota_platform_id:null}),Fe={room_type_ids:[{required:!0,message:"请至少选择一个房型",trigger:"change",validator:(s,e,n)=>{!e||e.length===0?n(new Error("请至少选择一个房型")):n()}}],market_price:[{required:!0,message:"请输入门市价",trigger:"blur"}],settlement_price:[{required:!0,message:"请输入结算价",trigger:"blur"}],sale_price:[{required:!0,message:"请输入销售价",trigger:"blur"}]},Oe={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],type:[{required:!0,message:"请选择规则类型",trigger:"change"}],weekdays:[{validator:(s,e,n)=>{c.value.type==="weekday"&&(!e||e.length===0)?n(new Error("请至少选择一个周几")):n()},trigger:"change"}],dateRange:[{validator:(s,e,n)=>{c.value.type==="date_range"&&(!e||e.length!==2)?n(new Error("请选择日期区间")):n()},trigger:"change"}],market_price_adjustment:[{required:!0,message:"请输入门市价调整",trigger:"blur"}],settlement_price_adjustment:[{required:!0,message:"请输入结算价调整",trigger:"blur"}],sale_price_adjustment:[{required:!0,message:"请输入销售价调整",trigger:"blur"}],items:[{validator:(s,e,n)=>{!e||e.length===0?n(new Error("请至少添加一个适用房型")):e.some(o=>!o.hotel_id||!o.room_type_id)?n(new Error("请完善所有房型信息")):n()},trigger:"change"}]},Ie=K(()=>P.value?"编辑价格":"添加价格"),Ue=K(()=>Y.value?"编辑加价规则":"添加加价规则"),ze=K(()=>{if(!B.value||B.value.length===0)return[];const s=[...new Set(B.value.map(n=>n.room_type_id))],e=new Set;return s.forEach(n=>{const r=W.value.find(o=>o.id===n);r&&r.hotel_id&&e.add(r.hotel_id)}),te.value.filter(n=>e.has(n.id))}),Me=s=>{if(!s)return[];const e=new Set(B.value.map(n=>n.room_type_id));return W.value.filter(n=>n.hotel_id===s&&e.has(n.id))},Be=K(()=>{let s=B.value||[];if(I.value&&(s=s.filter(e=>e.room_type_id===I.value)),E.value&&E.value.length===2){const[e,n]=E.value;s=s.filter(r=>{const o=r.date;return o>=e&&o<=n})}return s}),he=K(()=>{const s={};return Be.value.forEach(e=>{const n=e.room_type_id;if(!s[n]){const r=W.value.find(f=>f.id===n),o=te.value.find(f=>f.id===(r==null?void 0:r.hotel_id));s[n]={roomTypeId:n,hotelId:r==null?void 0:r.hotel_id,hotelName:(o==null?void 0:o.name)||"未知酒店",roomTypeName:(r==null?void 0:r.name)||"未知房型",prices:[],dateRanges:[]}}s[n].prices.push(e)}),Object.values(s).forEach(e=>{e.prices.sort((r,o)=>new Date(r.date)-new Date(o.date));const n={};e.prices.forEach(r=>{const o=`${r.market_price}_${r.settlement_price}_${r.sale_price}_${r.source}`;n[o]||(n[o]={market_price:r.market_price,settlement_price:r.settlement_price,sale_price:r.sale_price,source:r.source,dates:[]}),n[o].dates.push(r.date)}),e.dateRanges=Object.values(n).map(r=>{const o=r.dates.sort();let f=[],_=o[0],k=o[0];for(let x=1;x<o.length;x++){const T=new Date(o[x]),q=new Date(o[x-1]);(T-q)/(1e3*60*60*24)===1||(f.push({start:_,end:k,...r}),_=o[x]),k=o[x]}return f.push({start:_,end:k,...r}),f}).flat()}),Object.values(s).forEach(e=>{if(e.prices.length>0){const n=e.prices.map(r=>r.date).sort();e.dateRange=`${n[0]} 至 ${n[n.length-1]}`}else e.dateRange="-"}),Object.values(s)}),Ee=()=>{ye.push("/products")},j=async()=>{var s,e,n,r,o,f,_;re.value=!0;try{const k=await D.get(`/products/${ve.params.id}`);if(!k.data||!k.data.data)throw new Error("返回数据格式错误");p.value=k.data.data,B.value=p.value.prices||[],ge.value=p.value.price_rules||[],be.value=p.value.ota_products||[],p.value&&p.value.scenic_spot_id&&(await Ve(),await Re())}catch(k){const x=((e=(s=k.response)==null?void 0:s.data)==null?void 0:e.message)||((r=(n=k.response)==null?void 0:n.data)==null?void 0:r.error)||k.message||"获取产品详情失败";y.error(x),console.error("获取产品详情失败:",{error:k,response:k.response,status:(o=k.response)==null?void 0:o.status,data:(f=k.response)==null?void 0:f.data}),((_=k.response)==null?void 0:_.status)===403&&setTimeout(()=>{ye.push("/products")},2e3)}finally{re.value=!1}},ae=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",le=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"",F=s=>s?(parseFloat(s)/100).toFixed(2):"0.00",Ae=s=>{if(!s)return"";const e={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"日"};return s.split(",").map(n=>e[n]||n).join("、")},Ye=()=>{if(!p.value.sale_start_date||!p.value.sale_end_date){y.warning("请先在产品编辑页面设置销售开始日期和结束日期");return}P.value=null,pe(),z.value=!0},we=s=>{P.value=s.id,V.value={room_type_ids:[s.room_type_id],market_price:parseFloat(s.market_price)/100,settlement_price:parseFloat(s.settlement_price)/100,sale_price:parseFloat(s.sale_price)/100},z.value=!0},Se=async s=>{try{await U.confirm("确定要删除该价格记录吗？","提示",{type:"warning"}),await D.delete(`/prices/${s.id}`),y.success("删除成功"),j()}catch(e){e!=="cancel"&&y.error("删除失败")}},qe=(s,e)=>{const n=s.prices.filter(r=>{const o=r.date;return o>=e.start&&o<=e.end});if(n.length!==0){if(n.length===1){we(n[0]);return}U.confirm(`该日期范围包含 ${n.length} 天的价格记录。是否批量编辑为相同价格？`,"批量编辑",{confirmButtonText:"批量编辑",cancelButtonText:"取消",type:"info"}).then(()=>{const r=n[0];P.value=null,V.value={room_type_ids:[s.roomTypeId],market_price:parseFloat(r.market_price)/100,settlement_price:parseFloat(r.settlement_price)/100,sale_price:parseFloat(r.sale_price)/100},z.value=!0}).catch(()=>{})}},Ne=async(s,e)=>{try{const n=s.prices.filter(r=>{const o=r.date;return o>=e.start&&o<=e.end});if(n.length===0)return;await U.confirm(`确定要删除该日期范围（${e.start} 至 ${e.end}）的 ${n.length} 条价格记录吗？`,"提示",{type:"warning"}),await Promise.all(n.map(r=>D.delete(`/prices/${r.id}`))),y.success("删除成功"),j()}catch(n){n!=="cancel"&&y.error("删除失败")}},Ve=async()=>{try{const s=await D.get("/hotels",{params:{scenic_spot_id:p.value.scenic_spot_id,per_page:1e3}});te.value=s.data.data||[]}catch(s){console.error("获取酒店列表失败",s)}},Re=async()=>{try{const s=await D.get("/room-types",{params:{per_page:1e3}});W.value=s.data.data||[],ie.value=W.value.filter(e=>te.value.some(n=>n.id===e.hotel_id))}catch(s){console.error("获取房型列表失败",s)}},xe=()=>{I.value&&!Z.value.includes(I.value)&&Z.value.push(I.value)},Le=()=>{I.value=null,E.value=null},He=async()=>{X.value&&await X.value.validate(async s=>{var e,n;if(s){Q.value=!0;try{if(P.value)await D.put(`/prices/${P.value}`,{market_price:Math.round(V.value.market_price*100),settlement_price:Math.round(V.value.settlement_price*100),sale_price:Math.round(V.value.sale_price*100)}),y.success("价格更新成功");else{if(!p.value.sale_start_date||!p.value.sale_end_date){y.warning("请先在产品编辑页面设置销售开始日期和结束日期"),Q.value=!1;return}const r=p.value.sale_start_date,o=p.value.sale_end_date,f=[],_=new Date(r),k=new Date(o);for(let T=new Date(_);T<=k;T.setDate(T.getDate()+1))f.push({date:T.toISOString().split("T")[0],market_price:Math.round(V.value.market_price*100),settlement_price:Math.round(V.value.settlement_price*100),sale_price:Math.round(V.value.sale_price*100)});const x=V.value.room_type_ids.map(T=>D.post("/prices",{product_id:p.value.id,room_type_id:T,prices:f}));await Promise.all(x),y.success(`成功为 ${V.value.room_type_ids.length} 个房型创建价格`)}z.value=!1,pe(),j()}catch(r){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败";y.error(o)}finally{Q.value=!1}}})},pe=()=>{var s;V.value={room_type_ids:[],market_price:0,settlement_price:0,sale_price:0},P.value=null,(s=X.value)==null||s.clearValidate()},We=()=>{Y.value=null,me(),A.value=!0},Ge=async s=>{Y.value=s.id;try{const e=s.items?s:(await D.get(`/price-rules/${s.id}`)).data.data||s;c.value={name:e.name,type:e.type,weekdays:e.weekdays?e.weekdays.split(","):[],dateRange:e.start_date&&e.end_date?[e.start_date,e.end_date]:null,market_price_adjustment:parseFloat(e.market_price_adjustment)/100,settlement_price_adjustment:parseFloat(e.settlement_price_adjustment)/100,sale_price_adjustment:parseFloat(e.sale_price_adjustment)/100,is_active:e.is_active,items:e.items&&e.items.length>0?e.items.map(n=>({hotel_id:n.hotel_id,room_type_id:n.room_type_id})):[{hotel_id:null,room_type_id:null}]},A.value=!0}catch{y.error("获取加价规则详情失败")}},Je=async s=>{try{await U.confirm("确定要删除该加价规则吗？","提示",{type:"warning"}),await D.delete(`/price-rules/${s.id}`),y.success("删除成功"),j()}catch(e){e!=="cancel"&&y.error("删除失败")}},Ke=()=>{c.value.items.push({hotel_id:null,room_type_id:null})},Qe=s=>{c.value.items.splice(s,1)},Xe=s=>{c.value.items[s].room_type_id=null},Ze=async()=>{ee.value&&await ee.value.validate(async s=>{var e,n;if(s){oe.value=!0;try{const r={product_id:p.value.id,name:c.value.name,type:c.value.type,market_price_adjustment:Math.round(c.value.market_price_adjustment*100),settlement_price_adjustment:Math.round(c.value.settlement_price_adjustment*100),sale_price_adjustment:Math.round(c.value.sale_price_adjustment*100),is_active:c.value.is_active,items:c.value.items};if(c.value.type==="weekday")r.weekdays=c.value.weekdays.join(",");else{const[o,f]=c.value.dateRange;r.start_date=o,r.end_date=f}Y.value?(await D.put(`/price-rules/${Y.value}`,r),y.success("加价规则更新成功")):(await D.post("/price-rules",r),y.success("加价规则创建成功")),A.value=!1,me(),j()}catch(r){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"操作失败";y.error(o)}finally{oe.value=!1}}})},me=()=>{var s;c.value={name:"",type:"weekday",weekdays:[],dateRange:null,market_price_adjustment:0,settlement_price_adjustment:0,sale_price_adjustment:0,is_active:!0,items:[{hotel_id:null,room_type_id:null}]},Y.value=null,(s=ee.value)==null||s.clearValidate()},et=async()=>{try{const s=await D.get("/ota-platforms",{params:{active_only:!0}});ue.value=s.data.data||[]}catch(s){console.error("获取OTA平台列表失败",s)}},tt=()=>{S.value={ota_platform_id:null},G.value=!0},at=async()=>{var s,e;if(!S.value.ota_platform_id){y.warning("请选择OTA平台");return}de.value=!0;try{const n=await D.post(`/products/${ve.params.id}/bind-ota`,{ota_platform_id:S.value.ota_platform_id});n.data.success?(y.success("绑定成功"),G.value=!1,j()):y.error(n.data.message||"绑定失败")}catch(n){const r=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||"绑定失败";y.error(r)}finally{de.value=!1}},lt=async s=>{var e,n,r,o;try{await U.confirm(`确定要推送产品到 ${(e=s.ota_platform)==null?void 0:e.name} 吗？`,"确认推送",{type:"warning",confirmButtonText:"确定推送",cancelButtonText:"取消"});const f=await D.post(`/ota-products/${s.id}/push`);if(f.data.success){if(f.data.message&&f.data.message.includes("后台处理")?y.success("推送任务已提交，正在后台处理中，请稍后刷新查看结果"):y.success("推送成功"),j(),((n=f.data.data)==null?void 0:n.push_status)==="processing"){let _=0;const k=setInterval(()=>{_++,j(),_>=20&&clearInterval(k)},3e3)}}else y.error(f.data.message||"推送失败")}catch(f){if(f!=="cancel"){const _=((o=(r=f.response)==null?void 0:r.data)==null?void 0:o.message)||"推送失败";y.error(_)}}},st=async s=>{var e,n,r;try{!s.pushed_at?await U.prompt("请选择OTA平台","编辑OTA产品",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"select",inputOptions:ue.value.reduce((f,_)=>(f[_.id]=_.name,f),{}),inputValue:(e=s.ota_platform_id)==null?void 0:e.toString()}).then(async({value:f})=>{const _=parseInt(f);await D.put(`/ota-products/${s.id}`,{ota_platform_id:_,is_active:s.is_active}),y.success("更新成功"),j()}):await U.prompt("请选择状态","编辑OTA产品",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"select",inputOptions:{true:"启用",false:"禁用"},inputValue:s.is_active?"true":"false"}).then(async({value:f})=>{const _=f==="true";await D.put(`/ota-products/${s.id}`,{is_active:_}),y.success("更新成功"),j()})}catch(o){if(o!=="cancel"){const f=((r=(n=o.response)==null?void 0:n.data)==null?void 0:r.message)||"更新失败";y.error(f)}}},nt=async s=>{var e,n;try{await U.confirm("确定要删除该OTA推送记录吗？","提示",{type:"warning"}),await D.delete(`/ota-products/${s.id}`),y.success("删除成功"),j()}catch(r){if(r!=="cancel"){const o=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"删除失败";y.error(o)}}};return ct(async()=>{await j(),await et(),p.value&&(await Ve(),await Re())}),(s,e)=>{const n=h("el-page-header"),r=h("el-descriptions-item"),o=h("el-tag"),f=h("el-descriptions"),_=h("el-button"),k=h("el-option"),x=h("el-select"),T=h("el-date-picker"),q=h("el-alert"),g=h("el-table-column"),J=h("el-table"),De=h("el-collapse-item"),Ce=h("el-collapse"),rt=h("el-empty"),$=h("el-form-item"),N=h("el-input-number"),_e=h("el-form"),ce=h("el-dialog"),fe=h("el-tab-pane"),ot=h("el-input"),$e=h("el-radio"),it=h("el-radio-group"),M=h("el-checkbox"),ut=h("el-checkbox-group"),dt=h("el-switch"),pt=h("el-tabs"),mt=h("el-card"),se=ft("loading");return u(),w("div",null,[l(n,{onBack:Ee,title:"返回产品列表"},{content:t(()=>[...e[23]||(e[23]=[R("span",null,"产品详情",-1)])]),_:1}),ne((u(),b(mt,{style:{"margin-top":"20px"}},{default:t(()=>[p.value?(u(),w("div",gt,[l(f,{title:"产品基本信息",column:2,border:""},{default:t(()=>[l(r,{label:"产品名称"},{default:t(()=>[i(m(p.value.name),1)]),_:1}),l(r,{label:"产品编码"},{default:t(()=>[i(m(p.value.code),1)]),_:1}),l(r,{label:"所属景区"},{default:t(()=>{var a;return[i(m(((a=p.value.scenic_spot)==null?void 0:a.name)||"-"),1)]}),_:1}),l(r,{label:"价格来源"},{default:t(()=>[l(o,{type:p.value.price_source==="manual"?"primary":"success"},{default:t(()=>[i(m(p.value.price_source==="manual"?"人工维护":"接口推送"),1)]),_:1},8,["type"])]),_:1}),l(r,{label:"状态"},{default:t(()=>[l(o,{type:p.value.is_active?"success":"danger"},{default:t(()=>[i(m(p.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),l(r,{label:"入住天数"},{default:t(()=>[i(m(p.value.stay_days?`${p.value.stay_days} 晚`:"单晚"),1)]),_:1}),l(r,{label:"创建时间"},{default:t(()=>[i(m(ae(p.value.created_at)),1)]),_:1}),l(r,{label:"销售开始日期"},{default:t(()=>[i(m(p.value.sale_start_date?le(p.value.sale_start_date):"不限制"),1)]),_:1}),l(r,{label:"销售结束日期"},{default:t(()=>[i(m(p.value.sale_end_date?le(p.value.sale_end_date):"不限制"),1)]),_:1}),l(r,{label:"产品描述",span:2},{default:t(()=>[i(m(p.value.description||"-"),1)]),_:1})]),_:1}),l(pt,{modelValue:ke.value,"onUpdate:modelValue":e[22]||(e[22]=a=>ke.value=a),style:{"margin-top":"20px"}},{default:t(()=>[l(fe,{label:"价格管理",name:"prices"},{default:t(()=>[R("div",bt,[p.value.price_source==="manual"?(u(),b(_,{key:0,type:"primary",onClick:Ye},{default:t(()=>[...e[24]||(e[24]=[i(" 添加价格 ",-1)])]),_:1})):O("",!0),l(x,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),placeholder:"筛选房型",clearable:"",style:{width:"200px"},onChange:xe},{default:t(()=>[(u(!0),w(L,null,H(ie.value,a=>{var d;return u(),b(k,{key:a.id,label:`${((d=a.hotel)==null?void 0:d.name)||""} - ${a.name}`,value:a.id},null,8,["label","value"])}),128))]),_:1},8,["modelValue"]),l(T,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"},onChange:xe},null,8,["modelValue"]),l(_,{onClick:Le,size:"small"},{default:t(()=>[...e[25]||(e[25]=[i("重置筛选",-1)])]),_:1}),p.value.price_source!=="manual"?(u(),b(q,{key:1,title:"提示",type:"info",description:"该产品的价格由接口推送，无法手动管理",closable:!1,style:{flex:"1"}})):O("",!0)]),ne((u(),w("div",null,[he.value.length>0?(u(),b(Ce,{key:0,modelValue:Z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Z.value=a)},{default:t(()=>[(u(!0),w(L,null,H(he.value,a=>(u(),b(De,{key:a.roomTypeId,name:a.roomTypeId},{title:t(()=>[R("div",kt,[R("span",ht,m(a.hotelName)+" - "+m(a.roomTypeName),1),l(o,{size:"small",type:"info"},{default:t(()=>[i(m(a.prices.length)+" 条价格记录 ",1)]),_:2},1024),R("span",wt," 日期范围: "+m(a.dateRange),1)])]),default:t(()=>[l(J,{data:a.dateRanges,border:"",size:"small",style:{"margin-top":"10px"}},{default:t(()=>[l(g,{label:"日期范围",width:"200"},{default:t(({row:d})=>[d.start===d.end?(u(),w("span",Vt,m(d.start),1)):(u(),w("span",Rt,m(d.start)+" 至 "+m(d.end),1))]),_:1}),l(g,{prop:"market_price",label:"门市价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.market_price)),1)]),_:1}),l(g,{prop:"settlement_price",label:"结算价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.settlement_price)),1)]),_:1}),l(g,{prop:"sale_price",label:"销售价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.sale_price)),1)]),_:1}),l(g,{prop:"source",label:"来源",width:"100"},{default:t(({row:d})=>[l(o,{type:d.source==="manual"?"primary":"success",size:"small"},{default:t(()=>[i(m(d.source==="manual"?"人工":"接口"),1)]),_:2},1032,["type"])]),_:1}),p.value.price_source==="manual"?(u(),b(g,{key:0,label:"操作",width:"200"},{default:t(({row:d})=>[l(_,{size:"small",onClick:C=>qe(a,d)},{default:t(()=>[...e[26]||(e[26]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",onClick:C=>Ne(a,d)},{default:t(()=>[...e[27]||(e[27]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1032,["data"]),a.dateRanges.length>0?(u(),b(Ce,{key:0,style:{"margin-top":"10px"}},{default:t(()=>[l(De,{title:"查看详细日期列表",name:`detail-${a.roomTypeId}`},{default:t(()=>[l(J,{data:a.prices,border:"",size:"small"},{default:t(()=>[l(g,{prop:"date",label:"日期",width:"120"}),l(g,{prop:"market_price",label:"门市价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.market_price)),1)]),_:1}),l(g,{prop:"settlement_price",label:"结算价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.settlement_price)),1)]),_:1}),l(g,{prop:"sale_price",label:"销售价（元）",width:"120"},{default:t(({row:d})=>[i(m(F(d.sale_price)),1)]),_:1}),l(g,{prop:"source",label:"来源",width:"100"},{default:t(({row:d})=>[l(o,{type:d.source==="manual"?"primary":"success",size:"small"},{default:t(()=>[i(m(d.source==="manual"?"人工":"接口"),1)]),_:2},1032,["type"])]),_:1}),p.value.price_source==="manual"?(u(),b(g,{key:0,label:"操作",width:"150"},{default:t(({row:d})=>[l(_,{size:"small",onClick:C=>we(d)},{default:t(()=>[...e[28]||(e[28]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",onClick:C=>Se(d)},{default:t(()=>[...e[29]||(e[29]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})):O("",!0)]),_:1},8,["data"])]),_:2},1032,["name"])]),_:2},1024)):O("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):(u(),b(rt,{key:1,description:"暂无价格数据"}))])),[[se,je.value]]),l(ce,{modelValue:z.value,"onUpdate:modelValue":e[8]||(e[8]=a=>z.value=a),title:Ie.value,width:"600px",onClose:pe},{footer:t(()=>[l(_,{onClick:e[7]||(e[7]=a=>z.value=!1)},{default:t(()=>[...e[33]||(e[33]=[i("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:He,loading:Q.value},{default:t(()=>[...e[34]||(e[34]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(_e,{ref_key:"priceFormRef",ref:X,model:V.value,rules:Fe,"label-width":"120px"},{default:t(()=>[l($,{label:"选择房型",prop:"room_type_ids"},{default:t(()=>[l(x,{modelValue:V.value.room_type_ids,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value.room_type_ids=a),multiple:!P.value,disabled:!!P.value,placeholder:P.value?"编辑模式下不可修改房型":"请选择房型（可多选）",style:{width:"100%"}},{default:t(()=>[(u(!0),w(L,null,H(ie.value,a=>{var d;return u(),b(k,{key:a.id,label:`${(d=a.hotel)==null?void 0:d.name} - ${a.name}`,value:a.id},null,8,["label","value"])}),128))]),_:1},8,["modelValue","multiple","disabled","placeholder"]),R("span",xt,[P.value?(u(),w("span",Dt,"编辑模式下只能修改价格，不能修改房型")):(u(),w("span",Ct,"可同时为多个房型设置价格"))])]),_:1}),l($,{label:"日期范围"},{default:t(()=>[p.value.sale_start_date||p.value.sale_end_date?(u(),b(q,{key:0,type:"info",closable:!1},{title:t(()=>[e[30]||(e[30]=R("span",null,"将使用产品的销售日期范围：",-1)),p.value.sale_start_date?(u(),w("span",$t,m(le(p.value.sale_start_date)),1)):(u(),w("span",jt,"不限制")),e[31]||(e[31]=R("span",null," 至 ",-1)),p.value.sale_end_date?(u(),w("span",Pt,m(le(p.value.sale_end_date)),1)):(u(),w("span",Tt,"不限制"))]),_:1})):(u(),b(q,{key:1,type:"warning",closable:!1},{title:t(()=>[...e[32]||(e[32]=[R("span",null,"产品未设置销售日期范围，请先在产品编辑页面设置销售开始日期和结束日期",-1)])]),_:1}))]),_:1}),l($,{label:"门市价（元）",prop:"market_price"},{default:t(()=>[l(N,{modelValue:V.value.market_price,"onUpdate:modelValue":e[4]||(e[4]=a=>V.value.market_price=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"结算价（元）",prop:"settlement_price"},{default:t(()=>[l(N,{modelValue:V.value.settlement_price,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value.settlement_price=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"销售价（元）",prop:"sale_price"},{default:t(()=>[l(N,{modelValue:V.value.sale_price,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value.sale_price=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),l(fe,{label:"加价规则",name:"priceRules"},{default:t(()=>[R("div",Ft,[p.value.price_source==="manual"?(u(),b(_,{key:0,type:"primary",onClick:We},{default:t(()=>[...e[35]||(e[35]=[i(" 添加加价规则 ",-1)])]),_:1})):(u(),b(q,{key:1,title:"提示",type:"info",description:"该产品的价格由接口推送，无法设置加价规则",closable:!1,style:{"margin-bottom":"20px"}}))]),ne((u(),b(J,{data:ge.value,border:""},{default:t(()=>[l(g,{prop:"name",label:"规则名称",width:"150"}),l(g,{prop:"type",label:"规则类型",width:"120"},{default:t(({row:a})=>[l(o,null,{default:t(()=>[i(m(a.type==="weekday"?"周几规则":"日期区间规则"),1)]),_:2},1024)]),_:1}),l(g,{label:"规则内容",width:"200"},{default:t(({row:a})=>[a.type==="weekday"?(u(),w("span",Ot," 周"+m(Ae(a.weekdays)),1)):(u(),w("span",It,m(ae(a.start_date))+" 至 "+m(ae(a.end_date)),1))]),_:1}),l(g,{label:"价格调整",width:"300"},{default:t(({row:a})=>[R("div",null,[R("span",null,"门市价: "+m(a.market_price_adjustment>=0?"+":"")+m(F(a.market_price_adjustment)),1),e[36]||(e[36]=R("br",null,null,-1)),R("span",null,"结算价: "+m(a.settlement_price_adjustment>=0?"+":"")+m(F(a.settlement_price_adjustment)),1),e[37]||(e[37]=R("br",null,null,-1)),R("span",null,"销售价: "+m(a.sale_price_adjustment>=0?"+":"")+m(F(a.sale_price_adjustment)),1)])]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:a})=>[l(o,{type:a.is_active?"success":"danger"},{default:t(()=>[i(m(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),p.value.price_source==="manual"?(u(),b(g,{key:0,label:"操作",width:"200"},{default:t(({row:a})=>[l(_,{size:"small",onClick:d=>Ge(a)},{default:t(()=>[...e[38]||(e[38]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",onClick:d=>Je(a)},{default:t(()=>[...e[39]||(e[39]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})):O("",!0)]),_:1},8,["data"])),[[se,Pe.value]]),l(ce,{modelValue:A.value,"onUpdate:modelValue":e[18]||(e[18]=a=>A.value=a),title:Ue.value,width:"700px",onClose:me},{footer:t(()=>[l(_,{onClick:e[17]||(e[17]=a=>A.value=!1)},{default:t(()=>[...e[52]||(e[52]=[i("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:Ze,loading:oe.value},{default:t(()=>[...e[53]||(e[53]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(_e,{ref_key:"priceRuleFormRef",ref:ee,model:c.value,rules:Oe,"label-width":"140px"},{default:t(()=>[l($,{label:"规则名称",prop:"name"},{default:t(()=>[l(ot,{modelValue:c.value.name,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value.name=a),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l($,{label:"规则类型",prop:"type"},{default:t(()=>[l(it,{modelValue:c.value.type,"onUpdate:modelValue":e[10]||(e[10]=a=>c.value.type=a)},{default:t(()=>[l($e,{label:"weekday"},{default:t(()=>[...e[40]||(e[40]=[i("周几规则",-1)])]),_:1}),l($e,{label:"date_range"},{default:t(()=>[...e[41]||(e[41]=[i("日期区间规则",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value.type==="weekday"?(u(),b($,{key:0,label:"选择周几",prop:"weekdays"},{default:t(()=>[l(ut,{modelValue:c.value.weekdays,"onUpdate:modelValue":e[11]||(e[11]=a=>c.value.weekdays=a)},{default:t(()=>[l(M,{label:"1"},{default:t(()=>[...e[42]||(e[42]=[i("周一",-1)])]),_:1}),l(M,{label:"2"},{default:t(()=>[...e[43]||(e[43]=[i("周二",-1)])]),_:1}),l(M,{label:"3"},{default:t(()=>[...e[44]||(e[44]=[i("周三",-1)])]),_:1}),l(M,{label:"4"},{default:t(()=>[...e[45]||(e[45]=[i("周四",-1)])]),_:1}),l(M,{label:"5"},{default:t(()=>[...e[46]||(e[46]=[i("周五",-1)])]),_:1}),l(M,{label:"6"},{default:t(()=>[...e[47]||(e[47]=[i("周六",-1)])]),_:1}),l(M,{label:"7"},{default:t(()=>[...e[48]||(e[48]=[i("周日",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):O("",!0),c.value.type==="date_range"?(u(),b($,{key:1,label:"日期区间",prop:"dateRange"},{default:t(()=>[l(T,{modelValue:c.value.dateRange,"onUpdate:modelValue":e[12]||(e[12]=a=>c.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})):O("",!0),l($,{label:"门市价调整（元）",prop:"market_price_adjustment"},{default:t(()=>[l(N,{modelValue:c.value.market_price_adjustment,"onUpdate:modelValue":e[13]||(e[13]=a=>c.value.market_price_adjustment=a),precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[49]||(e[49]=R("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 正数表示加价，负数表示减价 ",-1))]),_:1}),l($,{label:"结算价调整（元）",prop:"settlement_price_adjustment"},{default:t(()=>[l(N,{modelValue:c.value.settlement_price_adjustment,"onUpdate:modelValue":e[14]||(e[14]=a=>c.value.settlement_price_adjustment=a),precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"销售价调整（元）",prop:"sale_price_adjustment"},{default:t(()=>[l(N,{modelValue:c.value.sale_price_adjustment,"onUpdate:modelValue":e[15]||(e[15]=a=>c.value.sale_price_adjustment=a),precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{label:"适用房型",prop:"items"},{default:t(()=>[l(J,{data:c.value.items,border:"",style:{width:"100%"}},{default:t(()=>[l(g,{label:"酒店",width:"200"},{default:t(({row:a,$index:d})=>[l(x,{modelValue:a.hotel_id,"onUpdate:modelValue":C=>a.hotel_id=C,placeholder:"请选择酒店",style:{width:"100%"},onChange:C=>Xe(d)},{default:t(()=>[(u(!0),w(L,null,H(ze.value,C=>(u(),b(k,{key:C.id,label:C.name,value:C.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(g,{label:"房型",width:"200"},{default:t(({row:a,$index:d})=>[l(x,{modelValue:a.room_type_id,"onUpdate:modelValue":C=>a.room_type_id=C,placeholder:"请选择房型",style:{width:"100%"}},{default:t(()=>[(u(!0),w(L,null,H(Me(a.hotel_id),C=>(u(),b(k,{key:C.id,label:C.name,value:C.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(g,{label:"操作",width:"100"},{default:t(({$index:a})=>[l(_,{size:"small",type:"danger",onClick:d=>Qe(a)},{default:t(()=>[...e[50]||(e[50]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(_,{type:"primary",size:"small",style:{"margin-top":"10px"},onClick:Ke},{default:t(()=>[...e[51]||(e[51]=[i(" 添加房型 ",-1)])]),_:1})]),_:1}),l($,{label:"状态",prop:"is_active"},{default:t(()=>[l(dt,{modelValue:c.value.is_active,"onUpdate:modelValue":e[16]||(e[16]=a=>c.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),l(fe,{label:"OTA推送",name:"otaProducts"},{default:t(()=>[R("div",Ut,[l(_,{type:"primary",onClick:tt},{default:t(()=>[...e[54]||(e[54]=[i("绑定OTA平台",-1)])]),_:1})]),ne((u(),b(J,{data:be.value,border:""},{default:t(()=>[l(g,{label:"OTA平台",width:"150"},{default:t(({row:a})=>{var d;return[i(m(((d=a.ota_platform)==null?void 0:d.name)||"-"),1)]}),_:1}),l(g,{label:"OTA产品ID",width:"200"},{default:t(({row:a})=>[a.ota_product_id?(u(),w("span",zt,m(a.ota_product_id),1)):(u(),w("span",Mt,"-"))]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:a})=>[l(o,{type:a.is_active?"success":"danger"},{default:t(()=>[i(m(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"推送状态",width:"150"},{default:t(({row:a})=>[a.push_status==="processing"?(u(),b(o,{key:0,type:"warning"},{default:t(()=>[...e[55]||(e[55]=[i(" 推送中... ",-1)])]),_:1})):a.push_status==="success"?(u(),b(o,{key:1,type:"success"},{default:t(()=>[...e[56]||(e[56]=[i(" 推送成功 ",-1)])]),_:1})):a.push_status==="failed"?(u(),b(o,{key:2,type:"danger"},{default:t(()=>[...e[57]||(e[57]=[i(" 推送失败 ",-1)])]),_:1})):a.pushed_at?(u(),b(o,{key:3,type:"success"},{default:t(()=>[...e[58]||(e[58]=[i(" 已推送 ",-1)])]),_:1})):(u(),b(o,{key:4,type:"info"},{default:t(()=>[...e[59]||(e[59]=[i(" 未推送 ",-1)])]),_:1}))]),_:1}),l(g,{prop:"pushed_at",label:"推送时间",width:"180"},{default:t(({row:a})=>[i(m(a.pushed_at?ae(a.pushed_at):"-"),1)]),_:1}),l(g,{label:"操作",width:"250",fixed:"right"},{default:t(({row:a})=>[l(_,{size:"small",onClick:d=>st(a)},{default:t(()=>[...e[60]||(e[60]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",onClick:d=>nt(a)},{default:t(()=>[...e[61]||(e[61]=[i("删除",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"primary",onClick:d=>lt(a),disabled:!a.is_active||a.push_status==="processing",loading:a.push_status==="processing"},{default:t(()=>[i(m(a.push_status==="processing"?"推送中...":a.pushed_at?"重新推送":"推送"),1)]),_:2},1032,["onClick","disabled","loading"])]),_:1})]),_:1},8,["data"])),[[se,Te.value]]),l(ce,{modelValue:G.value,"onUpdate:modelValue":e[21]||(e[21]=a=>G.value=a),title:"绑定OTA平台",width:"500px"},{footer:t(()=>[l(_,{onClick:e[20]||(e[20]=a=>G.value=!1)},{default:t(()=>[...e[62]||(e[62]=[i("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:at,loading:de.value},{default:t(()=>[...e[63]||(e[63]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(_e,{model:S.value,"label-width":"120px"},{default:t(()=>[l($,{label:"选择OTA平台",required:""},{default:t(()=>[l(x,{modelValue:S.value.ota_platform_id,"onUpdate:modelValue":e[19]||(e[19]=a=>S.value.ota_platform_id=a),placeholder:"请选择要绑定的OTA平台",style:{width:"100%"}},{default:t(()=>[(u(!0),w(L,null,H(ue.value,a=>(u(),b(k,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])):O("",!0)]),_:1})),[[se,re.value]])])}}},Yt=_t(Bt,[["__scopeId","data-v-4df9d496"]]);export{Yt as default};
