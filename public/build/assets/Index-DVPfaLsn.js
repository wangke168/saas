import{_ as Y,r as i,s as T,i as ee,c as q,o as x,f as M,b as l,w as t,d as s,j as k,E as f,k as le,l as ae,h as c,x as te,y as oe,n as N,t as $,q as ne}from"./app-DOrDR003.js";const se={style:{"margin-bottom":"20px"}},re={key:1},ie={__name:"Index",setup(ue){const E=i([]),C=i(!1),h=i(!1),m=i(!1),y=i(null),z=i(""),b=i(1),U=i(15),I=i(0),V=i(null),B=T(()=>V.value!==null),j=T(()=>B.value?"编辑软件服务商":"创建软件服务商"),n=i({name:"",code:"",api_type:"",description:"",is_active:!0}),R={name:[{required:!0,message:"请输入服务商名称",trigger:"blur"},{max:255,message:"服务商名称不能超过255个字符",trigger:"blur"}],code:[{required:!0,message:"请输入服务商编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"服务商编码只能包含字母、数字、下划线和连字符",trigger:"blur"}]},v=async()=>{C.value=!0;try{const o={page:b.value,per_page:U.value};z.value;const e=await k.get("/software-providers",{params:o});E.value=e.data.data||[],I.value=e.data.total||0}catch(o){f.error("获取软件服务商列表失败"),console.error(o)}finally{C.value=!1}},A=()=>{b.value=1,v()},F=()=>{V.value=null,D(),m.value=!0},K=o=>{V.value=o.id,n.value={name:o.name,code:o.code,api_type:o.api_type||"",description:o.description||"",is_active:o.is_active},m.value=!0},Z=async()=>{y.value&&await y.value.validate(async o=>{var e,r,p,d,u,_;if(o){h.value=!0;try{B.value?(await k.put(`/software-providers/${V.value}`,n.value),f.success("软件服务商更新成功")):(await k.post("/software-providers",n.value),f.success("软件服务商创建成功")),m.value=!1,v()}catch(w){const S=((r=(e=w.response)==null?void 0:e.data)==null?void 0:r.message)||((_=(u=(d=(p=w.response)==null?void 0:p.data)==null?void 0:d.errors)==null?void 0:u.code)==null?void 0:_[0])||"操作失败";f.error(S)}finally{h.value=!1}}})},G=async o=>{var e,r;try{await ne.confirm(`确定要删除软件服务商"${o.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await k.delete(`/software-providers/${o.id}`),f.success("删除成功"),v()}catch(p){if(p!=="cancel"){const d=((r=(e=p.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败";f.error(d),console.error(p)}}},D=()=>{var o;n.value={name:"",code:"",api_type:"",description:"",is_active:!0},(o=y.value)==null||o.clearValidate()};return ee(()=>{v()}),(o,e)=>{const r=s("el-button"),p=s("el-icon"),d=s("el-input"),u=s("el-table-column"),_=s("el-tag"),w=s("el-table"),S=s("el-pagination"),H=s("el-card"),g=s("el-form-item"),P=s("el-option"),J=s("el-select"),L=s("el-switch"),O=s("el-form"),Q=s("el-dialog"),W=le("loading");return x(),q("div",null,[e[15]||(e[15]=M("h2",null,"软件服务商管理",-1)),l(H,null,{default:t(()=>[M("div",se,[l(r,{type:"primary",onClick:F},{default:t(()=>[...e[10]||(e[10]=[c("创建软件服务商",-1)])]),_:1}),l(d,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=a=>z.value=a),placeholder:"搜索服务商名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:A},{prefix:t(()=>[l(p,null,{default:t(()=>[l(te(oe))]),_:1})]),_:1},8,["modelValue"])]),ae((x(),N(w,{data:E.value,border:""},{default:t(()=>[l(u,{prop:"name",label:"服务商名称",width:"200"}),l(u,{prop:"code",label:"服务商编码",width:"150"}),l(u,{prop:"api_type",label:"接口类型",width:"150"},{default:t(({row:a})=>[a.api_type?(x(),N(_,{key:0,type:"info"},{default:t(()=>[c($(a.api_type),1)]),_:2},1024)):(x(),q("span",re,"-"))]),_:1}),l(u,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(u,{label:"关联景区",width:"120"},{default:t(({row:a})=>[l(_,{type:"info"},{default:t(()=>[c($(a.scenic_spots_count||0),1)]),_:2},1024)]),_:1}),l(u,{prop:"is_active",label:"状态",width:"100"},{default:t(({row:a})=>[l(_,{type:a.is_active?"success":"danger"},{default:t(()=>[c($(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(r,{size:"small",onClick:X=>K(a)},{default:t(()=>[...e[11]||(e[11]=[c("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:X=>G(a)},{default:t(()=>[...e[12]||(e[12]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,C.value]]),l(S,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=a=>b.value=a),"page-size":U.value,"onUpdate:pageSize":e[2]||(e[2]=a=>U.value=a),"page-sizes":[10,20,50,100],total:I.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1}),l(Q,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=a=>m.value=a),title:j.value,width:"600px",onClose:D},{footer:t(()=>[l(r,{onClick:e[8]||(e[8]=a=>m.value=!1)},{default:t(()=>[...e[13]||(e[13]=[c("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Z,loading:h.value},{default:t(()=>[...e[14]||(e[14]=[c("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(O,{ref_key:"formRef",ref:y,model:n.value,rules:R,"label-width":"120px"},{default:t(()=>[l(g,{label:"服务商名称",prop:"name"},{default:t(()=>[l(d,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.name=a),placeholder:"请输入服务商名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"服务商编码",prop:"code"},{default:t(()=>[l(d,{modelValue:n.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.code=a),placeholder:"请输入服务商编码（唯一）",disabled:B.value},null,8,["modelValue","disabled"])]),_:1}),l(g,{label:"接口类型",prop:"api_type"},{default:t(()=>[l(J,{modelValue:n.value.api_type,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.api_type=a),placeholder:"请选择接口类型",clearable:"",style:{width:"100%"}},{default:t(()=>[l(P,{label:"横店影视城",value:"hengdian"}),l(P,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"描述",prop:"description"},{default:t(()=>[l(d,{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.description=a),type:"textarea",rows:4,placeholder:"请输入服务商描述"},null,8,["modelValue"])]),_:1}),l(g,{label:"状态",prop:"is_active"},{default:t(()=>[l(L,{modelValue:n.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=Y(ie,[["__scopeId","data-v-6eac2672"]]);export{pe as default};
