import{_ as ce,r as s,s as Z,i as pe,c as I,o as _,f as C,b as t,w as a,d as i,j as x,E as f,k as me,l as ve,h as d,x as _e,y as fe,n as E,p as G,F as H,v as J,t as S,q as ge}from"./app-C7b5dp06.js";const be={style:{"margin-bottom":"20px"}},ye={key:1,style:{color:"#909399"}},Ve={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},xe={__name:"Index",setup(he){const T=s([]),M=s([]),D=s(!1),P=s(!1),b=s(!1),z=s(null),w=s(""),$=s(1),A=s(15),j=s(0),U=s(null),h=s(!1),F=s(!1),N=s(null),k=s([]),B=Z(()=>U.value!==null),O=Z(()=>B.value?"编辑资源方":"创建资源方"),n=s({name:"",code:"",contact_name:"",contact_phone:"",contact_email:"",description:"",is_active:!0}),Q={name:[{required:!0,message:"请输入资源方名称",trigger:"blur"},{max:255,message:"资源方名称不能超过255个字符",trigger:"blur"}],code:[{pattern:/^[a-zA-Z0-9_-]+$/,message:"资源方编码只能包含字母、数字、下划线和连字符",trigger:"blur"}],contact_phone:[{pattern:/^1[3-9]\d{9}$|^0\d{2,3}-?\d{7,8}$/,message:"请输入正确的电话号码",trigger:"blur"}],contact_email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},g=async()=>{D.value=!0;try{const o={page:$.value,per_page:A.value};w.value&&(o.search=w.value);const e=await x.get("/resource-providers",{params:o});T.value=e.data.data||[],j.value=e.data.total||0}catch(o){f.error("获取资源方列表失败"),console.error(o)}finally{D.value=!1}},W=async()=>{try{const o=await x.get("/scenic-spots");M.value=o.data.data||[]}catch(o){console.error("获取景区列表失败",o)}},X=()=>{$.value=1,g()},Y=()=>{U.value=null,q(),b.value=!0},ee=o=>{U.value=o.id,n.value={name:o.name,code:o.code,contact_name:o.contact_name||"",contact_phone:o.contact_phone||"",contact_email:o.contact_email||"",description:o.description||"",is_active:o.is_active},b.value=!0},le=async()=>{z.value&&await z.value.validate(async o=>{var e,u,y,c,r,V;if(o){P.value=!0;try{const p={...n.value};(!p.code||p.code.trim()==="")&&delete p.code,B.value?(await x.put(`/resource-providers/${U.value}`,p),f.success("资源方更新成功")):(await x.post("/resource-providers",p),f.success("资源方创建成功")),b.value=!1,g()}catch(p){const R=((u=(e=p.response)==null?void 0:e.data)==null?void 0:u.message)||((V=(r=(c=(y=p.response)==null?void 0:y.data)==null?void 0:c.errors)==null?void 0:r.code)==null?void 0:V[0])||"操作失败";f.error(R)}finally{P.value=!1}}})},te=async o=>{try{await ge.confirm(`确定要删除资源方"${o.name}"吗？删除后无法恢复！`,"提示",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await x.delete(`/resource-providers/${o.id}`),f.success("删除成功"),g()}catch(e){e!=="cancel"&&(f.error("删除失败"),console.error(e))}},ae=o=>{var e;N.value=o.id,k.value=((e=o.scenic_spots)==null?void 0:e.map(u=>u.id))||[],h.value=!0},oe=async()=>{var o,e;F.value=!0;try{await x.post(`/resource-providers/${N.value}/attach-scenic-spots`,{scenic_spot_ids:k.value}),f.success("景区关联成功"),h.value=!1,g()}catch(u){const y=((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.message)||"操作失败";f.error(y)}finally{F.value=!1}},q=()=>{var o;n.value={name:"",code:"",contact_name:"",contact_phone:"",contact_email:"",description:"",is_active:!0},(o=z.value)==null||o.clearValidate()},ne=()=>{k.value=[],N.value=null};return pe(()=>{g(),W()}),(o,e)=>{const u=i("el-button"),y=i("el-icon"),c=i("el-input"),r=i("el-table-column"),V=i("el-tag"),p=i("el-table"),R=i("el-pagination"),se=i("el-card"),m=i("el-form-item"),ue=i("el-switch"),K=i("el-form"),L=i("el-dialog"),ie=i("el-option"),re=i("el-select"),de=me("loading");return _(),I("div",null,[e[24]||(e[24]=C("h2",null,"资源方管理",-1)),t(se,null,{default:a(()=>[C("div",be,[t(u,{type:"primary",onClick:Y},{default:a(()=>[...e[15]||(e[15]=[d("创建资源方",-1)])]),_:1}),t(c,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),placeholder:"搜索资源方名称或编码",style:{width:"300px","margin-left":"10px"},clearable:"",onInput:X},{prefix:a(()=>[t(y,null,{default:a(()=>[t(_e(fe))]),_:1})]),_:1},8,["modelValue"])]),ve((_(),E(p,{data:T.value,border:""},{default:a(()=>[t(r,{prop:"name",label:"资源方名称",width:"200"}),t(r,{prop:"code",label:"资源方编码",width:"150"}),t(r,{prop:"contact_name",label:"联系人",width:"120"}),t(r,{prop:"contact_phone",label:"联系电话",width:"150"}),t(r,{prop:"contact_email",label:"联系邮箱",width:"200"}),t(r,{label:"关联景区",width:"200"},{default:a(({row:l})=>[(_(!0),I(H,null,J((l.scenic_spots||[]).slice(0,2),v=>(_(),E(V,{key:v.id,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:a(()=>[d(S(v.name),1)]),_:2},1024))),128)),l.scenic_spots&&l.scenic_spots.length>2?(_(),E(V,{key:0,size:"small",type:"info"},{default:a(()=>[d(" +"+S(l.scenic_spots.length-2),1)]),_:2},1024)):G("",!0),!l.scenic_spots||l.scenic_spots.length===0?(_(),I("span",ye," 未关联 ")):G("",!0)]),_:1}),t(r,{label:"关联用户",width:"150"},{default:a(({row:l})=>{var v;return[C("span",null,S(((v=l.users)==null?void 0:v.length)||0)+" 个运营账号",1)]}),_:1}),t(r,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:l})=>[t(V,{type:l.is_active?"success":"danger"},{default:a(()=>[d(S(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"操作",width:"280",fixed:"right"},{default:a(({row:l})=>[t(u,{size:"small",onClick:v=>ee(l)},{default:a(()=>[...e[16]||(e[16]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"info",onClick:v=>ae(l)},{default:a(()=>[...e[17]||(e[17]=[d("关联景区",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:v=>te(l)},{default:a(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,D.value]]),t(R,{"current-page":$.value,"onUpdate:currentPage":e[1]||(e[1]=l=>$.value=l),"page-size":A.value,"onUpdate:pageSize":e[2]||(e[2]=l=>A.value=l),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"},onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),t(L,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=l=>b.value=l),title:O.value,width:"600px",onClose:q},{footer:a(()=>[t(u,{onClick:e[10]||(e[10]=l=>b.value=!1)},{default:a(()=>[...e[19]||(e[19]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:le,loading:P.value},{default:a(()=>[...e[20]||(e[20]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(K,{ref_key:"formRef",ref:z,model:n.value,rules:Q,"label-width":"120px"},{default:a(()=>[t(m,{label:"资源方名称",prop:"name"},{default:a(()=>[t(c,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.name=l),placeholder:"请输入资源方名称"},null,8,["modelValue"])]),_:1}),t(m,{label:"资源方编码",prop:"code"},{default:a(()=>[t(c,{modelValue:n.value.code,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.code=l),placeholder:"留空则自动生成",disabled:B.value},null,8,["modelValue","disabled"]),C("span",Ve,S(B.value?"编码不可修改":"留空将自动生成唯一编码"),1)]),_:1}),t(m,{label:"联系人",prop:"contact_name"},{default:a(()=>[t(c,{modelValue:n.value.contact_name,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.contact_name=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),t(m,{label:"联系电话",prop:"contact_phone"},{default:a(()=>[t(c,{modelValue:n.value.contact_phone,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.contact_phone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(m,{label:"联系邮箱",prop:"contact_email"},{default:a(()=>[t(c,{modelValue:n.value.contact_email,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.contact_email=l),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述",prop:"description"},{default:a(()=>[t(c,{modelValue:n.value.description,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.description=l),type:"textarea",rows:4,placeholder:"请输入资源方描述"},null,8,["modelValue"])]),_:1}),t(m,{label:"状态",prop:"is_active"},{default:a(()=>[t(ue,{modelValue:n.value.is_active,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(L,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=l=>h.value=l),title:"关联景区",width:"600px",onClose:ne},{footer:a(()=>[t(u,{onClick:e[13]||(e[13]=l=>h.value=!1)},{default:a(()=>[...e[22]||(e[22]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:oe,loading:F.value},{default:a(()=>[...e[23]||(e[23]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(K,{"label-width":"120px"},{default:a(()=>[t(m,{label:"选择景区"},{default:a(()=>[t(re,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=l=>k.value=l),placeholder:"请选择要关联的景区（可多选）",multiple:"",style:{width:"100%"}},{default:a(()=>[(_(!0),I(H,null,J(M.value,l=>(_(),E(ie,{key:l.id,label:`${l.name} (${l.code})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[21]||(e[21]=C("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 一个资源方可以关联多个景区 ",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ce=ce(xe,[["__scopeId","data-v-7f4e6beb"]]);export{Ce as default};
