import{_ as pe,r as d,i as _e,c as j,o as k,b as l,m as A,w as a,d as n,l as me,q as h,k as x,B as ve,E as f,e as fe,f as G,s as H,h as s,t as _,v as ge}from"./app-CQIcOIsZ.js";const be={key:0},ye={style:{"margin-bottom":"20px"}},ke={__name:"Detail",setup(Ve){const J=ve(),K=fe(),P=d(!1),c=d(null),E=d("prices"),M=d([]),R=d(!1),g=d([]),V=d(!1),C=d(null),U=d(!1),i=d({dateRange:null,cost_price:0,sale_price:0,stock_available:0}),O={dateRange:[{required:!0,message:"请选择日期范围",trigger:"change"}],cost_price:[{required:!0,message:"请输入成本价",trigger:"blur"}],sale_price:[{required:!0,message:"请输入销售价",trigger:"blur"},{validator:(o,e,p)=>{e<i.value.cost_price?p(new Error("销售价不能低于成本价")):p()},trigger:"blur"}],stock_available:[{required:!0,message:"请输入可用库存",trigger:"blur"}]},w=d(!1),F=d(null),B=d(!1),q=d(null),u=d({date:null,cost_price:0,sale_price:0,stock_available:0}),Q={cost_price:[{required:!0,message:"请输入成本价",trigger:"blur"}],sale_price:[{required:!0,message:"请输入销售价",trigger:"blur"},{validator:(o,e,p)=>{e<u.value.cost_price?p(new Error("销售价不能低于成本价")):p()},trigger:"blur"}],stock_available:[{required:!0,message:"请输入可用库存",trigger:"blur"}]},W=()=>{K.push("/tickets")},S=o=>o?parseFloat(o).toFixed(2):"0.00",X=async()=>{P.value=!0;try{const o=await x.get(`/tickets/${J.params.id}`);c.value=o.data.data,c.value&&await b()}catch(o){f.error("获取门票详情失败"),console.error(o)}finally{P.value=!1}},b=async()=>{if(c.value){R.value=!0;try{const o={ticket_id:c.value.id};g.value&&g.value.length===2&&(o.start_date=g.value[0],o.end_date=g.value[1]);const e=await x.get("/ticket-prices",{params:o});M.value=e.data.data||[]}catch(o){f.error("获取价库列表失败"),console.error(o)}finally{R.value=!1}}},Z=()=>{g.value=[],b()},ee=()=>{N(),V.value=!0},le=async()=>{C.value&&await C.value.validate(async o=>{var e,p;if(o){U.value=!0;try{const r={ticket_id:c.value.id,start_date:i.value.dateRange[0],end_date:i.value.dateRange[1],cost_price:i.value.cost_price,sale_price:i.value.sale_price,stock_available:i.value.stock_available};await x.post("/ticket-prices/batch",r),f.success("批量设置价库成功"),V.value=!1,await b()}catch(r){const Y=((p=(e=r.response)==null?void 0:e.data)==null?void 0:p.message)||r.message||"操作失败";f.error(Y),console.error(r)}finally{U.value=!1}}})},ae=o=>{q.value=o.id,u.value={date:o.date,cost_price:parseFloat(o.cost_price),sale_price:parseFloat(o.sale_price),stock_available:o.stock_available},w.value=!0},te=async()=>{F.value&&await F.value.validate(async o=>{var e,p;if(o){B.value=!0;try{const r={cost_price:u.value.cost_price,sale_price:u.value.sale_price,stock_available:u.value.stock_available};await x.put(`/ticket-prices/${q.value}`,r),f.success("价库更新成功"),w.value=!1,await b()}catch(r){const Y=((p=(e=r.response)==null?void 0:e.data)==null?void 0:p.message)||r.message||"操作失败";f.error(Y),console.error(r)}finally{B.value=!1}}})},oe=async o=>{try{await ge.confirm(`确定要删除日期为"${o.date}"的价库记录吗？`,"提示",{type:"warning"}),await x.delete(`/ticket-prices/${o.id}`),f.success("删除成功"),await b()}catch(e){e!=="cancel"&&(f.error("删除失败"),console.error(e))}},N=()=>{var o;(o=C.value)==null||o.resetFields(),i.value={dateRange:null,cost_price:0,sale_price:0,stock_available:0}},re=()=>{var o;(o=F.value)==null||o.resetFields(),q.value=null,u.value={date:null,cost_price:0,sale_price:0,stock_available:0}};return _e(()=>{X()}),(o,e)=>{const p=n("el-page-header"),r=n("el-descriptions-item"),Y=n("el-tag"),se=n("el-descriptions"),m=n("el-button"),$=n("el-date-picker"),D=n("el-table-column"),ie=n("el-table"),T=n("el-empty"),v=n("el-form-item"),y=n("el-input-number"),z=n("el-form"),I=n("el-dialog"),ne=n("el-tab-pane"),ue=n("el-tabs"),de=n("el-card"),L=me("loading");return k(),j("div",null,[l(p,{onBack:W,title:"返回门票列表"},{content:a(()=>[...e[14]||(e[14]=[G("span",null,"门票详情",-1)])]),_:1}),A((k(),h(de,{style:{"margin-top":"20px"}},{default:a(()=>[c.value?(k(),j("div",be,[l(se,{title:"门票基本信息",column:2,border:"",style:{"margin-bottom":"20px"}},{default:a(()=>[l(r,{label:"门票名称"},{default:a(()=>[s(_(c.value.name),1)]),_:1}),l(r,{label:"门票编码"},{default:a(()=>[s(_(c.value.code),1)]),_:1}),l(r,{label:"所属景区"},{default:a(()=>{var t;return[s(_(((t=c.value.scenic_spot)==null?void 0:t.name)||"-"),1)]}),_:1}),l(r,{label:"软件服务商"},{default:a(()=>{var t;return[s(_(((t=c.value.software_provider)==null?void 0:t.name)||"-"),1)]}),_:1}),l(r,{label:"外部门票编号"},{default:a(()=>[s(_(c.value.external_ticket_id||"-"),1)]),_:1}),l(r,{label:"状态"},{default:a(()=>[l(Y,{type:c.value.is_active?"success":"danger"},{default:a(()=>[s(_(c.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),l(r,{label:"描述",span:2},{default:a(()=>[s(_(c.value.description||"-"),1)]),_:1})]),_:1}),l(ue,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=t=>E.value=t),style:{"margin-top":"20px"}},{default:a(()=>[l(ne,{label:"价库管理",name:"prices"},{default:a(()=>[G("div",ye,[l(m,{type:"primary",onClick:ee},{default:a(()=>[...e[15]||(e[15]=[s("批量设置价库",-1)])]),_:1}),l($,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{"margin-left":"20px"},onChange:b},null,8,["modelValue"]),l(m,{style:{"margin-left":"10px"},onClick:Z},{default:a(()=>[...e[16]||(e[16]=[s("重置筛选",-1)])]),_:1})]),A((k(),h(ie,{data:M.value,border:""},{default:a(()=>[l(D,{prop:"date",label:"日期",width:"120"}),l(D,{prop:"cost_price",label:"成本价",width:"120",align:"right"},{default:a(({row:t})=>[s(" ¥"+_(S(t.cost_price)),1)]),_:1}),l(D,{prop:"sale_price",label:"销售价",width:"120",align:"right"},{default:a(({row:t})=>[s(" ¥"+_(S(t.sale_price)),1)]),_:1}),l(D,{prop:"stock_available",label:"可用库存",width:"120",align:"right"}),l(D,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(m,{size:"small",onClick:ce=>ae(t)},{default:a(()=>[...e[17]||(e[17]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(m,{size:"small",type:"danger",onClick:ce=>oe(t)},{default:a(()=>[...e[18]||(e[18]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,R.value]]),!R.value&&M.value.length===0?(k(),h(T,{key:0,description:"暂无价格数据"})):H("",!0),l(I,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),title:"批量设置价库",width:"600px","append-to-body":"",onClose:N},{footer:a(()=>[l(m,{onClick:e[5]||(e[5]=t=>V.value=!1)},{default:a(()=>[...e[19]||(e[19]=[s("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:le,loading:U.value},{default:a(()=>[...e[20]||(e[20]=[s("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(z,{ref_key:"batchPriceFormRef",ref:C,model:i.value,rules:O,"label-width":"120px"},{default:a(()=>[l(v,{label:"日期范围",prop:"dateRange"},{default:a(()=>[l($,{modelValue:i.value.dateRange,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(v,{label:"成本价",prop:"cost_price"},{default:a(()=>[l(y,{modelValue:i.value.cost_price,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.cost_price=t),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(v,{label:"销售价",prop:"sale_price"},{default:a(()=>[l(y,{modelValue:i.value.sale_price,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.sale_price=t),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(v,{label:"可用库存",prop:"stock_available"},{default:a(()=>[l(y,{modelValue:i.value.stock_available,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.stock_available=t),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(I,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),title:"编辑价库",width:"500px","append-to-body":"",onClose:re},{footer:a(()=>[l(m,{onClick:e[11]||(e[11]=t=>w.value=!1)},{default:a(()=>[...e[21]||(e[21]=[s("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:te,loading:B.value},{default:a(()=>[...e[22]||(e[22]=[s("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(z,{ref_key:"priceFormRef",ref:F,model:u.value,rules:Q,"label-width":"120px"},{default:a(()=>[l(v,{label:"日期"},{default:a(()=>[l($,{modelValue:u.value.date,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"成本价",prop:"cost_price"},{default:a(()=>[l(y,{modelValue:u.value.cost_price,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.cost_price=t),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(v,{label:"销售价",prop:"sale_price"},{default:a(()=>[l(y,{modelValue:u.value.sale_price,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.sale_price=t),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(v,{label:"可用库存",prop:"stock_available"},{default:a(()=>[l(y,{modelValue:u.value.stock_available,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.stock_available=t),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])):P.value?H("",!0):(k(),h(T,{key:1,description:"门票信息加载失败或不存在"}))]),_:1})),[[L,P.value]])])}}},Ye=pe(ke,[["__scopeId","data-v-ae8b7f03"]]);export{Ye as default};
