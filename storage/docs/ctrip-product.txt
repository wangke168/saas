{"swagger":"2.0","schemes":["https","http"],"info":{"description":"","title":"景点玩乐开放平台","x-logo":{"url":"https://pages.trip.com/tourorder/ttd/ttd_file/redoc_left_top_cn.png"},"contact":{"email":"DMJSYFMP_gys@trip.com"}},"tags":[{"name":"文档介绍","description":"由供应商按照携程系统的标准接口进行开发， 实时同步商品在指定日期的库存数以及订单结算价和卖价等。"},{"name":"产品动线","description":"<img src=\"https://pages.trip.com/tourorder/ttd/ttd_file/movingline-product-priceandstock.png\" style=\"max-width: 90%\"/>"},{"name":"接入前期准备","description":"<p>1、明确需接入的接口（本文主要是订单对接，需注意根据不同的产品动线，需接入不同的接口）。</p><p>2、填写对接需求表，联系携程业务。</p><p>3、获取到沙箱的账号密码。</p><p>4、在沙箱内配置配置请求接口地址，自测平台主要分为测试环境和生产环境，供应商需要提供测试环境和生产环境，然后配置订单接口参数，如无测试环境，可只测生产环境。</p><p>沙箱地址：<a href=\"https://ttdopen.ctrip.com/user/login.do\" target=\"_blank\">https://ttdopen.ctrip.com/user/login.do</a></p><p>沙箱使用方法：<a href=\"https://open.trip.com/docs?id=3002&fid=3000&locale=zh-CN\" target=\"_blank\">沙箱自助测试流程</a></p><img src=\"https://pages.trip.com/tourorder/ttd/ttd_file/sandbox-configuration-order.png\" style=\"max-width: 90%\"/><p>5、了解数据交互方式</p>"},{"name":"数据交互与安全","description":"<h2>请求方式</h2> 采用HTTP标准的POST协议，POST一般用于页面跳转交互模式的请求和通知、后台系统调用模式的请求、后台通知模式的请求。\n\n`一个完整的json格式请求/响应报文包含header、body两个节点（body采用AES加密详看下述 AES加密）。`\n\n接口响应异常的补偿逻辑：\n\n1、携程请求供应商接口时出现异常或者超时，携程会进行3次补偿处理，同批次请求时请返回相同的结果。\n\n2、供应商请求携程接口时若因网络超时或其他原因导致没有收到携程处理结果响应，请用相同报文重试请求携程接口。<h2>编码格式</h2>UTF-8<h2>签名算法</h2>携程跟供应商交互的信息做到签名、防篡改。\n\n验证签名步骤：\n\n1. 获取json报文中的body部分\n\n2. 对参数(accountId+serviceName+requestTime+body+version+signkey)进行拼接\n\n3. 拼接的参数进行MD5编码并转小写后进行签名比对验证\n\nJava签名组装示例代码：\n\nJSONObject json = JSONObject.fromObject(body);\nString mybody = json.getString(\"body\");\nString sign = md5(accountId+serviceName+requestTime+mybody+version+signkey).toLowerCase();\nreturn sign;<h2>AES加密</h2>`请求、响应报文的body部分采用AES加密后进行传输。`\n\n加密后示例：\n\n\n\n    {\n       \"header\":{\n\t\t    \"accountId\":\"xiecheng\",\n\t\t    \"serviceName\":\"CheckHealth\",\n\t\t    \"requestTime\":\"2017-01-05 10:00:00\",\n\t\t    \"version\":\"1.0\",\n\t\t    \"sign\":\"374d95774f17c3e354e73f7aaf21b5ec\"\n\t   },\n       \"body\":\"RRRJJNGHELTYYYTTEWRKJJJKRKEWR==\"\n    }\n\n加密模式为AES-128-CBC，补码方式为AES/CBC/PKCS5Padding。加密的私钥（key）、初始化向量参数（iv）均为16位由携程生成给到供应商。AES代码示例（java）：(php代码参考：<a href='https://open.trip.com/help?keyword=php%E5%8A%A0/%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B' target='_blank'>php加/解密算法代码示例</a>）：\n\n    /**\n     * 加密方法\n     *\n     * @param encData   要加密的数据\n     * @param secretKey  密钥，16位的数字和字母\n     * @param vector     初始化向量，16位的数字和字母\n     * @return\n     * @throws Exception\n     */\n    public static String encrypt(String encData, String secretKey, String vector) {\n        try {\n            byte[] raw = secretKey.getBytes(\"utf-8\");\n            SecretKeySpec skeySpec = new SecretKeySpec(raw, \"AES\");\n            Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n            IvParameterSpec iv = new IvParameterSpec(vector.getBytes(\"utf-8\"));\n            cipher.init(Cipher.ENCRYPT_MODE, skeySpec, iv);\n            byte[] encrypted = cipher.doFinal(encData.getBytes(\"utf-8\"));\n            return encodeBytes(encrypted);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * 解密方法\n     *\n     * @param decData   要解密的数据\n     * @param secretKey  密钥，16位的数字和字母\n     * @param vector     初始化向量，16位的数字和字母\n     * @return\n     * @throws Exception\n     */\n    public static String decrypt(String decData, String secretKey, String vector) {\n        try {\n            byte[] raw = secretKey.getBytes(\"utf-8\");\n            SecretKeySpec skeySpec = new SecretKeySpec(raw, \"AES\");\n            Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n            IvParameterSpec iv = new IvParameterSpec(vector.getBytes(\"utf-8\"));\n            cipher.init(Cipher.DECRYPT_MODE, skeySpec, iv);\n            byte[] encrypted1 = decodeBytes(decData);\n            byte[] original = cipher.doFinal(encrypted1);\n            return new String(original, \"utf-8\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * 转16进制\n     *\n     * @param bytes\n     * @return\n     */\n    public static String encodeBytes(byte[] bytes) {\n        StringBuffer strBuf = new StringBuffer();\n        for (int i = 0; i < bytes.length; i++) {\n            strBuf.append((char) (((bytes[i] >> 4) & 0xF) + ((int) 'a')));\n            strBuf.append((char) (((bytes[i]) & 0xF) + ((int) 'a')));\n        }\n        return strBuf.toString();\n    }\n\n    /**\n     * 转字节数组\n     *\n     * @param str\n     * @return\n     */\n    public static byte[] decodeBytes(String str) {\n        byte[] bytes = new byte[str.length() / 2];\n        for (int i = 0; i < str.length(); i += 2) {\n            char c = str.charAt(i);\n            bytes[i / 2] = (byte) ((c - 'a') << 4);\n            c = str.charAt(i + 1);\n            bytes[i / 2] += (c - 'a');\n        }\n        return bytes;\n    }\n                "},{"name":"价格库存接口列表","description":""},{"name":"返回码","description":"# 携程接口返回码（价格库存） \n\n| 分类 | 返回码 | 返回信息 | 描述 |\n| :----- | :----: | :---- | :---- |\n| 成功 | 0000 | success | 操作成功 |\n| 账户/系统相关 |  |  |  |\n|  | 0001 | 供应商账户为空 |  |\n|  | 0002 | 签名不正确 |  |\n|  | 0003 | 报文解析失败  |  |\n|  | 0004 | 请求方法为空 |  |\n|  | 0005 | 系统处理异常 |  |\n|  | 0006 | 请求数据异常  |  |\n|  | 0007 | 提交数据超载，接收失败 |  |\n|  | 0008 | 提交频率过快，请稍后提交 |  |\n| 资源价格同步相关 |  |  | |\n|  | 1001 | 携程资源编号不存在/错误 |  |\n|  | 1002 | 供应商PLU不存在/错误 |  |\n|  | 1003 | 数据参数不合法 |  |\n| 资源库存同步相关 |  |  | |\n|  | 2001 | 携程资源编号不存在/错误 |  |\n|  | 2002 | 供应商PLU不存在/错误 |  |\n|  | 2003 | 数据参数不合法 |  |\n"},{"name":"附录","description":""},{"name":"常见问题","description":"<a href=\"https://open.trip.com/help?category=4\" target=\"_blank\">商品对接常见问题</a>"}],"paths":{"/DatePriceModify.do":{"post":{"tags":["价格库存接口列表"],"summary":"资源日期价格同步接口","description":"\n描述：价格同步接口，支持商家更新资源的价格，`每次调用最多接收90条的价格数据，最远同步距离当日210天的价格数据，接口调用频率要小于100次/分钟，同一资源更新频率小于5次/分钟;` 适用于景点/玩乐品类产品资源的价格同步。","operationId":"DatePriceModify","consumes":["application/json"],"produces":["application/json"],"parameters":[{"in":"body","name":"DatePriceModifyRequest","description":"资源日期价格同步接口请求对象","required":true,"schema":{"$ref":"#/definitions/DatePriceModifyRequest"}}],"responses":{"200":{"description":"操作成功","schema":{"$ref":"#/definitions/DatePriceModifyResponse"}}}}},"/DateInventoryModify.do":{"post":{"tags":["价格库存接口列表"],"summary":"资源日期库存同步接口","description":"\n描述：库存同步接口，支持日库存或总库存数更新，`每次调用最多接收90条的库存数据，最远同步距离当日210天的价格数据，接口调用频率需小于100次/分钟，同一资源更新频率小于5次/分钟;` 适用于景点/玩乐品类产品资源的库存数同步。","operationId":"DateInventoryModify","consumes":["application/json"],"produces":["application/json"],"parameters":[{"in":"body","name":"DateInventoryModifyRequest","description":"资源日期库存同步接口请求对象","required":true,"schema":{"$ref":"#/definitions/DateInventoryModifyRequest"}}],"responses":{"200":{"description":"操作成功","schema":{"$ref":"#/definitions/DateInventoryModifyResponse"}}}}}},"definitions":{"DatePriceModifyRequest":{"type":"object","description":"资源日期价格同步接口","required":["header","body"],"properties":{"header":{"type":"object","description":"请求头","required":["accountId","serviceName","requestTime","version","sign"],"properties":{"accountId":{"type":"string","description":"供应商帐号，由携程分配","example":"xiecheng"},"serviceName":{"type":"string","description":"接口名称: DatePriceModify","example":"DatePriceModify"},"requestTime":{"type":"string","description":"请求时间(格式: yyyy-MM-dd HH:mm:ss)","example":"2017-01-05 10:00:00"},"version":{"type":"string","description":"版本号, 1.0","example":"1.0"},"sign":{"type":"string","description":"签名","example":"374d95774f17c3e354e73f7aaf21b5ec"}}},"body":{"type":"object","description":"请求体（传输时该字段需要AES加密，参考：[数据交互与安全](#tag/数据交互与安全)）","required":["sequenceId","prices"],"properties":{"sequenceId":{"type":"string","description":"供应商处理批次流水号。格式为处理日期（yyyy-MM-dd）+32位去分隔符的Guid","example":"2017-10-10abcd95774f17c3e354e73f7aaf21b5ec"},"otaOptionId":{"type":"number","description":"携程资源编号，otaOptionId和supplierOptionId必选其一","example":"568898"},"supplierOptionId":{"type":"string","description":"供应商PLU，otaOptionId和supplierOptionId必选其一","example":"568898"},"dateType":{"type":"string","description":"日期类型。枚举值 \n\nDATE_REQUIRED：需指定日期（预订时客人需要指定具体游玩日期）；\n\nDATE_NOT_REQUIRED：无需指定日期（预订时客人无需选择游玩日期）","example":"DATE_REQUIRED"},"prices":{"type":"array","description":"价格节点\n\n注：零售只可更新市场价、卖价，非零售只可更新结算价","items":{"type":"object","description":"价格节点\n\n注：零售只需更新卖价，非零售只需更新结算价","properties":{"date":{"type":"string","description":"日期，格式：“yyyy-MM-dd” \n\n仅在dateType=DATE_REQUIRED时必传（最多一次接口调用传90天）。\n\n当dateType=DATE_NOT_REQUIRED时，请不要传此字段","example":"2018-12-12"},"salePrice":{"type":"number","description":"卖价","example":"120.00"},"costPrice":{"type":"number","description":"结算价","example":"100.00"}}}}}}},"xml":{"name":"DatePriceModifyRequest"}},"DatePriceModifyResponse":{"type":"object","description":"资源日期价格同步接口","required":["header"],"properties":{"header":{"type":"object","description":"返回头","required":["resultCode","resultMessage"],"properties":{"resultCode":{"type":"string","description":"处理结果返回码, 参考: [携程接口返回码（价格库存）](#section/携程接口返回码（价格库存）)","example":"0000"},"resultMessage":{"type":"string","description":"处理结果返回信息，参考: [携程接口返回码（价格库存）](#section/携程接口返回码（价格库存）)","example":"操作成功"}}}},"xml":{"name":"DatePriceModifyResponse"}},"DateInventoryModifyRequest":{"type":"object","description":"资源日期库存同步接口","required":["header","body"],"properties":{"header":{"type":"object","description":"请求头","required":["accountId","serviceName","requestTime","version","sign"],"properties":{"accountId":{"type":"string","description":"供应商帐号，由携程分配","example":"xiecheng"},"serviceName":{"type":"string","description":"接口名称: DateInventoryModify","example":"DateInventoryModify"},"requestTime":{"type":"string","description":"请求时间(格式: yyyy-MM-dd HH:mm:ss)","example":"2017-01-05 10:00:00"},"version":{"type":"string","description":"版本号, 1.0","example":"1.0"},"sign":{"type":"string","description":"签名","example":"374d95774f17c3e354e73f7aaf21b5ec"}}},"body":{"type":"object","description":"请求体（传输时该字段需要AES加密，参考：[数据交互与安全](#tag/数据交互与安全)）","required":["sequenceId","inventorys"],"properties":{"sequenceId":{"type":"string","description":"供应商处理批次流水号。格式为处理日期（yyyy-MM-dd）+32位去分隔符的Guid","example":"2017-10-10abcd95774f17c3e354e73f7aaf21b5ec"},"otaOptionId":{"type":"number","description":"携程资源编号，otaOptionId和supplierOptionId必选其一","example":"568898"},"supplierOptionId":{"type":"string","description":"供应商PLU，otaOptionId和supplierOptionId必选其一","example":"568898"},"dateType":{"type":"string","description":"日期类型。枚举值 \n\nDATE_REQUIRED：需指定日期（预订时客人需要指定具体游玩日期）；\n\nDATE_NOT_REQUIRED：无需指定日期（预订时客人无需选择游玩日期）","example":"DATE_REQUIRED"},"inventorys":{"type":"array","description":"库存节点","items":{"type":"object","description":"库存节点","required":["quantity"],"properties":{"date":{"type":"string","description":"日期，格式：“yyyy-MM-dd” \n\n仅在dateType=DATE_REQUIRED时必传（最多一次接口调用传90天）。\n\n当dateType=DATE_NOT_REQUIRED时，请不要传此字段。","example":"2018-12-12"},"quantity":{"type":"integer","description":"可售库存，大于等于0的整数","example":"120"}}}}}}},"xml":{"name":"DateInventoryModifyRequest"}},"DateInventoryModifyResponse":{"type":"object","description":"资源日期库存同步接口","required":["header"],"properties":{"header":{"type":"object","description":"返回头","required":["resultCode","resultMessage"],"properties":{"resultCode":{"type":"string","description":"处理结果返回码, 参考: [携程接口返回码（价格库存）](#section/携程接口返回码（价格库存）)","example":"0000"},"resultMessage":{"type":"string","description":"处理结果返回信息，参考: [携程接口返回码（价格库存）](#section/携程接口返回码（价格库存）)","example":"操作成功"}}}},"xml":{"name":"DateInventoryModifyResponse"}}}}